<!DOCTYPE html>
<html lang="en">
<head>
    <title>Ethereum Light</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css" crossorigin="anonymous"/>
    <style>
        @font-face {
            font-family: 'm_1mmedium';
            src: url('mplus-1m-medium-webfont.woff') format('woff');
            font-weight: normal;
            font-style: normal;
        }

        @font-face {
            font-family: 'm_1mlight';
            src: url('mplus-1m-light-webfont.woff') format('woff');
            font-weight: normal;
            font-style: normal;
        }

        a {
            text-decoration: none;
        }

        table {
            border-collapse: collapse;
        }

        #mdMaster {
            width: 270px;
            height: 100vh;
            position: fixed;
            left: 0;
            top: 0;
            background-color: #f9f9f9;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            padding: 10px;
            overflow-y: scroll;
        }

        #mdDetail {
            margin-left: 300px;
            padding: 10px;
        }

        .headerMaster {
            margin: 10px 0px 5px;
            padding: 10px 5px 10px;
            background-color: #e9e9e9;
            border-radius: 5px;
        }

        .headerMasterBeaconRoot {
            font-family: 'm_1mmedium', monospace;
            font-size: 1em;
            text-align: center;
        }

        .headerMasterInfo {
            padding: 0px 3px 0px 3px;
            font-family: 'm_1mlight', monospace;
            font-size: 0.7em;
        }

        .headerMasterInfo table {
            white-space: nowrap;
        }

        .headerMasterInfo td {
            width: 60px;
            padding-top: 5px;
        }

        .kv td {
            padding-top: 10px;
            vertical-align: top;
            white-space: nowrap;
        }

        .description {
            font-family: 'm_1mlight', monospace;
        }

        .kvKey {
            font-family: 'm_1mlight', monospace;
            text-align: right;
            width: 250px;
            padding-right: 10px;
        }

        .kvValue {
            font-family: 'm_1mmedium', monospace;
            text-align: left;
        }

        .tree {
            font-family: 'm_1mmedium', monospace;
            text-align: right;
        }

        .tree td {
            position: relative;
        }

        .unused {
            font-family: 'm_1mlight', monospace;
            color: #797979;
        }

        .tree .node-right {
            padding-right: 30px;
        }

        .tree .node-left {
            padding-left: 30px;
        }

        .tree .node-right::after {
            content: "";
            width: 10px;
            height: 10px;
            border: 1px solid #000;
            background-color: #fff;
            z-index: 1;
            border-radius: 50%;
            position: absolute;
            right: 10px;
            top: 50%;
            transform: translateY(-50%);
        }

        .tree .node-bottom {
            text-align: center;
        }

        .tree .node-bottom::after {
            content: "";
            width: 10px;
            height: 10px;
            border: 1px solid #000;
            background-color: #fff;
            z-index: 1;
            border-radius: 50%;
            position: absolute;
            bottom: 10px;
            left: 50%;
            transform: translateX(-50%);
        }

        .tree .node-left {
            text-align: left;
        }

        .tree .node-left::before {
            content: "";
            width: 10px;
            height: 10px;
            border: 1px solid #000;
            background-color: #fff;
            z-index: 1;
            border-radius: 50%;
            position: absolute;
            left: 10px;
            top: 50%;
            transform: translateY(-50%);
        }

        .tree .lines {
            background-color: #000;
            position: absolute;
        }

        .tree .node-right .lines {
            left: -15px;
            height: 1px;
            transform-origin: left;
        }

        .tree .node-right .lines:nth-child(1) {
            top: 25%;
        }

        .tree .node-right .lines:nth-child(2) {
            top: 75%;
        }

        .tree .node-right[rowspan="2"] .lines {
            width: 100%;
        }

        .tree .node-right[rowspan="2"] .lines:nth-child(1) {
            transform: rotate(17deg) translateY(-50%);
        }

        .tree .node-right[rowspan="2"] .lines:nth-child(2) {
            transform: rotate(-17deg) translateY(-50%);
        }

        .tree .node-right[rowspan="4"] .lines {
            width: 110%;
        }

        .tree .node-right[rowspan="4"] .lines:nth-child(1) {
            transform: rotate(35deg) translateY(-50%);
        }

        .tree .node-right[rowspan="4"] .lines:nth-child(2) {
            transform: rotate(-35deg) translateY(-50%);
        }

        .tree .node-right[rowspan="8"] .lines {
            width: 170%;
        }

        .tree .node-right[rowspan="8"] .lines:nth-child(1) {
            transform: rotate(54deg) translateY(-50%);
        }

        .tree .node-right[rowspan="8"] .lines:nth-child(2) {
            transform: rotate(-54deg) translateY(-50%);
        }

        .tree .node-right[rowspan="16"] .lines {
            width: 290%;
        }

        .tree .node-right[rowspan="16"] .lines:nth-child(1) {
            transform: rotate(71deg) translateY(-50%);
        }

        .tree .node-right[rowspan="16"] .lines:nth-child(2) {
            transform: rotate(-71deg) translateY(-50%);
        }

        .tree .node-right[rowspan="17"] .lines {
            width: 220%;
        }

        .tree .node-right[rowspan="17"] .lines:nth-child(1) {
            top: 0%;
            transform: rotate(63deg) translateY(-50%);
        }

        .tree .node-right[rowspan="17"] .lines:nth-child(2) {
            width: 210%;
            top: 97%;
            transform: rotate(-62deg) translateY(-50%);
        }

        .tree .node-right[rowspan="32"] .lines {
            width: 540%;
        }

        .tree .node-right[rowspan="32"] .lines:nth-child(1) {
            transform: rotate(80deg) translateY(-50%);
        }

        .tree .node-right[rowspan="32"] .lines:nth-child(2) {
            transform: rotate(-80deg) translateY(-50%);
        }

        .tree .node-bottom .lines {
            bottom: -15px;
            height: 1px;
            width: 85px;
            transform-origin: top;
        }

        .tree .node-bottom .lines:nth-child(1) {
            left: 10%;
            bottom: 23%;
        }

        .tree .node-bottom .lines:nth-child(2) {
            left: 43%;
            bottom: -12%;
        }

        .tree .node-bottom[rowspan="4"] .lines:nth-child(1) {
            transform: rotate(-36deg) translateX(-50%);
        }

        .tree .node-bottom[rowspan="4"] .lines:nth-child(2) {
            transform: rotate(36deg) translateY(-50%);
        }

        .tree .node-left .lines {
            right: -15px;
            height: 1px;
            transform-origin: right;
        }

        .tree .node-left .lines:nth-child(1) {
            top: 25%;
        }

        .tree .node-left .lines:nth-child(2) {
            top: 75%;
        }

        .tree .node-left[rowspan="2"] .lines {
            width: 100%;
        }

        .tree .node-left[rowspan="2"] .lines:nth-child(1) {
            transform: rotate(-17deg) translateY(-50%);
        }

        .tree .node-left[rowspan="2"] .lines:nth-child(2) {
            transform: rotate(17deg) translateY(-50%);
        }

        .tree .node-left[rowspan="4"] .lines {
            width: 110%;
        }

        .tree .node-left[rowspan="4"] .lines:nth-child(1) {
            transform: rotate(-35deg) translateY(-50%);
        }

        .tree .node-left[rowspan="4"] .lines:nth-child(2) {
            transform: rotate(35deg) translateY(-50%);
        }

        .tree .node-left[rowspan="8"] .lines {
            width: 170%;
        }

        .tree .node-left[rowspan="8"] .lines:nth-child(1) {
            transform: rotate(-54deg) translateY(-50%);
        }

        .tree .node-left[rowspan="8"] .lines:nth-child(2) {
            transform: rotate(54deg) translateY(-50%);
        }

        .tree .node-left[rowspan="16"] .lines {
            width: 290%;
        }

        .tree .node-left[rowspan="16"] .lines:nth-child(1) {
            transform: rotate(-71deg) translateY(-50%);
        }

        .tree .node-left[rowspan="16"] .lines:nth-child(2) {
            transform: rotate(71deg) translateY(-50%);
        }

        .tree .node-left[rowspan="17"] .lines {
            width: 180%;
        }

        .tree .node-left[rowspan="17"] .lines:nth-child(1) {
            top: 0%;
            width: 190%;
            transform: rotate(-59deg) translateY(-50%);
        }

        .tree .node-left[rowspan="17"] .lines:nth-child(2) {
            top: 97%;
            transform: rotate(57deg) translateY(-50%);
        }

        .tree .node-left[rowspan="32"] .lines {
            width: 540%;
        }

        .tree .node-left[rowspan="32"] .lines:nth-child(1) {
            transform: rotate(-80deg) translateY(-50%);
        }

        .tree .node-left[rowspan="32"] .lines:nth-child(2) {
            transform: rotate(80deg) translateY(-50%);
        }

        .fas {
            width: 12px;
            text-align: center;
        }

        #beaconApiBase, #executionApiBase, #trustedBlockRoot {
            width: 230px;
            font-family: 'm_1mlight', monospace;
        }
    </style>
</head>
<body>
    <div id="mdMaster">
        <div id="masterTop" class="headerMaster">
            <div class="headerMasterInfo">
                <table style="width: 100%">
                    <tr>
                        <td><input type="button" id="settingsButton" value="Settings" /></td>
                    </tr>
                </table>
            </div>
        </div>
        <div id="settings" class="headerMaster" hidden="hidden">
            <div class="headerMasterInfo">
                <table style="width: 100%">
                    <tr>
                        <td><span class="fas fa-satellite-dish"></span> <input id="beaconApiBase" value="https://beacon-api.eth-light.xyz" /></td>
                    </tr>
                    <tr>
                        <td><span class="fas fa-cogs"></span> <input id="executionApiBase" value="https://mainnet.infura.io/v3/d0366f5631e045198d9bb487228a6ec7" /></td>
                    </tr>
                    <tr>
                        <td><span class="fas fa-shield-alt"></span> <input id="trustedBlockRoot" value="0x15cf56ebf887ede9cf3fc10a26ec83828628932c100e42c98c84f83da710c863" /></td>
                    </tr>
                    <tr>
                        <td><input type="button" id="initButton" value="Save" disabled /></td>
                    </tr>
                </table>
            </div>
        </div>
        <div id="headerList" hidden="hidden"></div>
        <div id="selectedHeaderDetail" hidden="hidden">
            <div id="selectedHeader" class="headerMaster">
                <div id="selectedBeaconRoot" class="headerMasterBeaconRoot"></div>
                <div class="headerMasterInfo">
                    <table style="width: 100%">
                        <tr>
                            <td><span class="fas fa-satellite-dish"></span> <span id="selectedBeaconSlot"></span></td>
                            <td><span class="fas fa-cubes"></span> <span id="selectedExecutionBlockNumber"></span></td>
                            <td colspan="2" style="text-align: right;"><span class="fas fa-clock"></span> <span id="selectedExecutionTimestamp"></span></td>
                        </tr>
                        <tr>
                            <td><span class="fas fa-user-check"></span> <span id="selectedBeaconProposerIndex"></span></td>
                            <td colspan="2" class="a"><span class="fas fa-tachometer-alt"></span> <span id="selectedExecutionGasUsedPercentage"></span> <span id="selectedExecutionGasUsed"></span>/<span id="selectedExecutionGasLimit"></span></td>
                            <td style="text-align: right;"><span class="fas fa-fire-flame-curved"></span> <span id="selectedExecutionBaseFeePerGas"></span></td>
                        </tr>
                        <tr>
                            <td colspan="4"><span class="fas fa-hand-holding-usd"></span> <span id="selectedExecutionFeeRecipient" style="display: inline-block; transform: scaleX(1.015); transform-origin: left;"></span></td>
                        </tr>
                        <tr>
                            <td colspan="4"><input type="button" id="backButton" value="Back" /> <div id="selectedTransactionInfo" style="display: inline-block; width: 81.5%; text-align: right;"></div></td>
                        </tr>
                    </table>
                </div>
            </div>
            <div id="selectedTransactionList"></div>
        </div>
    </div>
    <div id="mdDetail">
        <div id="selectedTransactionRlpDetail" hidden="hidden" style="text-align: center;">
            <div class="headerMaster" style="width: 1000px; margin-top: 57px; margin-bottom: 57px; margin-left: auto; margin-right: auto;">
                <table class="kv" style="width: 100%;">
                    <thead style="border-bottom: 1px solid #d9d9d9;">
                        <tr>
                            <td class="kvKey" style="padding-bottom: 10px;">Hash</td>
                            <td class="kvValue"><div id="selectedTransactionRlpHash"></div></td>
                        </tr>
                    </thead>
                    <tbody>
                        <tr id="selectedTransactionRlpHasEip2718Type">
                            <td class="kvKey"><a href="https://eips.ethereum.org/EIPS/eip-2718" target="_blank">EIP-2718</a> type</td>
                            <td class="kvValue"><span id="selectedTransactionRlpEip2718Type"></span> <span class="description">(<span id="selectedTransactionRlpEip2718TypeDescription"></span>)</span></td>
                        </tr>
                        <tr>
                            <td class="kvKey">Payload length</td>
                            <td class="kvValue"><span id="selectedTransactionRlpLength"></span> <span class="description">(<span id="selectedTransactionRlpLengthDescription"></span>)</span></td>
                        </tr>
                        <tr id="selectedTransactionRlpHasChainId">
                            <td class="kvKey"><a href="https://eips.ethereum.org/EIPS/eip-155" target="_blank">Chain ID</a></td>
                            <td class="kvValue"><span id="selectedTransactionRlpChainIdLength"></span> <span id="selectedTransactionRlpChainId"></span></td>
                        </tr>
                        <tr>
                            <td class="kvKey">Nonce</td>
                            <td class="kvValue"><span id="selectedTransactionRlpNonceLength"></span> <span id="selectedTransactionRlpNonce"></span> <span class="description">(<span id="selectedTransactionRlpNonceDescription"></span>)</span></td>
                        </tr>
                        <tr id="selectedTransactionRlpHasMaxPriorityFeePerGas">
                            <td class="kvKey"><a href="https://eips.ethereum.org/EIPS/eip-1559" target="_blank">Max priority fee per gas</a></td>
                            <td class="kvValue"><span id="selectedTransactionRlpMaxPriorityFeePerGasLength"></span> <span id="selectedTransactionRlpMaxPriorityFeePerGas"></span> <span class="description">(<span id="selectedTransactionRlpMaxPriorityFeePerGasDescription"></span>)</span></td>
                        </tr>
                        <tr>
                            <td class="kvKey">Max fee per gas</td>
                            <td class="kvValue"><span id="selectedTransactionRlpMaxFeePerGasLength"></span> <span id="selectedTransactionRlpMaxFeePerGas"></span> <span class="description">(<span id="selectedTransactionRlpMaxFeePerGasDescription"></span>)</span></td>
                        </tr>
                        <tr>
                            <td class="kvKey">Gas</td>
                            <td class="kvValue"><span id="selectedTransactionRlpGasLength"></span> <span id="selectedTransactionRlpGas"></span> <span class="description">(<span id="selectedTransactionRlpGasDescription"></span>)</span></td>
                        </tr>
                        <tr>
                            <td class="kvKey">To</td>
                            <td class="kvValue"><span id="selectedTransactionRlpToLength"></span> <span id="selectedTransactionRlpTo"></span> <span class="description">(<span id="selectedTransactionRlpToDescription"></span>)</span></td>
                        </tr>
                        <tr>
                            <td class="kvKey">Value</td>
                            <td class="kvValue"><span id="selectedTransactionRlpValueLength"></span> <span id="selectedTransactionRlpValue"></span> <span class="description">(<span id="selectedTransactionRlpValueDescription"></span>)</span></td>
                        </tr>
                        <tr>
                            <td class="kvKey">Input</td>
                            <td class="kvValue"><span id="selectedTransactionRlpInputLength"></span> <span class="description">(<span id="selectedTransactionRlpInputDescription"></span>)</span> <span id="selectedTransactionRlpInput"></span></td>
                        </tr>
                        <tr id="selectedTransactionRlpHasAccessList">
                            <td class="kvKey"><a href="https://eips.ethereum.org/EIPS/eip-2930" target="_blank">Access list</a><span id="selectedTransactionRlpAccessListLabel"></span></td>
                            <td class="kvValue"><span id="selectedTransactionRlpAccessListLength"></span> <span class="description">(<span id="selectedTransactionRlpAccessListDescription"></span>)</span> <span id="selectedTransactionRlpAccessList"></span></td>
                        </tr>
                        <tr>
                            <td class="kvKey">V</td>
                            <td class="kvValue"><span id="selectedTransactionRlpVLength"></span> <span id="selectedTransactionRlpV"></span> <span class="description">(<span id="selectedTransactionRlpVDescription"></span>)</span></td>
                        </tr>
                        <tr>
                            <td class="kvKey">R</td>
                            <td class="kvValue"><span id="selectedTransactionRlpRLength"></span> <span id="selectedTransactionRlpR"></span></td>
                        </tr>
                        <tr>
                            <td class="kvKey">S</td>
                            <td class="kvValue"><span id="selectedTransactionRlpSLength"></span> <span id="selectedTransactionRlpS"></span></td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
        <div id="selectedTransactionEip6404Detail" hidden="hidden" style="text-align: center;">
            <div class="headerMaster" style="width: 1000px; margin-top: 57px; margin-bottom: 57px; margin-left: auto; margin-right: auto;">
                <table class="kv" style="width: 100%;">
                    <thead style="border-bottom: 1px solid #d9d9d9;">
                        <tr>
                            <td class="kvKey" style="padding-bottom: 10px;"><a href="https://eips.ethereum.org/EIPS/eip-6404" target="_blank">EIP-6404</a> root</td>
                            <td class="kvValue"><div id="selectedTransactionEip6404Root"></div></td>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td class="kvKey">Payload offset</td>
                            <td class="kvValue"><span id="selectedTransactionEip6404PayloadOffset"></span> <span class="description">(start +<span id="selectedTransactionEip6404PayloadOffsetDescription"></span>)</span></td>
                        </tr>
                        <tr>
                            <td class="kvKey">Signature offset</td>
                            <td class="kvValue"><span id="selectedTransactionEip6404SignatureOffset"></span> <span class="description">(start +<span id="selectedTransactionEip6404SignatureOffsetDescription"></span>)</span></td>
                        </tr>
                        <tr>
                            <td class="kvKey">Payload active fields</td>
                            <td class="kvValue"><span id="selectedTransactionEip6404PayloadActiveFields"></span> <span class="description">(<span id="selectedTransactionEip6404PayloadActiveFieldsDescription"></span>)</span></td>
                        </tr>
                        <tr id="selectedTransactionEip6404PayloadHasNonce">
                            <td class="kvKey">Nonce</td>
                            <td class="kvValue"><span id="selectedTransactionEip6404PayloadNonce"></span> <span class="description">(<span id="selectedTransactionEip6404PayloadNonceDescription"></span>)</span></td>
                        </tr>
                        <tr id="selectedTransactionEip6404PayloadHasMaxFeePerGas">
                            <td class="kvKey">Max fee per gas</td>
                            <td class="kvValue"><span id="selectedTransactionEip6404PayloadMaxFeePerGas"></span> <span class="description">(<span id="selectedTransactionEip6404PayloadMaxFeePerGasDescription"></span>)</span></td>
                        </tr>
                        <tr id="selectedTransactionEip6404PayloadHasGas">
                            <td class="kvKey">Gas</td>
                            <td class="kvValue"><span id="selectedTransactionEip6404PayloadGas"></span> <span class="description">(<span id="selectedTransactionEip6404PayloadGasDescription"></span>)</span></td>
                        </tr>
                        <tr id="selectedTransactionEip6404PayloadHasTo">
                            <td class="kvKey">To</td>
                            <td class="kvValue"><span id="selectedTransactionEip6404PayloadTo"></span> <span class="description">(<span id="selectedTransactionEip6404PayloadToDescription"></span>)</span></td>
                        </tr>
                        <tr id="selectedTransactionEip6404PayloadHasValue">
                            <td class="kvKey">Value</td>
                            <td class="kvValue"><span id="selectedTransactionEip6404PayloadValue"></span> <span class="description">(<span id="selectedTransactionEip6404PayloadValueDescription"></span>)</span></td>
                        </tr>
                        <tr id="selectedTransactionEip6404PayloadHasInputOffset">
                            <td class="kvKey">Input offset</td>
                            <td class="kvValue"><span id="selectedTransactionEip6404PayloadInputOffset"></span> <span class="description">(payload data +<span id="selectedTransactionEip6404PayloadInputOffsetDescription"></span>)</span></td>
                        </tr>
                        <tr id="selectedTransactionEip6404PayloadHasAccessListOffset">
                            <td class="kvKey"><a href="https://eips.ethereum.org/EIPS/eip-2930" target="_blank">Access list</a> offset</td>
                            <td class="kvValue"><span id="selectedTransactionEip6404PayloadAccessListOffset"></span> <span class="description">(payload data +<span id="selectedTransactionEip6404PayloadAccessListOffsetDescription"></span>)</span></td>
                        </tr>
                        <tr id="selectedTransactionEip6404PayloadHasMaxPriorityFeePerGas">
                            <td class="kvKey"><a href="https://eips.ethereum.org/EIPS/eip-1559" target="_blank">Max priority fee per gas</a></td>
                            <td class="kvValue"><span id="selectedTransactionEip6404PayloadMaxPriorityFeePerGas"></span> <span class="description">(<span id="selectedTransactionEip6404PayloadMaxPriorityFeePerGasDescription"></span>)</span></td>
                        </tr>
                        <tr id="selectedTransactionEip6404PayloadHasInput">
                            <td class="kvKey">Input</td>
                            <td class="kvValue"><span id="selectedTransactionEip6404PayloadInput"></span> <span class="description">(<span id="selectedTransactionEip6404PayloadInputDescription"></span>)</span></td>
                        </tr>
                        <tr id="selectedTransactionEip6404PayloadHasAccessList">
                            <td class="kvKey"><a href="https://eips.ethereum.org/EIPS/eip-2930" target="_blank">Access list</a><span id="selectedTransactionEip6404PayloadAccessListLabel"></span></td>
                            <td class="kvValue"><span id="selectedTransactionEip6404PayloadAccessListStart"></span> <span class="description">(<span id="selectedTransactionEip6404PayloadAccessListDescription"></span>)</span> <span id="selectedTransactionEip6404PayloadAccessList"></span></td>
                        </tr>
                        <tr>
                            <td class="kvKey">Signature active fields</td>
                            <td class="kvValue"><span id="selectedTransactionEip6404SignatureActiveFields"></span> <span class="description">(<span id="selectedTransactionEip6404SignatureActiveFieldsDescription"></span>)</span></td>
                        </tr>
                        <tr id="selectedTransactionEip6404SignatureHasFrom">
                            <td class="kvKey">From</td>
                            <td class="kvValue"><span id="selectedTransactionEip6404SignatureFrom"></span> <span class="description">(<span id="selectedTransactionEip6404SignatureFromDescription"></span>)</span></td>
                        </tr>
                        <tr id="selectedTransactionEip6404SignatureHasEcdsaSignature">
                            <td class="kvKey">ECDSA signature</td>
                            <td class="kvValue"><span id="selectedTransactionEip6404SignatureEcdsaSignature"></span></td>
                        </tr>
                        <tr id="selectedTransactionEip6404SignatureHasNoReplayProtection">
                            <td class="kvKey"><a href="https://eips.ethereum.org/EIPS/eip-155" target="_blank">No replay protection</a></td>
                            <td class="kvValue"><span id="selectedTransactionEip6404SignatureNoReplayProtection"></span> <span class="description">(<span id="selectedTransactionEip6404SignatureNoReplayProtectionDescription"></span>)</span></td>
                        </tr>
                        <tr id="selectedTransactionEip6404SignatureHasEip2718Type">
                            <td class="kvKey"><a href="https://eips.ethereum.org/EIPS/eip-2718" target="_blank">EIP-2718</a> type</td>
                            <td class="kvValue"><span id="selectedTransactionEip6404SignatureEip2718Type"></span> <span class="description">(<span id="selectedTransactionEip6404SignatureEip2718TypeDescription"></span>)</span></td>
                        </tr>
                    </tbody>
                </table>
            </div>
            <div style="width: 100%;">
                <table class="tree" style="margin: 0 auto;">
                    <tr>
                        <td class="node-right">nonce</td>
                        <td class="node-right" rowspan="2"><div class="lines"></div><div class="lines"></div></td>
                        <td class="node-right" rowspan="4"><div class="lines"></div><div class="lines"></div></td>
                        <td class="node-right" rowspan="8"><div class="lines"></div><div class="lines"></div></td>
                        <td class="node-right" rowspan="16"><div class="lines"></div><div class="lines"></div></td>
                        <td class="node-right" rowspan="32"><div class="lines"></div><div class="lines"></div></td>
                        <td rowspan="16"></td>
                        <td rowspan="19"></td>
                        <td rowspan="16"></td>
                        <td class="node-left" rowspan="32"><div class="lines"></div><div class="lines"></div></td>
                        <td class="node-left" rowspan="16"><div class="lines"></div><div class="lines"></div></td>
                        <td class="node-left" rowspan="8"><div class="lines"></div><div class="lines"></div></td>
                        <td class="node-left" rowspan="4"><div class="lines"></div><div class="lines"></div></td>
                        <td class="node-left" rowspan="2">from</td>
                    </tr>
                    <tr>
                        <td class="node-right">max_fee_per_gas</td>
                    </tr>
                    <tr>
                        <td class="node-right">gas</td>
                        <td class="node-right" rowspan="2"><div class="lines"></div><div class="lines"></div></td>
                        <td class="node-left" rowspan="2">ecdsa_signature</td>
                    </tr>
                    <tr>
                        <td class="node-right">to</td>
                    </tr>
                    <tr>
                        <td class="node-right">value</td>
                        <td class="node-right" rowspan="2"><div class="lines"></div><div class="lines"></div></td>
                        <td class="node-right" rowspan="4"><div class="lines"></div><div class="lines"></div></td>
                        <td class="node-left" rowspan="4"><div class="lines"></div><div class="lines"></div></td>
                        <td class="node-left" rowspan="2">no_replay_protection</td>
                    </tr>
                    <tr>
                        <td class="node-right">input</td>
                    </tr>
                    <tr>
                        <td class="node-right">access_list</td>
                        <td class="node-right" rowspan="2"><div class="lines"></div><div class="lines"></div></td>
                        <td class="node-left" rowspan="2">type</td>
                    </tr>
                    <tr>
                        <td class="node-right">max_priority_fee_per_gas</td>
                    </tr>
                    <tr>
                        <td class="node-right">max_fee_per_blob_gas</td>
                        <td class="node-right" rowspan="2"><div class="lines"></div><div class="lines"></div></td>
                        <td class="node-right" rowspan="4"><div class="lines"></div><div class="lines"></div></td>
                        <td class="node-right" rowspan="8"><div class="lines"></div><div class="lines"></div></td>
                        <td class="node-left" rowspan="8"><div class="lines"></div><div class="lines"></div></td>
                        <td class="node-left" rowspan="4"><div class="lines"></div><div class="lines"></div></td>
                        <td class="node-left unused" rowspan="2">0</td>
                    </tr>
                    <tr>
                        <td class="node-right">blob_versioned_hashes</td>
                    </tr>
                    <tr>
                        <td class="node-right unused">0</td>
                        <td class="node-right" rowspan="2"><div class="lines"></div><div class="lines"></div></td>
                        <td class="node-left unused" rowspan="2">0</td>
                    </tr>
                    <tr>
                        <td class="node-right unused">0</td>
                    </tr>
                    <tr>
                        <td class="node-right unused">0</td>
                        <td class="node-right" rowspan="2"><div class="lines"></div><div class="lines"></div></td>
                        <td class="node-right" rowspan="4"><div class="lines"></div><div class="lines"></div></td>
                        <td class="node-left" rowspan="4"><div class="lines"></div><div class="lines"></div></td>
                        <td class="node-left unused" rowspan="2">0</td>
                    </tr>
                    <tr>
                        <td class="node-right unused">0</td>
                    </tr>
                    <tr>
                        <td class="node-right unused">0</td>
                        <td class="node-right" rowspan="2"><div class="lines"></div><div class="lines"></div></td>
                        <td class="node-left unused" rowspan="2">0</td>
                    </tr>
                    <tr>
                        <td class="node-right unused">0</td>
                    </tr>
                    <tr>
                        <td class="node-right unused">0</td>
                        <td class="node-right" rowspan="2"><div class="lines"></div><div class="lines"></div></td>
                        <td class="node-right" rowspan="4"><div class="lines"></div><div class="lines"></div></td>
                        <td class="node-right" rowspan="8"><div class="lines"></div><div class="lines"></div></td>
                        <td class="node-right" rowspan="16"><div class="lines"></div><div class="lines"></div></td>
                        <td class="node-right" rowspan="17"><div class="lines"></div><div class="lines"></div><div>payload</div></td>
                        <td class="node-left" rowspan="17"><div class="lines"></div><div class="lines"></div><div>signature</div></td>
                        <td class="node-left" rowspan="16"><div class="lines"></div><div class="lines"></div></td>
                        <td class="node-left" rowspan="8"><div class="lines"></div><div class="lines"></div></td>
                        <td class="node-left" rowspan="4"><div class="lines"></div><div class="lines"></div></td>
                        <td class="node-left unused" rowspan="2">0</td>
                    </tr>
                    <tr>
                        <td class="node-right unused">0</td>
                    </tr>
                    <tr>
                        <td class="node-right unused">0</td>
                        <td class="node-right" rowspan="2"><div class="lines"></div><div class="lines"></div></td>
                        <td class="node-left unused" rowspan="2">0</td>
                    </tr>
                    <tr>
                        <td class="node-right unused">0</td>
                        <td class="node-bottom" rowspan="4" style="width: 100px;"><div class="lines"></div><div class="lines"></div>root</td>
                    </tr>
                    <tr>
                        <td class="node-right unused">0</td>
                        <td class="node-right" rowspan="2"><div class="lines"></div><div class="lines"></div></td>
                        <td class="node-right" rowspan="4"><div class="lines"></div><div class="lines"></div></td>
                        <td class="node-left" rowspan="4"><div class="lines"></div><div class="lines"></div></td>
                        <td class="node-left unused" rowspan="2">0</td>
                    </tr>
                    <tr>
                        <td class="node-right unused">0</td>
                    </tr>
                    <tr>
                        <td class="node-right unused">0</td>
                        <td class="node-right" rowspan="2"><div class="lines"></div><div class="lines"></div></td>
                        <td class="node-left unused" rowspan="2">0</td>
                    </tr>
                    <tr>
                        <td class="node-right unused">0</td>
                        <td rowspan="12"></td>
                    </tr>
                    <tr>
                        <td class="node-right unused">0</td>
                        <td class="node-right" rowspan="2"><div class="lines"></div><div class="lines"></div></td>
                        <td class="node-right" rowspan="4"><div class="lines"></div><div class="lines"></div></td>
                        <td class="node-right" rowspan="8"><div class="lines"></div><div class="lines"></div></td>
                        <td class="node-left" rowspan="8"><div class="lines"></div><div class="lines"></div></td>
                        <td class="node-left" rowspan="4"><div class="lines"></div><div class="lines"></div></td>
                        <td class="node-left unused" rowspan="2">0</td>
                    </tr>
                    <tr>
                        <td class="node-right unused">0</td>
                    </tr>
                    <tr>
                        <td class="node-right unused">0</td>
                        <td class="node-right" rowspan="2"><div class="lines"></div><div class="lines"></div></td>
                        <td class="node-left unused" rowspan="2">0</td>
                    </tr>
                    <tr>
                        <td class="node-right unused">0</td>
                    </tr>
                    <tr>
                        <td class="node-right unused">0</td>
                        <td class="node-right" rowspan="2"><div class="lines"></div><div class="lines"></div></td>
                        <td class="node-right" rowspan="4"><div class="lines"></div><div class="lines"></div></td>
                        <td class="node-left" rowspan="4"><div class="lines"></div><div class="lines"></div></td>
                        <td class="node-left unused" rowspan="2">0</td>
                    </tr>
                    <tr>
                        <td class="node-right unused">0</td>
                    </tr>
                    <tr>
                        <td class="node-right unused">0</td>
                        <td class="node-right" rowspan="2"><div class="lines"></div><div class="lines"></div></td>
                        <td class="node-left unused" rowspan="2">0</td>
                    </tr>
                    <tr>
                        <td class="node-right unused">0</td>
                    </tr>
                    <tr>
                        <td class="node-right" colspan="6">active_fields</td>
                        <td class="node-left" colspan="5">active_fields</td>
                    </tr>
                </table>
            </div>
        </div>
    </div>

    <script>
        const networkMetadataPath = 'https://raw.githubusercontent.com/eth-clients/eth2-networks/master/shared/mainnet';

        async function loadCfg() {
            let response = undefined;
            do {
                if (response !== undefined) {
                    await new Promise(r => setTimeout(r, 5000));
                }
                response = await fetch(networkMetadataPath + '/config.yaml');
            } while (!response.ok);

            const data = await response.text();

            const fileContent = Module.stringToNewUTF8(data);
            const cfg = Module._ETHConsensusConfigCreateFromYaml(fileContent);
            assert(cfg);
            Module._free(fileContent);

            return cfg;
        }

        async function loadGenesis(cfg) {
            const consensusFork = Module._ETHConsensusConfigGetConsensusVersionAtEpoch(cfg, /* epoch: */ 0);
            const response = await fetch(networkMetadataPath + '/genesis.ssz');
            assert(response.ok);
            const data = await response.arrayBuffer();
            const sszBytes = new Uint8Array(data)

            const sszBytesPtr = Module._malloc(sszBytes.length);
            Module.HEAPU8.set(sszBytes, sszBytesPtr);
            const state = Module._ETHBeaconStateCreateFromSsz(cfg, consensusFork, sszBytesPtr, sszBytes.length);
            assert(state);
            Module._free(sszBytesPtr);

            return state;
        }

        var Module = {};

        let beaconApiBase = undefined;
        let executionApiBase = undefined;

        const zeroHash = '0x0000000000000000000000000000000000000000000000000000000000000000';

        function toArray(bytes, numBytes) {
            return Array.from(Module.HEAPU8.subarray(bytes, bytes + numBytes));
        }

        function byteToHexString(byte) {
            return byte.toString(16).padStart(2, '0');
        }

        function arrayToHexString(array) {
            return array.reduce((str, byte) => str + byte.toString(16).padStart(2, '0'), '');
        }

        function toHexString(bytes, numBytes) {
            return '0x' + arrayToHexString(toArray(bytes, numBytes));
        }

        function arrayToDecString(array) {
            if (array.length === 0) {
                return '0';
            }
            return BigInt('0x' + arrayToHexString(array)).toString();
        }

        function toDecString(bytes, numBytes) {
            return BigInt('0x' + arrayToHexString(toArray(bytes, numBytes).reverse())).toString();
        }

        function arrayToBinString(array) {
            return array.reduce((str, byte) => str + byte.toString(2).padStart(8, '0').split('').reverse().join(''), '');
        }

        function toHumanReadableByteCountString(numBytes) {
            if (numBytes >= 1e12) {
                return (numBytes / 1e12).toFixed(1) + ' TB';
            }
            if (numBytes >= 1e11) {
                return (numBytes / 1e9).toFixed(0) + ' GB';
            }
            if (numBytes >= 1e9) {
                return (numBytes / 1e9).toFixed(1) + ' GB';
            }
            if (numBytes >= 1e8) {
                return (numBytes / 1e6).toFixed(0) + ' MB';
            }
            if (numBytes >= 1e6) {
                return (numBytes / 1e6).toFixed(1) + ' MB';
            }
            if (numBytes >= 1e5) {
                return (numBytes / 1e3).toFixed(0) + ' KB';
            }
            if (numBytes >= 1e3) {
                return (numBytes / 1e3).toFixed(1) + ' KB';
            }
            if (numBytes == 1) {
                return numBytes + ' byte';
            }
            return numBytes + ' bytes';
        }

        function toHumanReadableNumberString(number) {
            if (number >= 1e12) {
                return (number / 1e12).toFixed(1) + 'T';
            }
            if (number >= 1e11) {
                return (number / 1e9).toFixed(0) + 'T';
            }
            if (number >= 1e9) {
                return (number / 1e9).toFixed(1) + 'B';
            }
            if (number >= 1e8) {
                return (number / 1e6).toFixed(0) + 'M';
            }
            if (number >= 1e6) {
                return (number / 1e6).toFixed(1) + 'M';
            }
            if (number >= 1e5) {
                return (number / 1e3).toFixed(0) + 'K';
            }
            if (number >= 1e3) {
                return (number / 1e3).toFixed(1) + 'K';
            }
            return number.toString();
        }

        function toDateString(timestamp) {
            const date = new Date(timestamp * 1000);
            const year = date.getFullYear();
            const month = ('0' + (date.getMonth() + 1)).slice(-2);
            const day = ('0' + date.getDate()).slice(-2);
            const hours = ('0' + date.getHours()).slice(-2);
            const minutes = ('0' + date.getMinutes()).slice(-2);
            const seconds = ('0' + date.getSeconds()).slice(-2);
            return `${year}-${month}-${day} ${hours}:${minutes}:${seconds}`;
        }

        function arrayToGweiString(array) {
            if (array.length === 0) {
                return '0';
            }
            const wei = BigInt('0x' + array.reduce((str, byte) => str + byte.toString(16).padStart(2, '0'), ''));
            const weiString = wei.toString().padStart(9, '0');
            const beforeDecimal = weiString.substring(0, weiString.length - 9);
            if (beforeDecimal === '') {
                return '0';
            }
            return beforeDecimal;
        }

        function toGweiString(bytes, numBytes) {
            return arrayToGweiString(Array.from(Module.HEAPU8.subarray(bytes, bytes + numBytes)).reverse());
        }

        function arrayToEthString(array) {
            if (array.length === 0) {
                return '0';
            }
            const wei = BigInt('0x' + array.reduce((str, byte) => str + byte.toString(16).padStart(2, '0'), ''));
            const weiString = wei.toString().padStart(18, '0');
            const beforeDecimal = weiString.substring(0, weiString.length - 18);
            const afterDecimal = weiString.substring(weiString.length - 18).replace(/0+$/, '');
            if (beforeDecimal === '') {
                if (afterDecimal === '') {
                    return '0';
                }
                return '0.' + afterDecimal;
            }
            if (afterDecimal === '') {
                return beforeDecimal;
            }
            return beforeDecimal + '.' + afterDecimal;
        }

        function toEthString(bytes, numBytes) {
            return arrayToEthString(Array.from(Module.HEAPU8.subarray(bytes, bytes + numBytes)).reverse());
        }

        function getBeaconRoot(header) {
            const beaconRoot = Module._ETHLightClientHeaderCopyBeaconRoot(header, cfg);
            const beaconRootString = toHexString(beaconRoot, 32);
            Module._ETHRootDestroy(beaconRoot);
            return beaconRootString;
        }

        function getBeaconSlot(header) {
            const beacon = Module._ETHLightClientHeaderGetBeacon(header);
            return Module._ETHBeaconBlockHeaderGetSlot(beacon);
        }

        function initHeadersCache() {
            let headers = [];
            let byRoot = {};
            let executionBlocks = {};

            return {
                'add': function (header, cfg) {
                    const beaconRoot = getBeaconRoot(header);
                    if (byRoot[beaconRoot]) {
                        return;
                    }

                    const beaconSlot = getBeaconSlot(header);
                    const i = headers.findIndex(x => (beaconSlot > getBeaconSlot(x)) ||
                        (beaconSlot == getBeaconSlot && beaconRoot < getBeaconRoot(x)));
                    const copy = Module._ETHLightClientHeaderCreateCopy(header)
                    headers.splice(i >= 0 ? i : headers.length, 0, copy);
                    byRoot[beaconRoot] = copy;

                    if (headers.length > 128) {
                        const removedHeader = headers.pop();
                        const removedBeaconRoot = getBeaconRoot(removedHeader);

                        const removedExecutionBlock = executionBlocks[removedBeaconRoot];
                        if (removedExecutionBlock) {
                            const [removedExecutionBlockHeader, removedTransactions] = removedExecutionBlock;
                            delete executionBlocks[removedBeaconRoot];
                            Module._ETHTransactionsDestroy(removedTransactions);
                            Module._ETHExecutionBlockHeaderDestroy(removedExecutionBlockHeader);
                        }

                        delete byRoot[removedBeaconRoot];
                        Module._ETHLightClientHeaderDestroy(removedHeader);
                    }
                },

                'getAll': function () {
                    return headers;
                },

                'get': function (beaconRoot) {
                    return byRoot[beaconRoot];
                },

                'setExecutionBlock': function (beaconRoot, executionBlock) {
                    executionBlocks[beaconRoot] = executionBlock;
                },

                'getExecutionBlock': function (beaconRoot) {
                    return executionBlocks[beaconRoot];
                }
            };
        }

        let headers = initHeadersCache();

        async function fetchExecutionBlock(header) {
            const executionHash = Module._ETHLightClientHeaderCopyExecutionHash(header, cfg);
            try {
                const executionHashString = toHexString(executionHash, 32);
                if (executionHashString == zeroHash) return;
                const beaconRoot = getBeaconRoot(header);
                let executionBlock = headers.getExecutionBlock(beaconRoot);
                if (executionBlock) {
                    return executionBlock;
                }

                let data;
                try {
                    const executionBlockResponse = await fetch(executionApiBase, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                            jsonrpc: '2.0',
                            id: 1,
                            method: 'eth_getBlockByHash',
                            params: [executionHashString, /* fullTransactions: */ true]
                        })
                    });
                    if (!executionBlockResponse.ok) return;
                    const executionBlockJson = await executionBlockResponse.json();
                    if (!executionBlockJson.result) return;
                    data = executionBlockJson.result;
                } catch {
                    return;
                }
                if (!headers.get(beaconRoot)) return;

                const fullTransactions = JSON.stringify(data.transactions);
                for (txIndex in data.transactions) {
                    data.transactions[txIndex] = data.transactions[txIndex].hash;
                }
                const blockHeaderJson = Module.stringToNewUTF8(JSON.stringify(data));
                const executionBlockHeader = Module._ETHExecutionBlockHeaderCreateFromJson(executionHash, blockHeaderJson);
                Module._free(blockHeaderJson);
                if (!executionBlockHeader) return;

                const executionTransactionsRoot = Module._ETHExecutionBlockHeaderGetTransactionsRoot(executionBlockHeader);
                const transactionsJson = Module.stringToNewUTF8(fullTransactions);
                const transactions = Module._ETHTransactionsCreateFromJson(executionTransactionsRoot, transactionsJson);
                Module._free(transactionsJson);
                if (!transactions) {
                    Module._ETHExecutionBlockHeaderDestroy(executionBlockHeader);
                    return;
                }

                executionBlock = [executionBlockHeader, transactions];
                headers.setExecutionBlock(beaconRoot, executionBlock);
                return executionBlock;
            } finally {
                Module._ETHRootDestroy(executionHash);
            }
        }

        function toRlpInteger(b) {
            const length = b.length;
            assert(length > 0);
            if (length == 1) {
                return b[0];
            }
            return b[length - 1] + toRlpInteger(b.slice(0, -1)) * 256
        }

        function decodeRlpLength(input) {
            const length = input.length;
            assert(length > 0);
            const prefix = input[0];
            if (prefix <= 0x7f) {
                return {
                    'offset': 0,
                    'dataLen': 1,
                    'type': 'str'
                };
            }
            if (prefix <= 0xb7 && length > prefix - 0x80) {
                const strLen = prefix - 0x80;
                return {
                    'offset': 1,
                    'dataLen': strLen,
                    'type': 'str'
                };
            }
            if (prefix <= 0xbf && length > prefix - 0xb7 && length > prefix - 0xb7 + toRlpInteger(input.slice(1, 1 + prefix - 0xb7))) {
                const lenOfStrLen = prefix - 0xb7;
                const strLen = toRlpInteger(input.slice(1, 1 + lenOfStrLen));
                return {
                    'offset': 1 + lenOfStrLen,
                    'dataLen': strLen,
                    'type': 'str'
                };
            }
            if (prefix <= 0xf7 && length > prefix - 0xc0) {
                const listLen = prefix - 0xc0;
                return {
                    'offset': 1,
                    'dataLen': listLen,
                    'type': 'list'
                };
            }
            if (prefix <= 0xff && length > prefix - 0xf7 && length > prefix - 0xf7 + toRlpInteger(input.slice(1, 1 + prefix - 0xf7))) {
                const lenOfListLen = prefix - 0xf7;
                const listLen = toRlpInteger(input.slice(1, 1 + lenOfListLen));
                return {
                    'offset': 1 + lenOfListLen,
                    'dataLen': listLen,
                    'type': 'list'
                };
            }
            assert(false);
        }

        function visualizeTransactionRlp(transactionHash, transactionBytes) {
            document.getElementById('selectedTransactionRlpHash').innerHTML =
                '<a href="https://etherscan.io/tx/' + transactionHash + '" target="_blank">' +
                transactionHash + '</a>';

            let bytes = transactionBytes;
            assert(bytes.length > 0);
            const eip2718Type = bytes[0];

            if (eip2718Type === 0x02) {
                document.getElementById('selectedTransactionRlpHasEip2718Type').hidden = false;
                document.getElementById('selectedTransactionRlpEip2718Type').innerText = byteToHexString(eip2718Type);
                document.getElementById('selectedTransactionRlpEip2718TypeDescription').innerHTML =
                    '<a href="https://eips.ethereum.org/EIPS/eip-1559" target="_blank">EIP-1559</a>';
                bytes = bytes.slice(1);
            } else if (eip2718Type === 0x01) {
                document.getElementById('selectedTransactionRlpHasEip2718Type').hidden = false;
                document.getElementById('selectedTransactionRlpEip2718Type').innerText = byteToHexString(eip2718Type);
                document.getElementById('selectedTransactionRlpEip2718TypeDescription').innerHTML =
                    '<a href="https://eips.ethereum.org/EIPS/eip-2930" target="_blank">EIP-2930</a>';
                bytes = bytes.slice(1);
            } else if (eip2718Type >= 0xc0 && eip2718Type <= 0xfe) {
                document.getElementById('selectedTransactionRlpHasEip2718Type').hidden = true;
            } else {
                assert(false);
            }

            const lengthInfo = decodeRlpLength(bytes);
            assert(lengthInfo.type === 'list');
            assert(lengthInfo.offset + lengthInfo.dataLen === bytes.length);
            const length = bytes.slice(0, lengthInfo.offset);
            bytes = bytes.slice(lengthInfo.offset);
            document.getElementById('selectedTransactionRlpLength').innerText = arrayToHexString(length);
            document.getElementById('selectedTransactionRlpLengthDescription').innerText = lengthInfo.dataLen + ' bytes';

            if (eip2718Type === 0x02 || eip2718Type === 0x01) {
                const chainIdInfo = decodeRlpLength(bytes);
                assert(chainIdInfo.type === 'str');
                const chainIdLength = bytes.slice(0, chainIdInfo.offset);
                bytes = bytes.slice(chainIdInfo.offset);
                const chainId = bytes.slice(0, chainIdInfo.dataLen);
                bytes = bytes.slice(chainIdInfo.dataLen);
                document.getElementById('selectedTransactionRlpHasChainId').hidden = false;
                document.getElementById('selectedTransactionRlpChainIdLength').innerText = arrayToHexString(chainIdLength);
                document.getElementById('selectedTransactionRlpChainId').innerText = arrayToHexString(chainId);
            } else {
                document.getElementById('selectedTransactionRlpHasChainId').hidden = true;
            }

            const nonceInfo = decodeRlpLength(bytes);
            assert(nonceInfo.type === 'str');
            const nonceLength = bytes.slice(0, nonceInfo.offset);
            bytes = bytes.slice(nonceInfo.offset);
            const nonce = bytes.slice(0, nonceInfo.dataLen);
            bytes = bytes.slice(nonceInfo.dataLen);
            document.getElementById('selectedTransactionRlpNonceLength').innerText = arrayToHexString(nonceLength);
            document.getElementById('selectedTransactionRlpNonce').innerText = arrayToHexString(nonce);
            document.getElementById('selectedTransactionRlpNonceDescription').innerText = arrayToDecString(nonce);

            if (eip2718Type === 0x02) {
                const maxPriorityFeePerGasInfo = decodeRlpLength(bytes);
                assert(maxPriorityFeePerGasInfo.type === 'str');
                const maxPriorityFeePerGasLength = bytes.slice(0, maxPriorityFeePerGasInfo.offset);
                bytes = bytes.slice(maxPriorityFeePerGasInfo.offset);
                const maxPriorityFeePerGas = bytes.slice(0, maxPriorityFeePerGasInfo.dataLen);
                bytes = bytes.slice(maxPriorityFeePerGasInfo.dataLen);
                document.getElementById('selectedTransactionRlpHasMaxPriorityFeePerGas').hidden = false;
                document.getElementById('selectedTransactionRlpMaxPriorityFeePerGasLength').innerText = arrayToHexString(maxPriorityFeePerGasLength);
                document.getElementById('selectedTransactionRlpMaxPriorityFeePerGas').innerText = arrayToHexString(maxPriorityFeePerGas);
                document.getElementById('selectedTransactionRlpMaxPriorityFeePerGasDescription').innerText = arrayToGweiString(maxPriorityFeePerGas) + ' Gwei';
            } else {
                document.getElementById('selectedTransactionRlpHasMaxPriorityFeePerGas').hidden = true;
            }

            const maxFeePerGasInfo = decodeRlpLength(bytes);
            assert(maxFeePerGasInfo.type === 'str');
            const maxFeePerGasLength = bytes.slice(0, maxFeePerGasInfo.offset);
            bytes = bytes.slice(maxFeePerGasInfo.offset);
            const maxFeePerGas = bytes.slice(0, maxFeePerGasInfo.dataLen);
            bytes = bytes.slice(maxFeePerGasInfo.dataLen);
            document.getElementById('selectedTransactionRlpMaxFeePerGasLength').innerText = arrayToHexString(maxFeePerGasLength);
            document.getElementById('selectedTransactionRlpMaxFeePerGas').innerText = arrayToHexString(maxFeePerGas);
            document.getElementById('selectedTransactionRlpMaxFeePerGasDescription').innerText = arrayToGweiString(maxFeePerGas) + ' Gwei';

            const gasInfo = decodeRlpLength(bytes);
            assert(gasInfo.type === 'str');
            const gasLength = bytes.slice(0, gasInfo.offset);
            bytes = bytes.slice(gasInfo.offset);
            const gas = bytes.slice(0, gasInfo.dataLen);
            bytes = bytes.slice(gasInfo.dataLen);
            document.getElementById('selectedTransactionRlpGasLength').innerText = arrayToHexString(gasLength);
            document.getElementById('selectedTransactionRlpGas').innerText = arrayToHexString(gas);
            document.getElementById('selectedTransactionRlpGasDescription').innerText = toHumanReadableNumberString(Number(arrayToDecString(gas)));

            const toInfo = decodeRlpLength(bytes);
            assert(toInfo.type === 'str');
            const toLength = bytes.slice(0, toInfo.offset);
            bytes = bytes.slice(toInfo.offset);
            const to = bytes.slice(0, toInfo.dataLen);
            bytes = bytes.slice(toInfo.dataLen);
            document.getElementById('selectedTransactionRlpToLength').innerText = arrayToHexString(toLength);
            document.getElementById('selectedTransactionRlpTo').innerText = arrayToHexString(to);
            if (to.length > 0) {
                document.getElementById('selectedTransactionRlpToDescription').innerHTML =
                    '<a href="https://etherscan.io/address/0x' + arrayToHexString(to) + '" target="_blank">' +
                    'Destination' + '</a>';
            } else {
                document.getElementById('selectedTransactionRlpToDescription').innerText = 'Create';
            }

            const valueInfo = decodeRlpLength(bytes);
            assert(valueInfo.type === 'str');
            const valueLength = bytes.slice(0, valueInfo.offset);
            bytes = bytes.slice(valueInfo.offset);
            const value = bytes.slice(0, valueInfo.dataLen);
            bytes = bytes.slice(valueInfo.dataLen);
            document.getElementById('selectedTransactionRlpValueLength').innerText = arrayToHexString(valueLength);
            document.getElementById('selectedTransactionRlpValue').innerText = arrayToHexString(value);
            document.getElementById('selectedTransactionRlpValueDescription').innerText = arrayToEthString(value) + ' ETH';

            const inputInfo = decodeRlpLength(bytes);
            assert(inputInfo.type === 'str');
            const inputLength = bytes.slice(0, inputInfo.offset);
            bytes = bytes.slice(inputInfo.offset);
            const input = bytes.slice(0, inputInfo.dataLen);
            bytes = bytes.slice(inputInfo.dataLen);
            document.getElementById('selectedTransactionRlpInputLength').innerText = arrayToHexString(inputLength);
            if (inputInfo.dataLen > 0) {
                document.getElementById('selectedTransactionRlpInput').innerHTML =
                    '<br />' + (arrayToHexString(input).match(/.{1,64}/g) ?? []).join('<br />');
            } else {
                document.getElementById('selectedTransactionRlpInput').innerText = arrayToHexString(input);
            }
            document.getElementById('selectedTransactionRlpInputDescription').innerText = toHumanReadableByteCountString(inputInfo.dataLen);

            if (eip2718Type === 0x02 || eip2718Type === 0x01) {
                const accessListInfo = decodeRlpLength(bytes);
                assert(accessListInfo.type === 'list');
                const accessListLength = bytes.slice(0, accessListInfo.offset);
                bytes = bytes.slice(accessListInfo.offset);
                let accessList = bytes.slice(0, accessListInfo.dataLen);
                bytes = bytes.slice(accessListInfo.dataLen);
                document.getElementById('selectedTransactionRlpHasAccessList').hidden = false;
                document.getElementById('selectedTransactionRlpAccessListLength').innerText = arrayToHexString(accessListLength);
                document.getElementById('selectedTransactionRlpAccessListDescription').innerHTML = toHumanReadableByteCountString(accessListInfo.dataLen);
                document.getElementById('selectedTransactionRlpAccessList').innerHTML = '';
                document.getElementById('selectedTransactionRlpAccessListLabel').innerHTML = '';

                let accessTupleIndex = 0;
                while (accessList.length) {
                    const accessTupleInfo = decodeRlpLength(accessList);
                    assert(accessTupleInfo.type === 'list');
                    const accessTupleLength = accessList.slice(0, accessTupleInfo.offset);
                    accessList = accessList.slice(accessTupleInfo.offset);
                    let accessTuple = accessList.slice(0, accessTupleInfo.dataLen);
                    accessList = accessList.slice(accessTupleInfo.dataLen);
                    document.getElementById('selectedTransactionRlpAccessList').innerHTML +=
                        '<br /><span>' + arrayToHexString(accessTupleLength) + '</span> ' +
                        '<span class="description">(' + toHumanReadableByteCountString(accessTupleInfo.dataLen) + ')</span>';
                    document.getElementById('selectedTransactionRlpAccessListLabel').innerHTML +=
                        '<br /><span>[' + accessTupleIndex + ']</span>';

                    const addressInfo = decodeRlpLength(accessTuple);
                    assert(addressInfo.type === 'str');
                    const addressLength = accessTuple.slice(0, addressInfo.offset);
                    accessTuple = accessTuple.slice(addressInfo.offset);
                    const address = accessTuple.slice(0, addressInfo.dataLen);
                    accessTuple = accessTuple.slice(addressInfo.dataLen);
                    document.getElementById('selectedTransactionRlpAccessList').innerHTML +=
                        '<br /><span>' + arrayToHexString(addressLength) + '</span> ' +
                        '<span>' + arrayToHexString(address) + '</span>';
                    document.getElementById('selectedTransactionRlpAccessListLabel').innerHTML +=
                        '<br /><span><a href="https://etherscan.io/address/0x' + arrayToHexString(address) + '" target="_blank">Address</a></span>';

                    const storageKeysInfo = decodeRlpLength(accessTuple);
                    assert(storageKeysInfo.type === 'list');
                    const storageKeysLength = accessTuple.slice(0, storageKeysInfo.offset);
                    accessTuple = accessTuple.slice(storageKeysInfo.offset);
                    let storageKeys = accessTuple.slice(0, storageKeysInfo.dataLen);
                    accessTuple = accessTuple.slice(storageKeysInfo.dataLen);
                    document.getElementById('selectedTransactionRlpAccessList').innerHTML +=
                        '<br /><span>' + arrayToHexString(storageKeysLength) + '</span> ' +
                        '<span class="description">(' + toHumanReadableByteCountString(storageKeysInfo.dataLen) + ')</span>';
                    document.getElementById('selectedTransactionRlpAccessListLabel').innerHTML +=
                        '<br /><span>Storage keys</span>';

                    while (storageKeys.length) {
                        const storageKeyInfo = decodeRlpLength(storageKeys);
                        assert(storageKeyInfo.type === 'str');
                        const storageKeyLength = storageKeys.slice(0, storageKeyInfo.offset);
                        storageKeys = storageKeys.slice(storageKeyInfo.offset);
                        const storageKey = storageKeys.slice(0, storageKeyInfo.dataLen);
                        storageKeys = storageKeys.slice(storageKeyInfo.dataLen);
                        document.getElementById('selectedTransactionRlpAccessList').innerHTML +=
                            '<br /><span>' + arrayToHexString(storageKeyLength) + '</span> ' +
                            '<span>' + arrayToHexString(storageKey) + '</span>';
                        document.getElementById('selectedTransactionRlpAccessListLabel').innerHTML += '<br />';
                    }

                    assert(accessTuple.length === 0);
                    accessTupleIndex++;
                }
            } else {
                document.getElementById('selectedTransactionRlpHasAccessList').hidden = true;
            }

            const vInfo = decodeRlpLength(bytes);
            assert(vInfo.type === 'str');
            const vLength = bytes.slice(0, vInfo.offset);
            bytes = bytes.slice(vInfo.offset);
            const v = bytes.slice(0, vInfo.dataLen);
            bytes = bytes.slice(vInfo.dataLen);
            document.getElementById('selectedTransactionRlpVLength').innerText = arrayToHexString(vLength);
            document.getElementById('selectedTransactionRlpV').innerText = arrayToHexString(v);
            const vNumber = Number(arrayToDecString(v));
            let yParity;
            if (eip2718Type === 0x02 || eip2718Type === 0x01) {
                assert(vNumber === 0x00 || vNumber === 0x01);
                yParity = vNumber;
                document.getElementById('selectedTransactionRlpVDescription').innerText =
                    'Y parity: ' + yParity.toString(16).padStart(2, '0');
            } else {
                yParity = 1 - (vNumber & 0x1);
                if (vNumber === 27 || vNumber === 28) {
                    document.getElementById('selectedTransactionRlpVDescription').innerText =
                        'Y parity: ' + yParity.toString(16).padStart(2, '0') +
                        ' - No replay protection';
                } else {
                    const recoveredChainId = Math.floor((vNumber - 35) / 2);
                    document.getElementById('selectedTransactionRlpVDescription').innerText =
                        'Y parity: ' + yParity.toString(16).padStart(2, '0') +
                        ' - Chain ID: ' + recoveredChainId.toString(16).padStart(2, '0');
                }
            }

            const rInfo = decodeRlpLength(bytes);
            assert(rInfo.type === 'str');
            const rLength = bytes.slice(0, rInfo.offset);
            bytes = bytes.slice(rInfo.offset);
            const r = bytes.slice(0, rInfo.dataLen);
            bytes = bytes.slice(rInfo.dataLen);
            document.getElementById('selectedTransactionRlpRLength').innerText = arrayToHexString(rLength);
            document.getElementById('selectedTransactionRlpR').innerText = arrayToHexString(r);

            const sInfo = decodeRlpLength(bytes);
            assert(sInfo.type === 'str');
            const sLength = bytes.slice(0, sInfo.offset);
            bytes = bytes.slice(sInfo.offset);
            const s = bytes.slice(0, sInfo.dataLen);
            bytes = bytes.slice(sInfo.dataLen);
            document.getElementById('selectedTransactionRlpSLength').innerText = arrayToHexString(sLength);
            document.getElementById('selectedTransactionRlpS').innerText = arrayToHexString(s);

            assert(bytes.length === 0);
        }

        function visualizeTransactionEip6404(transactionEip6404Root, transactionEip6404Bytes) {
            document.getElementById('selectedTransactionEip6404Root').innerText = transactionEip6404Root;

            let bytes = transactionEip6404Bytes;

            assert(bytes.length >= 4);
            const payloadOffset = bytes.slice(0, 4);
            bytes = bytes.slice(4);
            document.getElementById('selectedTransactionEip6404PayloadOffset').innerText = arrayToHexString(payloadOffset);
            document.getElementById('selectedTransactionEip6404PayloadOffsetDescription').innerText = arrayToDecString(payloadOffset.reverse());

            assert(bytes.length >= 4);
            const signatureOffset = bytes.slice(0, 4);
            bytes = bytes.slice(4);
            document.getElementById('selectedTransactionEip6404SignatureOffset').innerText = arrayToHexString(signatureOffset);
            document.getElementById('selectedTransactionEip6404SignatureOffsetDescription').innerText = arrayToDecString(signatureOffset.reverse());

            const numPayloadBytes = Number(arrayToDecString(signatureOffset)) - Number(arrayToDecString(payloadOffset));
            let payload = bytes.slice(0, numPayloadBytes);
            bytes = bytes.slice(numPayloadBytes);
            const numSignatureBytes = bytes.length;
            let signature = bytes.slice(0, numSignatureBytes);
            bytes = bytes.slice(numSignatureBytes);
            assert(bytes.length === 0);

            const payloadOffsets = [];

            assert(payload.length >= 4);
            const payloadActiveFields = payload.slice(0, 4);
            payload = payload.slice(4);
            document.getElementById('selectedTransactionEip6404PayloadActiveFields').innerText = arrayToHexString(payloadActiveFields);
            document.getElementById('selectedTransactionEip6404PayloadActiveFieldsDescription').innerText = '0b' + arrayToBinString(payloadActiveFields);

            if (payloadActiveFields[0] & 0x01) {
                assert(payload.length >= 8);
                const payloadNonce = payload.slice(0, 8);
                payload = payload.slice(8);
                document.getElementById('selectedTransactionEip6404PayloadHasNonce').hidden = false;
                document.getElementById('selectedTransactionEip6404PayloadNonce').innerText = arrayToHexString(payloadNonce);
                document.getElementById('selectedTransactionEip6404PayloadNonceDescription').innerText = arrayToDecString(payloadNonce.reverse());
            } else {
                document.getElementById('selectedTransactionEip6404PayloadHasNonce').hidden = true;
            }

            if (payloadActiveFields[0] & 0x02) {
                assert(payload.length >= 32);
                const payloadMaxFeePerGas = payload.slice(0, 32);
                payload = payload.slice(32);
                document.getElementById('selectedTransactionEip6404PayloadHasMaxFeePerGas').hidden = false;
                document.getElementById('selectedTransactionEip6404PayloadMaxFeePerGas').innerText = arrayToHexString(payloadMaxFeePerGas);
                document.getElementById('selectedTransactionEip6404PayloadMaxFeePerGasDescription').innerText = arrayToGweiString(payloadMaxFeePerGas.reverse()) + ' Gwei';
            } else {
                document.getElementById('selectedTransactionEip6404PayloadHasMaxFeePerGas').hidden = true;
            }

            if (payloadActiveFields[0] & 0x04) {
                assert(payload.length >= 8);
                const payloadGas = payload.slice(0, 8);
                payload = payload.slice(8);
                document.getElementById('selectedTransactionEip6404PayloadHasGas').hidden = false;
                document.getElementById('selectedTransactionEip6404PayloadGas').innerText = arrayToHexString(payloadGas);
                document.getElementById('selectedTransactionEip6404PayloadGasDescription').innerText = toHumanReadableNumberString(Number(arrayToDecString(payloadGas.reverse())));
            } else {
                document.getElementById('selectedTransactionEip6404PayloadHasGas').hidden = true;
            }

            if (payloadActiveFields[0] & 0x08) {
                assert(payload.length >= 20);
                const payloadTo = payload.slice(0, 20);
                payload = payload.slice(20);
                document.getElementById('selectedTransactionEip6404PayloadHasTo').hidden = false;
                document.getElementById('selectedTransactionEip6404PayloadTo').innerText = arrayToHexString(payloadTo);
                document.getElementById('selectedTransactionEip6404PayloadToDescription').innerHTML =
                    '<a href="https://etherscan.io/address/0x' + arrayToHexString(payloadTo) + '" target="_blank">' +
                    'Destination' + '</a>';
            } else {
                document.getElementById('selectedTransactionEip6404PayloadHasTo').hidden = true;
            }

            if (payloadActiveFields[0] & 0x10) {
                assert(payload.length >= 32);
                const payloadValue = payload.slice(0, 32);
                payload = payload.slice(32);
                document.getElementById('selectedTransactionEip6404PayloadHasValue').hidden = false;
                document.getElementById('selectedTransactionEip6404PayloadValue').innerText = arrayToHexString(payloadValue);
                document.getElementById('selectedTransactionEip6404PayloadValueDescription').innerText = arrayToEthString(payloadValue.reverse()) + ' ETH';
            } else {
                document.getElementById('selectedTransactionEip6404PayloadHasValue').hidden = true;
            }

            if (payloadActiveFields[0] & 0x20) {
                assert(payload.length >= 4);
                const payloadInputOffset = payload.slice(0, 4);
                payload = payload.slice(4);
                document.getElementById('selectedTransactionEip6404PayloadHasInputOffset').hidden = false;
                document.getElementById('selectedTransactionEip6404PayloadInputOffset').innerText = arrayToHexString(payloadInputOffset);
                document.getElementById('selectedTransactionEip6404PayloadInputOffsetDescription').innerText = arrayToDecString(payloadInputOffset.reverse());
                payloadOffsets.push(Number(arrayToDecString(payloadInputOffset)));
            } else {
                document.getElementById('selectedTransactionEip6404PayloadHasInputOffset').hidden = true;
            }

            if (payloadActiveFields[0] & 0x40) {
                assert(payload.length >= 4);
                const payloadAccessListOffset = payload.slice(0, 4);
                payload = payload.slice(4);
                document.getElementById('selectedTransactionEip6404PayloadHasAccessListOffset').hidden = false;
                document.getElementById('selectedTransactionEip6404PayloadAccessListOffset').innerText = arrayToHexString(payloadAccessListOffset);
                document.getElementById('selectedTransactionEip6404PayloadAccessListOffsetDescription').innerText = arrayToDecString(payloadAccessListOffset.reverse());
                payloadOffsets.push(Number(arrayToDecString(payloadAccessListOffset)));
            } else {
                document.getElementById('selectedTransactionEip6404PayloadHasAccessListOffset').hidden = true;
            }

            if (payloadActiveFields[0] & 0x80) {
                assert(payload.length >= 32);
                const payloadMaxPriorityFeePerGas = payload.slice(0, 32);
                payload = payload.slice(32);
                document.getElementById('selectedTransactionEip6404PayloadHasMaxPriorityFeePerGas').hidden = false;
                document.getElementById('selectedTransactionEip6404PayloadMaxPriorityFeePerGas').innerText = arrayToHexString(payloadMaxPriorityFeePerGas);
                document.getElementById('selectedTransactionEip6404PayloadMaxPriorityFeePerGasDescription').innerText = arrayToGweiString(payloadMaxPriorityFeePerGas.reverse()) + ' Gwei';
            } else {
                document.getElementById('selectedTransactionEip6404PayloadHasMaxPriorityFeePerGas').hidden = true;
            }

            assert(payloadActiveFields[1] === 0x00);
            assert(payloadActiveFields[2] === 0x00);
            assert(payloadActiveFields[3] === 0x00);

            if (payloadActiveFields[0] & 0x20) {
                let numPayloadInputBytes;
                if (payloadOffsets.length > 1) {
                    numPayloadInputBytes = payloadOffsets[1] - payloadOffsets[0];
                } else {
                    numPayloadInputBytes = numPayloadBytes - 4 - payloadOffsets[0];
                }
                payloadOffsets.shift();
                assert(payload.length >= numPayloadInputBytes);
                const payloadInput = payload.slice(0, numPayloadInputBytes);
                payload = payload.slice(numPayloadInputBytes);
                document.getElementById('selectedTransactionEip6404PayloadHasInput').hidden = false;
                if (payloadInput.length > 0) {
                    document.getElementById('selectedTransactionEip6404PayloadInput').innerHTML =
                        (arrayToHexString(payloadInput).match(/.{1,64}/g) ?? []).join('<br />');
                } else {
                    document.getElementById('selectedTransactionEip6404PayloadInput').innerText = arrayToHexString(payloadInput);
                }
                document.getElementById('selectedTransactionEip6404PayloadInputDescription').innerText = toHumanReadableByteCountString(payloadInput.length);
            } else {
                document.getElementById('selectedTransactionEip6404PayloadHasInput').hidden = true;
            }

            if (payloadActiveFields[0] & 0x40) {
                let numPayloadAccessListBytes;
                if (payloadOffsets.length > 1) {
                    numPayloadAccessListBytes = payloadOffsets[1] - payloadOffsets[0];
                } else {
                    numPayloadAccessListBytes = numPayloadBytes - 4 - payloadOffsets[0];
                }
                payloadOffsets.shift();
                assert(payload.length >= numPayloadAccessListBytes);
                let accessList = payload.slice(0, numPayloadAccessListBytes);
                payload = payload.slice(numPayloadAccessListBytes);
                document.getElementById('selectedTransactionEip6404PayloadHasAccessList').hidden = false;

                document.getElementById('selectedTransactionEip6404PayloadAccessListStart').innerHTML = '';
                document.getElementById('selectedTransactionEip6404PayloadAccessListDescription').innerHTML = '';
                document.getElementById('selectedTransactionEip6404PayloadAccessList').innerHTML = '';
                document.getElementById('selectedTransactionEip6404PayloadAccessListLabel').innerHTML = '';

                if (!accessList.length) {
                    document.getElementById('selectedTransactionEip6404PayloadAccessListDescription').innerText = 'empty';
                }

                let numAccessTuples = 0;
                const accessListOffsets = [];
                if (accessList.length) {
                    assert(accessList.length >= 4);
                    const accessTupleOffset = accessList.slice(0, 4);
                    accessList = accessList.slice(4);
                    document.getElementById('selectedTransactionEip6404PayloadAccessListStart').innerText = arrayToHexString(accessTupleOffset);
                    document.getElementById('selectedTransactionEip6404PayloadAccessListDescription').innerText = 'access list +' + arrayToDecString(accessTupleOffset.reverse());
                    document.getElementById('selectedTransactionEip6404PayloadAccessListLabel').innerHTML =
                        ' <span>[0] offset</span>';
                    accessListOffsets.push(Number(arrayToDecString(accessTupleOffset)));
                    numAccessTuples = Number(arrayToDecString(accessTupleOffset));
                    assert(numAccessTuples % 4 === 0);
                    numAccessTuples /= 4;
                }
                for (let accessTupleIndex = 1; accessTupleIndex < numAccessTuples; accessTupleIndex++) {
                    assert(accessList.length >= 4);
                    const accessTupleOffset = accessList.slice(0, 4);
                    accessList = accessList.slice(4);
                    document.getElementById('selectedTransactionEip6404PayloadAccessList').innerHTML +=
                        '<br /><span>' + arrayToHexString(accessTupleOffset) + '</span> ' +
                        '<span class="description">(access list +' + arrayToDecString(accessTupleOffset.reverse()) +')</span>';
                    document.getElementById('selectedTransactionEip6404PayloadAccessListLabel').innerHTML +=
                        '<br /><span>[' + accessTupleIndex + '] offset</span>';
                    accessListOffsets.push(Number(arrayToDecString(accessTupleOffset)));
                }
                for (let accessTupleIndex = 0; accessTupleIndex < numAccessTuples; accessTupleIndex++) {
                    let numAccessTupleBytes;
                    if (accessListOffsets.length > 1) {
                        numAccessTupleBytes = accessListOffsets[1] - accessListOffsets[0];
                    } else {
                        numAccessTupleBytes = numPayloadAccessListBytes - accessListOffsets[0];
                    }
                    accessListOffsets.shift();
                    assert(accessList.length >= numAccessTupleBytes);
                    let accessTuple = accessList.slice(0, numAccessTupleBytes);
                    accessList = accessList.slice(numAccessTupleBytes);

                    assert(accessTuple.length >= 20);
                    const address = accessTuple.slice(0, 20);
                    accessTuple = accessTuple.slice(20);
                    document.getElementById('selectedTransactionEip6404PayloadAccessList').innerHTML +=
                        '<br /><span>' + arrayToHexString(address) + '</span>';
                    document.getElementById('selectedTransactionEip6404PayloadAccessListLabel').innerHTML +=
                        '<br /><span>[' + accessTupleIndex + '] <a href="https://etherscan.io/address/0x' + arrayToHexString(address) + '" target="_blank">Address</a></span>';

                    assert(accessTuple.length >= 4);
                    const storageKeysOffset = accessTuple.slice(0, 4);
                    accessTuple = accessTuple.slice(4);
                    document.getElementById('selectedTransactionEip6404PayloadAccessList').innerHTML +=
                        '<br /><span>' + arrayToHexString(storageKeysOffset) + '</span> ' +
                        '<span class="description">(access tuple +' + arrayToDecString(storageKeysOffset.reverse()) +')</span>';
                    document.getElementById('selectedTransactionEip6404PayloadAccessListLabel').innerHTML +=
                        '<br /><span>[' + accessTupleIndex + '] Storage keys</span>';

                    while (accessTuple.length) {
                        assert(accessTuple.length >= 32);
                        const storageKey = accessTuple.slice(0, 32);
                        accessTuple = accessTuple.slice(32);
                        document.getElementById('selectedTransactionEip6404PayloadAccessList').innerHTML +=
                            '<br /><span>' + arrayToHexString(storageKey) + '</span>';
                        document.getElementById('selectedTransactionEip6404PayloadAccessListLabel').innerHTML +=
                            '<br />';
                    }
                }
                assert(accessList.length === 0);
            } else {
                document.getElementById('selectedTransactionEip6404PayloadHasAccessList').hidden = true;
            }

            assert(payload.length === 0);

            assert(signature.length >= 2);
            const signatureActiveFields = signature.slice(0, 2);
            signature = signature.slice(2);
            document.getElementById('selectedTransactionEip6404SignatureActiveFields').innerText = arrayToHexString(signatureActiveFields);
            document.getElementById('selectedTransactionEip6404SignatureActiveFieldsDescription').innerText = '0b' + arrayToBinString(signatureActiveFields);

            if (signatureActiveFields[0] & 0x01) {
                assert(signature.length >= 20);
                const signatureFrom = signature.slice(0, 20);
                signature = signature.slice(20);
                document.getElementById('selectedTransactionEip6404SignatureHasFrom').hidden = false;
                document.getElementById('selectedTransactionEip6404SignatureFrom').innerText = arrayToHexString(signatureFrom);
                document.getElementById('selectedTransactionEip6404SignatureFromDescription').innerHTML =
                    '<a href="https://etherscan.io/address/0x' + arrayToHexString(signatureFrom) + '" target="_blank">' +
                    'Origin' + '</a>';
            } else {
                document.getElementById('selectedTransactionEip6404SignatureHasFrom').hidden = true;
            }

            if (signatureActiveFields[0] & 0x02) {
                assert(signature.length >= 65);
                const signatureEcdsaSignature = signature.slice(0, 65);
                signature = signature.slice(65);
                document.getElementById('selectedTransactionEip6404SignatureHasEcdsaSignature').hidden = false;
                document.getElementById('selectedTransactionEip6404SignatureEcdsaSignature').innerHTML =
                    (arrayToHexString(signatureEcdsaSignature).match(/.{1,64}/g) ?? []).join('<br />');
            } else {
                document.getElementById('selectedTransactionEip6404SignatureHasEcdsaSignature').hidden = true;
            }

            if (signatureActiveFields[0] & 0x04) {
                assert(signature.length >= 1);
                const signatureNoReplayProtection = signature.slice(0, 1);
                signature = signature.slice(1);
                document.getElementById('selectedTransactionEip6404SignatureHasNoReplayProtection').hidden = false;
                document.getElementById('selectedTransactionEip6404SignatureNoReplayProtection').innerText = arrayToHexString(signatureNoReplayProtection);
                document.getElementById('selectedTransactionEip6404SignatureNoReplayProtectionDescription').innerText =
                    (signatureNoReplayProtection[0] ? 'May be replayed across chains' : 'Chain ID locked');
            } else {
                document.getElementById('selectedTransactionEip6404SignatureHasNoReplayProtection').hidden = true;
            }

            if (signatureActiveFields[0] & 0x08) {
                assert(signature.length >= 1);
                const signatureEip2718Type = signature.slice(0, 1);
                signature = signature.slice(1);
                document.getElementById('selectedTransactionEip6404SignatureHasEip2718Type').hidden = false;
                document.getElementById('selectedTransactionEip6404SignatureEip2718Type').innerText = arrayToHexString(signatureEip2718Type);
                if (signatureEip2718Type[0] === 0x02) {
                    document.getElementById('selectedTransactionEip6404SignatureEip2718TypeDescription').innerHTML =
                        '<a href="https://eips.ethereum.org/EIPS/eip-1559" target="_blank">EIP-1559</a>';
                } else if (signatureEip2718Type[0] === 0x01) {
                    document.getElementById('selectedTransactionEip6404SignatureEip2718TypeDescription').innerHTML =
                        '<a href="https://eips.ethereum.org/EIPS/eip-2930" target="_blank">EIP-2930</a>';
                } else if (signatureEip2718Type[0] === 0x00) {
                    document.getElementById('selectedTransactionEip6404SignatureEip2718TypeDescription').innerHTML =
                        'Legacy';
                } else {
                    assert(false);
                }
            } else {
                document.getElementById('selectedTransactionEip6404SignatureHasEip2718Type').hidden = true;
            }

            assert(signatureActiveFields[0] < 0x10);
            assert(signatureActiveFields[1] === 0);

            assert(signature.length === 0);
        }

        function visualizeHeader(prefix, header) {
            const beaconRoot = getBeaconRoot(header);
            if (document.getElementById(prefix + 'BeaconRoot').dataset.beaconRoot === beaconRoot) return;
            document.getElementById(prefix + 'BeaconRoot').dataset.beaconRoot = beaconRoot;

            document.getElementById(prefix + 'BeaconRoot').innerHTML =
                '<a href="https://beaconcha.in/slot/' + beaconRoot + '" target="_blank">' +
                beaconRoot.substring(2, 34) + '<br />' + beaconRoot.substring(34) + '</a>';
            const beacon = Module._ETHLightClientHeaderGetBeacon(header);
            const beaconSlot = Module._ETHBeaconBlockHeaderGetSlot(beacon);
            document.getElementById(prefix + 'BeaconSlot').innerHTML =
                '<a href="https://beaconcha.in/slot/' + beaconSlot + '" target="_blank">' +
                beaconSlot + '</a>';
            const beaconProposerIndex = Module._ETHBeaconBlockHeaderGetProposerIndex(beacon);
            document.getElementById(prefix + 'BeaconProposerIndex').innerHTML =
                '<a href="https://beaconcha.in/validator/' + beaconProposerIndex + '" target="_blank">' +
                beaconProposerIndex + '</a>';
            const beaconParentRoot = Module._ETHBeaconBlockHeaderGetParentRoot(beacon);
            const beaconStateRoot = Module._ETHBeaconBlockHeaderGetStateRoot(beacon);
            const beaconBodyRoot = Module._ETHBeaconBlockHeaderGetBodyRoot(beacon);

            const executionHash = Module._ETHLightClientHeaderCopyExecutionHash(header, cfg);
            const executionHashString = toHexString(executionHash, 32);
            Module._ETHRootDestroy(executionHash);
            const execution = Module._ETHLightClientHeaderGetExecution(header);
            const executionParentHash = Module._ETHExecutionPayloadHeaderGetParentHash(execution);
            const executionFeeRecipient = Module._ETHExecutionPayloadHeaderGetFeeRecipient(execution);
            document.getElementById(prefix + 'ExecutionFeeRecipient').innerHTML =
                '<a href="https://etherscan.io/address/' + toHexString(executionFeeRecipient, 20) + '#mine" target="_blank">' +
                toHexString(executionFeeRecipient, 20) + '</a>';
            const executionStateRoot = Module._ETHExecutionPayloadHeaderGetStateRoot(execution);
            const executionReceiptsRoot = Module._ETHExecutionPayloadHeaderGetReceiptsRoot(execution);
            const executionLogsBloom = Module._ETHExecutionPayloadHeaderGetLogsBloom(execution);
            const executionPrevRandao = Module._ETHExecutionPayloadHeaderGetPrevRandao(execution);
            const executionBlockNumber = Module._ETHExecutionPayloadHeaderGetBlockNumber(execution);
            document.getElementById(prefix + 'ExecutionBlockNumber').innerHTML =
                '<a href="https://etherscan.io/block/' + executionHashString + '" target="_blank">' +
                executionBlockNumber + '</a>';
            const executionGasLimit = Module._ETHExecutionPayloadHeaderGetGasLimit(execution);
            document.getElementById(prefix + 'ExecutionGasLimit').innerText = toHumanReadableNumberString(executionGasLimit);
            const executionGasUsed = Module._ETHExecutionPayloadHeaderGetGasUsed(execution);
            document.getElementById(prefix + 'ExecutionGasUsed').innerText = toHumanReadableNumberString(executionGasUsed);
            document.getElementById(prefix + 'ExecutionGasUsedPercentage').innerText = (executionGasUsed * 100 / executionGasLimit).toFixed(2) + '%';
            const executionTimestamp = Module._ETHExecutionPayloadHeaderGetTimestamp(execution);
            document.getElementById(prefix + 'ExecutionTimestamp').innerText = toDateString(executionTimestamp);
            const executionExtraDataBytes = Module._ETHExecutionPayloadHeaderGetExtraDataBytes(execution);
            const numExecutionExtraDataBytes = Module._ETHExecutionPayloadHeaderGetNumExtraDataBytes(execution);
            const executionBaseFeePerGas = Module._ETHExecutionPayloadHeaderGetBaseFeePerGas(execution);
            document.getElementById(prefix + 'ExecutionBaseFeePerGas').innerText = toGweiString(executionBaseFeePerGas, 32) + ' Gwei';
            const executionBlobGasUsed = Module._ETHExecutionPayloadHeaderGetBlobGasUsed(execution);
            const executionExcessBlobGas = Module._ETHExecutionPayloadHeaderGetExcessBlobGas(execution);

            function fillExecutionInfo() {
                if (executionHash == zeroHash) {
                    document.getElementById(prefix + 'TransactionInfo').innerHTML = '';
                    document.getElementById(prefix + 'TransactionList').innerHTML = '';
                } else {
                    document.getElementById(prefix + 'TransactionInfo').innerHTML = 'Loading transactions&hellip;';
                    document.getElementById(prefix + 'TransactionList').innerHTML = '';

                    const executionBlockFut = fetchExecutionBlock(header);
                    executionBlockFut.then((executionBlock) => {
                        if (document.getElementById(prefix + 'BeaconRoot').dataset.beaconRoot !== beaconRoot) return;
                        if (!executionBlock) {
                            document.getElementById(prefix + 'TransactionInfo').innerHTML = '';
                            document.getElementById(prefix + 'TransactionList').innerHTML =
                            '<div class="headerMaster">' +
                                '   <div class="headerMasterBeaconRoot">Failed to validate transactions</div>' +
                                '   <div class="headerMasterInfo">' +
                                    '       <table style="width: 100%">' +
                                '           <tr>' +
                                '               <td><input type="button" id="' +
                                prefix + 'ExecutionReloadButton' +
                                '" value="Retry" /></td>' +
                                '           </tr>' +
                                '       </table>' +
                                '   </div>' +
                                '</div>';
                            document.getElementById(prefix + 'ExecutionReloadButton').onclick = fillExecutionInfo;
                            return;
                        }

                        const [executionBlockHeader, transactions] = executionBlock;
                        const executionTransactionsRoot = Module._ETHExecutionBlockHeaderGetTransactionsRoot(executionBlockHeader);
                        const executionWithdrawalsRoot = Module._ETHExecutionBlockHeaderGetWithdrawalsRoot(executionBlockHeader);

                        const numTransactions = Module._ETHTransactionsGetCount(transactions);
                        document.getElementById(prefix + 'TransactionInfo').innerHTML = '';
                        document.getElementById(prefix + 'TransactionList').innerHTML = '';
                        const numTransactionInputBytesPtr = Module._malloc(4);
                        assert(numTransactionInputBytesPtr);
                        const numTransactionBytesPtr = Module._malloc(4);
                        assert(numTransactionBytesPtr);
                        const numTransactionEip6404BytesPtr = Module._malloc(4);
                        assert(numTransactionEip6404BytesPtr);
                        let totalRlpBytes = 0;
                        let totalEip6404SnappyBytes = 0;
                        for (let transactionIndex = 0; transactionIndex < numTransactions; transactionIndex++) {
                            const transaction = Module._ETHTransactionsGet(transactions, transactionIndex);

                            const transactionHash = Module._ETHTransactionGetHash(transaction);
                            const transactionHashString = toHexString(transactionHash, 32);
                            const transactionFrom = Module._ETHTransactionGetFrom(transaction);
                            const transactionNonce = Module._ETHTransactionGetNonce(transaction);
                            const transactionMaxPriorityFeePerGas = Module._ETHTransactionGetMaxPriorityFeePerGas(transaction);
                            const transactionMaxFeePerGas = Module._ETHTransactionGetMaxFeePerGas(transaction);
                            const transactionGas = Module._ETHTransactionGetGas(transaction);
                            const transactionIsCreatingContract = Module._ETHTransactionIsCreatingContract(transaction);
                            const transactionTo = Module._ETHTransactionGetTo(transaction);
                            const transactionValue = Module._ETHTransactionGetValue(transaction);
                            const transactionInputBytes = Module._ETHTransactionGetInputBytes(transaction, numTransactionInputBytesPtr);
                            const numTransactionInputBytes = Module.HEAPU32[numTransactionInputBytesPtr >>> 2];
                            const transactionBytes = Module._ETHTransactionGetBytes(transaction, numTransactionBytesPtr);
                            const numTransactionBytes = Module.HEAPU32[numTransactionBytesPtr >>> 2];
                            const transactionBytesArray = toArray(transactionBytes, numTransactionBytes);
                            const transactionEip6404Root = Module._ETHTransactionGetEip6404Root(transaction);
                            const transactionEip6404RootString = toHexString(transactionEip6404Root, 32);
                            const transactionEip6404Bytes = Module._ETHTransactionGetEip6404Bytes(transaction, numTransactionEip6404BytesPtr);
                            const numTransactionEip6404Bytes = Module.HEAPU32[numTransactionEip6404BytesPtr >>> 2];
                            const transactionEip6404BytesArray = toArray(transactionEip6404Bytes, numTransactionEip6404Bytes);
                            const numTransactionEip6404SnappyBytes = Module._ETHTransactionGetNumEip6404SnappyBytes(transaction);
                            const transactionBytesDiffPercentage = Math.floor((numTransactionEip6404SnappyBytes / transactionBytesArray.length - 1.0) * 100.0);
                            totalRlpBytes += numTransactionEip6404Bytes;
                            totalEip6404SnappyBytes += numTransactionEip6404SnappyBytes;

                            const rlpButtonId = `rlpButton_transaction_${transactionHashString}`;
                            const eip6404ButtonId = `eip6404Button_transaction_${transactionHashString}`;
                            const transactionDiv = document.createElement('div');
                            transactionDiv.id = `txMaster_${transactionHashString}`;
                            transactionDiv.className = 'headerMaster';
                            transactionDiv.innerHTML =
                                '<div class="headerMasterBeaconRoot">' +
                                '<a href="https://etherscan.io/tx/' + transactionHashString + '" target="_blank">' +
                                transactionHashString.substring(2, 34) + '<br />' + transactionHashString.substring(34) + '</a>' +
                                '</div>' +
                                '<div class="headerMasterInfo">' +
                                '    <table style="width: 100%">' +
                                '        <tr>' +
                                '            <td><span class="fas fa-hashtag"></span> <span>' +
                                toDecString(transactionNonce, 8) +
                                '</span></td>' +
                                '            <td><span class="fas fa-tachometer-alt"></span> <span>' +
                                toHumanReadableNumberString(Number(toDecString(transactionGas, 8))) +
                                '</span></td>' +
                                '            <td><span class="fas fa-money-bill-1"></span> <span>' +
                                toGweiString(transactionMaxPriorityFeePerGas, 8) + ' Gwei' +
                                '</span></td>' +
                                '            <td style="text-align: right;"><span class="fas fa-gas-pump"></span> <span>' +
                                toGweiString(transactionMaxFeePerGas, 8) + ' Gwei' +
                                '</span></td>' +
                                '        </tr>' +
                                '        <tr>' +
                                '            <td colspan="4"><span class="fas fa-right-from-bracket"></span> <span style="display: inline-block; transform: scaleX(1.015); transform-origin: left;">' +
                                '<a href="https://etherscan.io/address/' + toHexString(transactionFrom, 20) + '" target="_blank">' +
                                toHexString(transactionFrom, 20) + '</a>' +
                                '</span></td>' +
                                '        </tr>' +
                                '        <tr>' +
                                '            <td colspan="3"><span class="fas fa-brands fa-ethereum"></span> <span>' +
                                toEthString(transactionValue, 32) + ' ETH' +
                                '</span></td>' +
                                '            <td colspan="1" style="text-align: right;"><span class="fas fa-file-arrow-up"></span> <span>' +
                                toHumanReadableByteCountString(numTransactionInputBytes) +
                                '</span></td>' +
                                '        </tr>' +
                                '        <tr>' +
                                '            <td colspan="4"><span class="fas ' +
                                (transactionIsCreatingContract ? 'fa-star-of-life' : 'fa-right-to-bracket') +
                                '"></span> <span style="display: inline-block; transform: scaleX(1.015); transform-origin: left;">' +
                                '<a href="https://etherscan.io/address/' + toHexString(transactionTo, 20) + '" target="_blank">' +
                                toHexString(transactionTo, 20) + '</a>' +
                                '</span></td>' +
                                '        </tr>' +
                                '        <tr>' +
                                '            <td colspan="4"><input type="button" id="' +
                                rlpButtonId +
                                '" value="RLP (' + toHumanReadableByteCountString(transactionBytesArray.length) + ')" />' +
                                '<span style="float: right;"><input type="button" id="' +
                                eip6404ButtonId +
                                '" value="SSZ (' + toHumanReadableByteCountString(numTransactionEip6404SnappyBytes) + ' ' +
                                (transactionBytesDiffPercentage < 0 ? '' : '+') + transactionBytesDiffPercentage + '%' +
                                ')" /></span></td>' +
                                '        </tr>' +
                                '    </table>' +
                                '</div>';

                            document.getElementById(prefix + 'TransactionList').appendChild(transactionDiv);

                            document.getElementById(rlpButtonId).onclick = function () {
                                visualizeTransactionRlp(transactionHashString, transactionBytesArray);
                                document.getElementById('selectedTransactionEip6404Detail').hidden = true;
                                document.getElementById('selectedTransactionRlpDetail').hidden = false;
                            };

                            document.getElementById(eip6404ButtonId).onclick = function () {
                                visualizeTransactionEip6404(transactionEip6404RootString, transactionEip6404BytesArray);
                                document.getElementById('selectedTransactionRlpDetail').hidden = true;
                                document.getElementById('selectedTransactionEip6404Detail').hidden = false;
                            };
                        }
                        Module._free(numTransactionEip6404BytesPtr);
                        Module._free(numTransactionBytesPtr);
                        Module._free(numTransactionInputBytesPtr);
                        const totalTransactionBytesDiffPercentage = Math.floor((totalEip6404SnappyBytes / totalRlpBytes - 1.0) * 100.0);
                        document.getElementById(prefix + 'TransactionInfo').innerHTML =
                            'RLP ' + toHumanReadableByteCountString(totalRlpBytes) +
                            ' | SSZ ' + toHumanReadableByteCountString(totalEip6404SnappyBytes) +
                            ' (' + (totalTransactionBytesDiffPercentage < 0 ? '' : '+') + totalTransactionBytesDiffPercentage + '%' + ')';
                    });
                }
            }
            fillExecutionInfo();
        }

        let selectedHeader = undefined;

        document.getElementById('settingsButton').onclick = function () {
            document.getElementById('masterTop').hidden = true;
            document.getElementById('headerList').hidden = true;
            document.getElementById('selectedHeaderDetail').hidden = true;
            document.getElementById('settings').hidden = false;
        }

        document.getElementById('backButton').onclick = function () {
            selectedHeader = undefined;
            document.getElementById('selectedHeaderDetail').hidden = true;
            document.getElementById('headerList').hidden = false;
        };

        function cacheHeaders(store, cfg) {
            const finalizedRoot = getBeaconRoot(Module._ETHLightClientStoreGetFinalizedHeader(store));
            document.getElementById('trustedBlockRoot').value = finalizedRoot;
            localStorage.setItem('trustedBlockRoot', finalizedRoot);

            headers.add(Module._ETHLightClientStoreGetOptimisticHeader(store), cfg);
            headers.add(Module._ETHLightClientStoreGetFinalizedHeader(store), cfg);

            const newHeaders = headers.getAll();
            const oldHeaderDivs = Array.from(headerList.children);

            let i = 0;
            let j = 0;

            while (i < newHeaders.length || j < oldHeaderDivs.length) {
                const newHeader = newHeaders[i];
                let beaconRoot = undefined;
                let beaconSlot = undefined;
                if (newHeader) {
                    beaconRoot = getBeaconRoot(newHeader);
                    beaconSlot = getBeaconSlot(newHeader);
                }

                const oldHeaderDiv = oldHeaderDivs[j];
                if (newHeader && oldHeaderDiv && beaconRoot == oldHeaderDiv.dataset.beaconRoot) {
                    i++;
                    j++;
                } else if (newHeader && (!oldHeaderDiv ||
                    beaconSlot > oldHeaderDiv.dataset.beaconSlot ||
                    (beaconSlot == oldHeaderDiv.dataset.beaconSlot &&
                    beaconRoot < oldHeaderDiv.dataset.beaconRoot)))
                {
                    const beacon = Module._ETHLightClientHeaderGetBeacon(newHeader);
                    const beaconProposerIndex = Module._ETHBeaconBlockHeaderGetProposerIndex(beacon);
                    const executionHash = Module._ETHLightClientHeaderCopyExecutionHash(newHeader, cfg);
                    const executionHashString = toHexString(executionHash, 32);
                    Module._ETHRootDestroy(executionHash);
                    const execution = Module._ETHLightClientHeaderGetExecution(newHeader);
                    const executionFeeRecipient = Module._ETHExecutionPayloadHeaderGetFeeRecipient(execution);
                    const executionBlockNumber = Module._ETHExecutionPayloadHeaderGetBlockNumber(execution);
                    const executionGasLimit = Module._ETHExecutionPayloadHeaderGetGasLimit(execution);
                    const executionGasUsed = Module._ETHExecutionPayloadHeaderGetGasUsed(execution);
                    const executionTimestamp = Module._ETHExecutionPayloadHeaderGetTimestamp(execution);
                    const executionBaseFeePerGas = Module._ETHExecutionPayloadHeaderGetBaseFeePerGas(execution);

                    const transactionsButtonId = `transactionsButton_header_${beaconRoot}`;
                    let headerDiv = document.createElement('div');
                    headerDiv.id = `headerMaster_${beaconRoot}`;
                    headerDiv.dataset.beaconRoot = beaconRoot;
                    headerDiv.dataset.beaconSlot = beaconSlot;
                    headerDiv.className = 'headerMaster';
                    headerDiv.innerHTML =
                        '<div class="headerMasterBeaconRoot">' +
                        '<a href="https://beaconcha.in/slot/' + beaconRoot + '" target="_blank">' +
                        beaconRoot.substring(2, 34) + '<br />' + beaconRoot.substring(34) + '</a>' +
                        '</div>' +
                        '<div class="headerMasterInfo">' +
                        '    <table style="width: 100%">' +
                        '        <tr>' +
                        '            <td><span class="fas fa-satellite-dish"></span> <span>' +
                        '<a href="https://beaconcha.in/slot/' + beaconSlot + '" target="_blank">' +
                        beaconSlot + '</a>' +
                        '</span></td>' +
                        '            <td><span class="fas fa-cubes"></span> <span>' +
                        '<a href="https://etherscan.io/block/' + executionHashString + '" target="_blank">' +
                        executionBlockNumber + '</a>' +
                        '</span></td>' +
                        '            <td colspan="2" style="text-align: right;"><span class="fas fa-clock"></span> <span>' +
                        toDateString(executionTimestamp) +
                        '</span></td>' +
                        '        </tr>' +
                        '        <tr>' +
                        '            <td><span class="fas fa-user-check"></span> <span>' +
                        '<a href="https://beaconcha.in/validator/' + beaconProposerIndex + '" target="_blank">' +
                        beaconProposerIndex + '</a>' +
                        '</span></td>' +
                        '            <td colspan="2" class="a"><span class="fas fa-tachometer-alt"></span> <span>' +
                        (executionGasUsed * 100 / executionGasLimit).toFixed(2) + '%' +
                        '</span> <span>' +
                        toHumanReadableNumberString(executionGasUsed) +
                        '</span>/<span>' +
                        toHumanReadableNumberString(executionGasLimit) +
                        '</span></td>' +
                        '            <td style="text-align: right;"><span class="fas fa-fire-flame-curved"></span> <span>' +
                        toGweiString(executionBaseFeePerGas, 32) + ' Gwei' +
                        '</span></td>' +
                        '        </tr>' +
                        '        <tr>' +
                        '            <td colspan="4"><span class="fas fa-hand-holding-usd"></span> <span style="display: inline-block; transform: scaleX(1.015); transform-origin: left;">' +
                        '<a href="https://etherscan.io/address/' + toHexString(executionFeeRecipient, 20) + '#mine" target="_blank">' +
                        toHexString(executionFeeRecipient, 20) + '</a>' +
                        '</span></td>' +
                        '        </tr>' +
                        '        <tr>' +
                        '            <td colspan="4"><input type="button" id="' +
                        transactionsButtonId +
                        '" value="Transactions" /></td>' +
                        '        </tr>' +
                        '    </table>' +
                        '</div>';

                    headerList.insertBefore(headerDiv, oldHeaderDiv);
                    i++;

                    document.getElementById(transactionsButtonId).onclick = function () {
                        const header = headers.get(beaconRoot);
                        if (header) {
                            selectedHeader = beaconRoot;
                            visualizeHeader('selected', header);
                            document.getElementById('headerList').hidden = true;
                            document.getElementById('selectedHeaderDetail').hidden = false;
                        }
                    };
                } else {
                    headerList.removeChild(oldHeaderDiv);
                    j++;
                }
            }
        }

        let rng = undefined;
        let cfg = undefined;
        let genesisValRoot = undefined;
        let forkDigests = undefined;
        let beaconClock = undefined;
        let store = undefined;
        let storeId = 0;
        let trackStoreTimeout = undefined;
        let trackStoreSource = undefined;
        let nextSyncTaskTime = undefined;
        function trackStore(newStore) {
            store = newStore;
            storeId++;

            function setupSource(tickStoreId) {
                trackStoreSource = new EventSource(beaconApiBase +
                    '/eth/v1/events?topics=light_client_finality_update&topics=light_client_optimistic_update');

                trackStoreSource.addEventListener('light_client_finality_update', function (event) {
                    if (storeId != tickStoreId) return;
                    const mediaType = Module.stringToNewUTF8("application/json");
                    const finUpdatesBytesPtr = Module.stringToNewUTF8(event.data);
                    const numFinUpdateBytes = Module.lengthBytesUTF8(event.data);
                    const res = Module._ETHLightClientStoreProcessFinalityUpdate(
                        store, cfg, forkDigests, genesisValRoot, beaconClock,
                        mediaType, /* consensusVersion: */ 0, finUpdatesBytesPtr, numFinUpdateBytes);
                    Module._free(finUpdatesBytesPtr);
                    Module._free(mediaType);
                    cacheHeaders(store, cfg);
                });

                trackStoreSource.addEventListener('light_client_optimistic_update', function (event) {
                    if (storeId != tickStoreId) return;
                    const mediaType = Module.stringToNewUTF8("application/json");
                    const optUpdateBytesPtr = Module.stringToNewUTF8(event.data);
                    const numOptUpdateBytes = Module.lengthBytesUTF8(event.data);
                    const res = Module._ETHLightClientStoreProcessOptimisticUpdate(
                        store, cfg, forkDigests, genesisValRoot, beaconClock,
                        mediaType, /* consensusVersion: */ 0, optUpdateBytesPtr, numOptUpdateBytes);
                    Module._free(optUpdateBytesPtr);
                    Module._free(mediaType);
                    cacheHeaders(store, cfg);
                });
            }

            function runOnTick(tickStoreId, timeout) {
                cacheHeaders(store, cfg);
                async function onTick() {
                    if (storeId != tickStoreId) return;
                    if (nextSyncTaskTime !== undefined && Date.now() < nextSyncTaskTime) {
                        runOnTick(storeId, /* timeout: */ 100);
                        return;
                    }

                    trackStoreTimeout = undefined;
                    nextSyncTaskTime = undefined;

                    const startPeriodPtr = Module._malloc(4);
                    const countPtr = Module._malloc(4);
                    const syncKind = Module._ETHLightClientStoreGetNextSyncTask(
                        store, beaconClock, startPeriodPtr, countPtr);
                    const startPeriod = Module.HEAPU32[startPeriodPtr >>> 2];
                    let count = Module.HEAPU32[countPtr >>> 2];
                    Module._free(countPtr);
                    Module._free(startPeriodPtr);

                    let res = 1;
                    if (syncKind == Module.HEAPU8[Module._kETHLcSyncKind_UpdatesByRange]) {
                        const maxUpdatesByRange = 1;
                        if (count > maxUpdatesByRange) count = maxUpdatesByRange;
                        const response = await fetch(beaconApiBase +
                            '/eth/v1/beacon/light_client/updates?start_period=' + startPeriod + '&count=' + count, {
                                headers: {
                                    'Accept': 'application/octet-stream'
                                }
                            });
                        if (storeId != tickStoreId) return;
                        if (response.ok) {
                            const data = await response.arrayBuffer();
                            if (storeId != tickStoreId) return;
                            const updatesBytes = new Uint8Array(data);

                            const mediaType = Module.stringToNewUTF8(response.headers.get('Content-Type'));
                            const updatesBytesPtr = Module._malloc(updatesBytes.length);
                            Module.HEAPU8.set(updatesBytes, updatesBytesPtr);
                            res = Module._ETHLightClientStoreProcessUpdatesByRange(
                                store, cfg, forkDigests, genesisValRoot, beaconClock,
                                startPeriod, count, mediaType, updatesBytesPtr, updatesBytes.length);
                            Module._free(updatesBytesPtr);
                            Module._free(mediaType);
                        }
                    } else if (syncKind == Module.HEAPU8[Module._kETHLcSyncKind_FinalityUpdate]) {
                        const response = await fetch(beaconApiBase +
                            '/eth/v1/beacon/light_client/finality_update', {
                                headers: {
                                    'Accept': 'application/octet-stream'
                                }
                            });
                        if (storeId != tickStoreId) return;
                        if (response.ok) {
                            const data = await response.arrayBuffer();
                            if (storeId != tickStoreId) return;
                            const finUpdateBytes = new Uint8Array(data);

                            const mediaType = Module.stringToNewUTF8(response.headers.get('Content-Type'));
                            const consensusVersion = Module.stringToNewUTF8(response.headers.get('Eth-Consensus-Version'));
                            const finUpdatesBytesPtr = Module._malloc(finUpdateBytes.length);
                            Module.HEAPU8.set(finUpdateBytes, finUpdatesBytesPtr);
                            res = Module._ETHLightClientStoreProcessFinalityUpdate(
                                store, cfg, forkDigests, genesisValRoot, beaconClock,
                                mediaType, consensusVersion, finUpdatesBytesPtr, finUpdateBytes.length);
                            Module._free(finUpdatesBytesPtr);
                            Module._free(consensusVersion);
                            Module._free(mediaType);
                        }
                    } else {
                        assert(syncKind == Module.HEAPU8[Module._kETHLcSyncKind_OptimisticUpdate]);
                        const response = await fetch(beaconApiBase +
                            '/eth/v1/beacon/light_client/optimistic_update', {
                                headers: {
                                    'Accept': 'application/octet-stream'
                                }
                            });
                        if (storeId != tickStoreId) return;
                        if (response.ok) {
                            const data = await response.arrayBuffer();
                            if (storeId != tickStoreId) return;
                            const optUpdateBytes = new Uint8Array(data);

                            const mediaType = Module.stringToNewUTF8(response.headers.get('Content-Type'));
                            const consensusVersion = Module.stringToNewUTF8(response.headers.get('Eth-Consensus-Version'));
                            const optUpdateBytesPtr = Module._malloc(optUpdateBytes.length);
                            Module.HEAPU8.set(optUpdateBytes, optUpdateBytesPtr);
                            res = Module._ETHLightClientStoreProcessOptimisticUpdate(
                                store, cfg, forkDigests, genesisValRoot, beaconClock,
                                mediaType, consensusVersion, optUpdateBytesPtr, optUpdateBytes.length);
                            Module._free(optUpdateBytesPtr);
                            Module._free(consensusVersion);
                            Module._free(mediaType);
                        }
                    }

                    let millisecondsToNextSyncTask = Module._ETHLightClientStoreGetMillisecondsToNextSyncTask(
                        store, rng, beaconClock, res);
                    nextSyncTaskTime = Date.now() + millisecondsToNextSyncTask;
                    runOnTick(storeId, /* timeout: */ 100);
                }
                trackStoreTimeout = setTimeout(onTick, timeout);
            }

            const tickStoreId = storeId;
            setupSource(tickStoreId);
            runOnTick(tickStoreId, /* timeout: */ 0);
        }
        function clearStore() {
            if (trackStoreSource !== undefined) {
                trackStoreSource.close();
                trackStoreSource = undefined;
            }
            if (trackStoreTimeout !== undefined) {
                clearTimeout(trackStoreTimeout);
                trackStoreTimeout = undefined;
                nextSyncTaskTime = undefined;
            }
            if (store !== undefined) {
                Module._ETHLightClientStoreDestroy(store);
                store = undefined;
            }
        }

        const savedTrustedBlockRoot = localStorage.getItem('trustedBlockRoot');
        if (savedTrustedBlockRoot) {
            document.getElementById('trustedBlockRoot').value = savedTrustedBlockRoot;
        }

        Module.onRuntimeInitialized = async function() {
            Module._NimMain();

            rng = Module._ETHRandomNumberCreate();
            cfg = await loadCfg();
            const genesisState = await loadGenesis(cfg);
            genesisValRoot = Module._ETHBeaconStateCopyGenesisValidatorsRoot(genesisState);
            forkDigests = Module._ETHForkDigestsCreateFromState(cfg, genesisState);
            beaconClock = Module._ETHBeaconClockCreateFromState(genesisState);
            Module._ETHBeaconStateDestroy(genesisState);

            document.getElementById('initButton').addEventListener('click', async function() {
                const trustedBlockRootString = document.getElementById('trustedBlockRoot').value;
                if (!/^0x[0-9a-fA-F]{64}$/.test(trustedBlockRootString)) {
                    return;
                }
                document.getElementById('initButton').disabled = true;
                clearStore();

                beaconApiBase = document.getElementById('beaconApiBase').value;
                executionApiBase = document.getElementById('executionApiBase').value;
                const response = await fetch(beaconApiBase +
                    '/eth/v1/beacon/light_client/bootstrap/' + trustedBlockRootString, {
                        headers: {
                            'Accept': 'application/octet-stream'
                        }
                    });
                if (response.ok) {
                    const data = await response.arrayBuffer();
                    const bootstrapBytes = new Uint8Array(data);

                    const trustedBlockRootBytes = new Uint8Array(32);
                    for (let i = 0; i < trustedBlockRootBytes.length; i++) {
                        trustedBlockRootBytes[i] = parseInt(trustedBlockRootString.substr(i * 2 + 2, 2), 16);
                    }

                    const trustedBlockRootBytesPtr = Module._malloc(trustedBlockRootBytes.length);
                    Module.HEAPU8.set(trustedBlockRootBytes, trustedBlockRootBytesPtr);
                    const mediaType = Module.stringToNewUTF8(response.headers.get('Content-Type'));
                    const consensusVersion = Module.stringToNewUTF8(response.headers.get('Eth-Consensus-Version'));
                    const bootstrapBytesPtr = Module._malloc(bootstrapBytes.length);
                    Module.HEAPU8.set(bootstrapBytes, bootstrapBytesPtr);
                    const newStore = Module._ETHLightClientStoreCreateFromBootstrap(
                        cfg, trustedBlockRootBytesPtr,
                        mediaType, consensusVersion, bootstrapBytesPtr, bootstrapBytes.length);
                    Module._free(bootstrapBytesPtr);
                    Module._free(consensusVersion);
                    Module._free(trustedBlockRootBytesPtr);
                    Module._free(mediaType);

                    if (newStore) {
                        trackStore(newStore);

                        document.getElementById('settings').hidden = true;
                        document.getElementById('masterTop').hidden = false;
                        if (selectedHeader) {
                            document.getElementById('selectedHeaderDetail').hidden = false;
                        } else {
                            document.getElementById('headerList').hidden = false;
                        }
                    }
                }
                document.getElementById('initButton').disabled = false;
            });
            document.getElementById('initButton').disabled = false;
            document.getElementById('initButton').click();
        };
    </script>
    <script async src="libnimbus_lc.js"></script>
</body>
</html>
