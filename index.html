<!DOCTYPE html>
<html lang="en">
<head>
    <title>Ethereum Light</title>
    <base href="https://eth-light.xyz/" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css" crossorigin="anonymous"/>
    <style>
        @font-face {
            font-family: 'm_1mmedium';
            src: url('mplus-1m-medium-webfont.woff') format('woff');
            font-weight: normal;
            font-style: normal;
        }

        @font-face {
            font-family: 'm_1mlight';
            src: url('mplus-1m-light-webfont.woff') format('woff');
            font-weight: normal;
            font-style: normal;
        }

        a {
            text-decoration: none;
        }

        table {
            border-collapse: collapse;
        }

        #mdMaster {
            width: 270px;
            height: 100vh;
            position: fixed;
            left: 0;
            top: 0;
            background-color: #f9f9f9;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            padding: 10px;
            overflow-y: scroll;
        }

        #mdDetail {
            margin-left: 300px;
            padding: 10px;
        }

        .headerMaster {
            margin: 10px 0px 5px;
            padding: 10px 5px 10px;
            background-color: #e9e9e9;
            border-radius: 5px;
        }

        .headerMasterBeaconRoot {
            font-family: 'm_1mmedium', monospace;
            font-size: 1em;
            text-align: center;
        }

        .headerMasterInfo {
            padding: 0px 3px 0px 3px;
            font-family: 'm_1mlight', monospace;
            font-size: 0.7em;
        }

        .headerMasterInfo table {
            white-space: nowrap;
        }

        .headerMasterInfo td {
            width: 60px;
            padding-top: 5px;
        }

        .kv td {
            padding-top: 10px;
            vertical-align: top;
            white-space: nowrap;
        }

        .description {
            font-family: 'm_1mlight', monospace;
        }

        .kvKey {
            font-family: 'm_1mlight', monospace;
            text-align: right;
            width: 270px;
            padding-right: 10px;
        }

        .kvValue {
            font-family: 'm_1mmedium', monospace;
            text-align: left;
        }

        .fas {
            width: 12px;
            text-align: center;
        }

        #beaconApiBase, #executionApiBase, #trustedBlockRoot {
            width: 230px;
            font-family: 'm_1mlight', monospace;
        }
    </style>
</head>
<body>
    <div id="mdMaster">
        <div id="masterTop" class="headerMaster">
            <div class="headerMasterInfo">
                <table style="width: 100%">
                    <tr>
                        <td>
                            <input type="button" id="settingsButton" value="Settings" />
                            <span style="float: right;"><input type="button" id="specsButton" value="Specs" /></span>
                        </td>
                    </tr>
                </table>
            </div>
        </div>
        <div id="settings" class="headerMaster" hidden="hidden">
            <div class="headerMasterInfo">
                <table style="width: 100%">
                    <tr>
                        <td><span class="fas fa-satellite-dish"></span> <input id="beaconApiBase" value="https://beacon-api.eth-light.xyz" /></td>
                    </tr>
                    <tr>
                        <td><span class="fas fa-cogs"></span> <input id="executionApiBase" value="https://execution-api.eth-light.xyz/v1/mainnet" /></td>
                    </tr>
                    <tr>
                        <td><span class="fas fa-shield-alt"></span> <input id="trustedBlockRoot" value="0x108c48a17876c2eb19e6149d13ee21a86e2c0a45f4649a95359c7989c8e2acfc" /></td>
                    </tr>
                    <tr>
                        <td><input type="button" id="initButton" value="Save" disabled /></td>
                    </tr>
                </table>
            </div>
        </div>
        <div id="headerList" hidden="hidden"></div>
        <div id="selectedHeaderDetail" hidden="hidden">
            <div id="selectedHeader" class="headerMaster">
                <div id="selectedBeaconRoot" class="headerMasterBeaconRoot"></div>
                <div class="headerMasterInfo">
                    <table style="width: 100%">
                        <tr>
                            <td><span class="fas fa-satellite-dish"></span> <span id="selectedBeaconSlot"></span></td>
                            <td><span class="fas fa-cubes"></span> <span id="selectedExecutionBlockNumber"></span></td>
                            <td colspan="2" style="text-align: right;"><span class="fas fa-clock"></span> <span id="selectedExecutionTimestamp"></span></td>
                        </tr>
                        <tr>
                            <td><span class="fas fa-user-check"></span> <span id="selectedBeaconProposerIndex"></span></td>
                            <td colspan="2" class="a"><span class="fas fa-tachometer-alt"></span> <span id="selectedExecutionGasUsedPercentage"></span> <span id="selectedExecutionGasUsed"></span>/<span id="selectedExecutionGasLimit"></span></td>
                            <td style="text-align: right;"><span class="fas fa-fire-flame-curved"></span> <span id="selectedExecutionBaseFeePerGas"></span></td>
                        </tr>
                        <tr>
                            <td colspan="4"><span class="fas fa-hand-holding-usd"></span> <span id="selectedExecutionFeeRecipient" style="display: inline-block; transform: scaleX(1.015); transform-origin: left;"></span></td>
                        </tr>
                        <tr>
                            <td colspan="4">Transactions <span id="selectedTransactionInfo" style="float: right;"></span></td>
                        </tr>
                        <tr>
                            <td colspan="4">Receipts <span id="selectedReceiptInfo" style="float: right;"></span></td>
                        </tr>
                        <tr>
                            <td colspan="4"><input type="button" id="backButton" value="Back" /> <span style="float: right;">(SSZ with Snappy)</span></td>
                        </tr>
                    </table>
                </div>
            </div>
            <div id="selectedTransactionList"></div>
        </div>
    </div>
    <div id="mdDetail">
        <div id="specsDetail" style="text-align: center;">
            <div class="headerMaster" style="width: 1000px; margin-top: 57px; margin-bottom: 57px; margin-left: auto; margin-right: auto;">
                <table class="kv" style="width: 100%;">
                    <thead style="border-bottom: 1px solid #d9d9d9;">
                        <tr>
                            <td class="kvKey" style="padding-bottom: 10px;">&nbsp;</td>
                            <td class="kvValue">All displayed data is validated against the trusted checkpoint beacon block root (settings)</td>
                        </tr>
                    </thead>
                    <tr>
                        <td class="kvKey">Consensus light client</td>
                        <td class="kvValue">
                            <a href="https://www.youtube.com/watch?v=ZHNrAXf3RDE" target="_blank">Overview (video)</a><br />
                            <a href="https://github.com/ethereum/consensus-specs/blob/dev/specs/altair/light-client/light-client.md" target="_blank">Sync process</a><br />
                            <a href="https://github.com/status-im/nimbus-eth2/blob/stable/beacon_chain/libnimbus_lc/libnimbus_lc.h" target="_blank">Wasm library</a><br />
                            <a href="https://github.com/eth-clients/eth2-networks/tree/master/shared/mainnet" target="_blank">Mainnet network config</a><br />
                            <a href="https://ethereum.github.io/beacon-APIs/#/Beacon/getLightClientBootstrap" target="_blank">/eth/v1/beacon/light_client/bootstrap/{block_root}</a><br />
                            <a href="https://ethereum.github.io/beacon-APIs/#/Beacon/getLightClientUpdatesByRange" target="_blank">/eth/v1/beacon/light_client/updates</a><br />
                            <a href="https://ethereum.github.io/beacon-APIs/#/Beacon/getLightClientFinalityUpdate" target="_blank">/eth/v1/beacon/light_client/finality_update</a><br />
                            <a href="https://ethereum.github.io/beacon-APIs/#/Beacon/getLightClientOptimisticUpdate" target="_blank">/eth/v1/beacon/light_client/optimistic_update</a><br />
                            <a href="https://ethereum.github.io/beacon-APIs/#/Events/eventstream" target="_blank">/eth/v1/events</a><br />
                        </td>
                    </tr>
                    <tr>
                        <td class="kvKey">Execution APIs</td>
                        <td class="kvValue">
                            <a href="https://ethereum.org/en/developers/docs/apis/json-rpc/#eth_getblockbyhash" target="_blank">eth_getBlockByHash</a><br />
                            <a href="https://ethereum.org/en/developers/docs/apis/json-rpc/#eth_gettransactionreceipt" target="_blank">eth_getTransactionReceipt</a><br />
                        </td>
                    </tr>
                    <tr>
                        <td class="kvKey">Transactions</td>
                        <td class="kvValue">
                            <a href="https://ethereum.github.io/yellowpaper/paper.pdf" target="_blank">Yellow paper</a><br />
                            <a href="https://eips.ethereum.org/EIPS/eip-155" target="_blank">Replay protection (EIP-155)</a><br />
                            <a href="https://eips.ethereum.org/EIPS/eip-2718" target="_blank">Typed transactions (EIP-2718)</a><br />
                            <a href="https://eips.ethereum.org/EIPS/eip-2930" target="_blank">Access lists (EIP-2930)</a><br />
                            <a href="https://eips.ethereum.org/EIPS/eip-1559" target="_blank">Priority fees (EIP-1559)</a><br />
                            <a href="https://eips.ethereum.org/EIPS/eip-4844" target="_blank">Blob transactions (EIP-4844)</a><br />
                            <a href="https://eips.ethereum.org/EIPS/eip-7702" target="_blank">Set code transactions (EIP-7702)</a><br />
                        </td>
                    </tr>
                    <tr>
                        <td class="kvKey">Receipts</td>
                        <td class="kvValue">
                            <a href="https://eips.ethereum.org/EIPS/eip-658" target="_blank">Status code (EIP-658)</a><br />
                            <a href="https://eips.ethereum.org/EIPS/eip-2718" target="_blank">Typed receipts (EIP-2718)</a><br />
                        </td>
                    </tr>
                    <tr>
                        <td class="kvKey">Withdrawals</td>
                        <td class="kvValue">
                            <a href="https://eips.ethereum.org/EIPS/eip-4895" target="_blank">Withdrawals (EIP-4895)</a><br />
                        </td>
                    </tr>
                    <tr>
                        <td class="kvKey">RLP</td>
                        <td class="kvValue">
                            <a href="https://ethereum.org/en/developers/docs/data-structures-and-encoding/rlp/" target="_blank">Serialization</a><br />
                            <a href="https://ethereum.org/en/developers/docs/data-structures-and-encoding/patricia-merkle-trie/" target="_blank">Merkle Patricia Trie</a><br />
                            <a href="https://github.com/ethereum/devp2p/blob/master/caps/eth.md" target="_blank">Networking</a><br />
                        </td>
                    </tr>
                    <tr>
                        <td class="kvKey">SSZ</td>
                        <td class="kvValue">
                            <a href="https://eth2book.info/capella/part2/building_blocks/ssz/" target="_blank">Introduction</a><br />
                            <a href="https://ethereum.org/en/developers/docs/data-structures-and-encoding/ssz/" target="_blank">Overview</a><br />
                            <a href="https://github.com/ethereum/consensus-specs/blob/dev/ssz/simple-serialize.md" target="_blank">Serialization</a><br />
                            <a href="https://github.com/ethereum/consensus-specs/blob/dev/ssz/merkle-proofs.md" target="_blank">Merkleization</a><br />
                        </td>
                    </tr>
                    <tr>
                        <td class="kvKey">Pending EIPs</td>
                        <td class="kvValue">
                            <a href="https://eips.ethereum.org/EIPS/eip-7495" target="_blank">SSZ StableContainer (EIP-7495)</a><br />
                            <a href="https://eips.ethereum.org/EIPS/eip-6404" target="_blank">SSZ Transactions (EIP-6404)</a><br />
                            <a href="https://eips.ethereum.org/EIPS/eip-6466" target="_blank">SSZ Receipts (EIP-6466)</a><br />
                            <a href="https://eips.ethereum.org/EIPS/eip-6493" target="_blank">SSZ Transaction Signature Scheme (EIP-6493)</a><br />
                            <a href="https://eips.ethereum.org/EIPS/eip-6465" target="_blank">SSZ Withdrawals Root (EIP-6465)</a><br />
                        </td>
                    </tr>
                </table>
            </div>
        </div>
        <div id="selectedTransactionRlpDetail" hidden="hidden" style="text-align: center;">
            <div class="headerMaster" style="width: 1000px; margin-top: 57px; margin-bottom: 57px; margin-left: auto; margin-right: auto;">
                <table class="kv" style="width: 100%;">
                    <thead style="border-bottom: 1px solid #d9d9d9;">
                        <tr>
                            <td class="kvKey" style="padding-bottom: 10px;">Hash</td>
                            <td class="kvValue"><div id="selectedTransactionRlpHash"></div></td>
                        </tr>
                    </thead>
                    <tbody>
                        <tr id="selectedTransactionRlpHasType">
                            <td class="kvKey"><a href="https://eips.ethereum.org/EIPS/eip-2718" target="_blank">EIP-2718</a> type</td>
                            <td class="kvValue"><span id="selectedTransactionRlpType"></span> <span class="description">(<span id="selectedTransactionRlpTypeDescription"></span>)</span></td>
                        </tr>
                        <tr>
                            <td class="kvKey">Payload length</td>
                            <td class="kvValue"><span id="selectedTransactionRlpLength"></span> <span class="description">(<span id="selectedTransactionRlpLengthDescription"></span>)</span></td>
                        </tr>
                        <tr id="selectedTransactionRlpHasChainId">
                            <td class="kvKey"><a href="https://eips.ethereum.org/EIPS/eip-155" target="_blank">Chain ID</a></td>
                            <td class="kvValue"><span id="selectedTransactionRlpChainIdLength"></span> <span id="selectedTransactionRlpChainId"></span></td>
                        </tr>
                        <tr>
                            <td class="kvKey">Nonce</td>
                            <td class="kvValue"><span id="selectedTransactionRlpNonceLength"></span> <span id="selectedTransactionRlpNonce"></span> <span class="description">(<span id="selectedTransactionRlpNonceDescription"></span>)</span></td>
                        </tr>
                        <tr id="selectedTransactionRlpHasMaxPriorityFeePerGas">
                            <td class="kvKey"><a href="https://eips.ethereum.org/EIPS/eip-1559" target="_blank">Max prio fee per gas</a></td>
                            <td class="kvValue"><span id="selectedTransactionRlpMaxPriorityFeePerGasLength"></span> <span id="selectedTransactionRlpMaxPriorityFeePerGas"></span> <span class="description">(<span id="selectedTransactionRlpMaxPriorityFeePerGasDescription"></span>)</span></td>
                        </tr>
                        <tr>
                            <td class="kvKey">Max fee per gas</td>
                            <td class="kvValue"><span id="selectedTransactionRlpMaxFeePerGasLength"></span> <span id="selectedTransactionRlpMaxFeePerGas"></span> <span class="description">(<span id="selectedTransactionRlpMaxFeePerGasDescription"></span>)</span></td>
                        </tr>
                        <tr>
                            <td class="kvKey">Gas</td>
                            <td class="kvValue"><span id="selectedTransactionRlpGasLength"></span> <span id="selectedTransactionRlpGas"></span> <span class="description">(<span id="selectedTransactionRlpGasDescription"></span>)</span></td>
                        </tr>
                        <tr>
                            <td class="kvKey">To</td>
                            <td class="kvValue"><span id="selectedTransactionRlpToLength"></span> <span id="selectedTransactionRlpTo"></span> <span class="description">(<span id="selectedTransactionRlpToDescription"></span>)</span></td>
                        </tr>
                        <tr>
                            <td class="kvKey">Value</td>
                            <td class="kvValue"><span id="selectedTransactionRlpValueLength"></span> <span id="selectedTransactionRlpValue"></span> <span class="description">(<span id="selectedTransactionRlpValueDescription"></span>)</span></td>
                        </tr>
                        <tr>
                            <td class="kvKey">Input</td>
                            <td class="kvValue"><span id="selectedTransactionRlpInputLength"></span> <span class="description">(<span id="selectedTransactionRlpInputDescription"></span>)</span> <span id="selectedTransactionRlpInput"></span></td>
                        </tr>
                        <tr id="selectedTransactionRlpHasAccessList">
                            <td class="kvKey"><a href="https://eips.ethereum.org/EIPS/eip-2930" target="_blank">Access list</a><span id="selectedTransactionRlpAccessListLabel"></span></td>
                            <td class="kvValue"><span id="selectedTransactionRlpAccessListLength"></span> <span class="description">(<span id="selectedTransactionRlpAccessListDescription"></span>)</span> <span id="selectedTransactionRlpAccessList"></span></td>
                        </tr>
                        <tr id="selectedTransactionRlpHasMaxFeePerBlobGas">
                            <td class="kvKey"><a href="https://eips.ethereum.org/EIPS/eip-4844" target="_blank">Max fee per blob gas</a></td>
                            <td class="kvValue"><span id="selectedTransactionRlpMaxFeePerBlobGasLength"></span> <span id="selectedTransactionRlpMaxFeePerBlobGas"></span> <span class="description">(<span id="selectedTransactionRlpMaxFeePerBlobGasDescription"></span>)</span></td>
                        </tr>
                        <tr id="selectedTransactionRlpHasBlobVersionedHashes">
                            <td class="kvKey"><a href="https://eips.ethereum.org/EIPS/eip-4844" target="_blank">Blob versioned hashes</a></td>
                            <td class="kvValue"><span id="selectedTransactionRlpBlobVersionedHashesLength"></span> <span class="description">(<span id="selectedTransactionRlpBlobVersionedHashesDescription"></span>)</span> <span id="selectedTransactionRlpBlobVersionedHashes"></span></td>
                        </tr>
                        <tr id="selectedTransactionRlpHasAuthorizationList">
                            <td class="kvKey"><a href="https://eips.ethereum.org/EIPS/eip-7702" target="_blank">Authorization list</a><span id="selectedTransactionRlpAuthorizationListLabel"></span></td>
                            <td class="kvValue"><span id="selectedTransactionRlpAuthorizationListLength"></span> <span class="description">(<span id="selectedTransactionRlpAuthorizationListDescription"></span>)</span> <span id="selectedTransactionRlpAuthorizationList"></span></td>
                        </tr>
                        <tr>
                            <td class="kvKey">V</td>
                            <td class="kvValue"><span id="selectedTransactionRlpVLength"></span> <span id="selectedTransactionRlpV"></span> <span class="description">(<span id="selectedTransactionRlpVDescription"></span>)</span></td>
                        </tr>
                        <tr>
                            <td class="kvKey">R</td>
                            <td class="kvValue"><span id="selectedTransactionRlpRLength"></span> <span id="selectedTransactionRlpR"></span></td>
                        </tr>
                        <tr>
                            <td class="kvKey">S</td>
                            <td class="kvValue"><span id="selectedTransactionRlpSLength"></span> <span id="selectedTransactionRlpS"></span></td>
                        </tr>
                        <tr>
                            <td class="kvKey">&nbsp;</td>
                            <td class="kvValue"><input type="button" id="copyTransactionRlpButton" value="Copy" /></td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
        <div id="selectedReceiptRlpDetail" hidden="hidden" style="text-align: center;">
            <div class="headerMaster" style="width: 1000px; margin-top: 57px; margin-bottom: 57px; margin-left: auto; margin-right: auto;">
                <table class="kv" style="width: 100%;">
                    <thead style="border-bottom: 1px solid #d9d9d9;">
                        <tr>
                            <td class="kvKey" style="padding-bottom: 10px;">Transaction hash</td>
                            <td class="kvValue"><div id="selectedReceiptRlpTransactionHash"></div></td>
                        </tr>
                    </thead>
                    <tbody>
                        <tr id="selectedReceiptRlpHasType">
                            <td class="kvKey"><a href="https://eips.ethereum.org/EIPS/eip-2718" target="_blank">EIP-2718</a> type</td>
                            <td class="kvValue"><span id="selectedReceiptRlpType"></span> <span class="description">(<span id="selectedReceiptRlpTypeDescription"></span>)</span></td>
                        </tr>
                        <tr>
                            <td class="kvKey">Payload length</td>
                            <td class="kvValue"><span id="selectedReceiptRlpLength"></span> <span class="description">(<span id="selectedReceiptRlpLengthDescription"></span>)</span></td>
                        </tr>
                        <tr id="selectedReceiptRlpHasRoot">
                            <td class="kvKey">Root</td>
                            <td class="kvValue"><span id="selectedReceiptRlpRootLength"></span> <span id="selectedReceiptRlpRoot"></span></td>
                        </tr>
                        <tr id="selectedReceiptRlpHasStatus">
                            <td class="kvKey"><a href="https://eips.ethereum.org/EIPS/eip-658" target="_blank">Status</a></td>
                            <td class="kvValue"><span id="selectedReceiptRlpStatusLength"></span> <span id="selectedReceiptRlpStatus"></span> <span class="description">(<span id="selectedReceiptRlpStatusDescription"></span>)</span></td>
                        </tr>
                        <tr>
                            <td class="kvKey">Cumulative gas used</td>
                            <td class="kvValue"><span id="selectedReceiptRlpCumulativeGasUsedLength"></span> <span id="selectedReceiptRlpCumulativeGasUsed"></span> <span class="description">(<span id="selectedReceiptRlpCumulativeGasUsedDescription"></span>)</span></td>
                        </tr>
                        <tr>
                            <td class="kvKey">Logs Bloom</td>
                            <td class="kvValue"><span id="selectedReceiptRlpLogsBloomLength"></span> <span id="selectedReceiptRlpLogsBloom"></span></td>
                        </tr>
                        <tr>
                            <td class="kvKey">Logs<span id="selectedReceiptRlpLogsLabel"></span></td>
                            <td class="kvValue"><span id="selectedReceiptRlpLogsLength"></span> <span class="description">(<span id="selectedReceiptRlpLogsDescription"></span>)</span> <span id="selectedReceiptRlpLogs"></span></td>
                        </tr>
                        <tr>
                            <td class="kvKey">&nbsp;</td>
                            <td class="kvValue"><input type="button" id="copyReceiptRlpButton" value="Copy" /></td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
        <div id="selectedTransactionEip6404Detail" hidden="hidden" style="text-align: center;">
            <div class="headerMaster" style="width: 1000px; margin-top: 57px; margin-bottom: 57px; margin-left: auto; margin-right: auto;">
                <table class="kv" style="width: 100%;">
                    <thead style="border-bottom: 1px solid #d9d9d9;">
                        <tr>
                            <td class="kvKey" style="padding-bottom: 10px;"><a href="https://eips.ethereum.org/EIPS/eip-6404" target="_blank">EIP-6404</a> root</td>
                            <td class="kvValue"><div id="selectedTransactionEip6404Root"></div></td>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td class="kvKey">Payload offset</td>
                            <td class="kvValue"><span id="selectedTransactionEip6404PayloadOffset"></span> <span class="description">(start +<span id="selectedTransactionEip6404PayloadOffsetDescription"></span>)</span></td>
                        </tr>
                        <tr>
                            <td class="kvKey">Signature offset</td>
                            <td class="kvValue"><span id="selectedTransactionEip6404SignatureOffset"></span> <span class="description">(start +<span id="selectedTransactionEip6404SignatureOffsetDescription"></span>)</span></td>
                        </tr>
                        <tr>
                            <td class="kvKey">Payload active fields</td>
                            <td class="kvValue"><span id="selectedTransactionEip6404PayloadActiveFields"></span> <span class="description">(<span id="selectedTransactionEip6404PayloadActiveFieldsDescription"></span>)</span></td>
                        </tr>
                        <tr id="selectedTransactionEip6404PayloadHasType">
                            <td class="kvKey"><a href="https://eips.ethereum.org/EIPS/eip-2718" target="_blank">EIP-2718</a> type</td>
                            <td class="kvValue"><span id="selectedTransactionEip6404PayloadType"></span> <span class="description">(<span id="selectedTransactionEip6404PayloadTypeDescription"></span>)</span></td>
                        </tr>
                        <tr id="selectedTransactionEip6404PayloadHasChainId">
                            <td class="kvKey"><a href="https://eips.ethereum.org/EIPS/eip-155" target="_blank">EIP-155</a> chain ID</td>
                            <td class="kvValue"><span id="selectedTransactionEip6404PayloadChainId"></span></td>
                        </tr>
                        <tr id="selectedTransactionEip6404PayloadHasNonce">
                            <td class="kvKey">Nonce</td>
                            <td class="kvValue"><span id="selectedTransactionEip6404PayloadNonce"></span> <span class="description">(<span id="selectedTransactionEip6404PayloadNonceDescription"></span>)</span></td>
                        </tr>
                        <tr id="selectedTransactionEip6404PayloadHasMaxFeesPerGasOffset">
                            <td class="kvKey">Fees offset</td>
                            <td class="kvValue"><span id="selectedTransactionEip6404PayloadMaxFeesPerGasOffset"></span> <span class="description">(payload data +<span id="selectedTransactionEip6404PayloadMaxFeesPerGasOffsetDescription"></span>)</span></td>
                        </tr>
                        <tr id="selectedTransactionEip6404PayloadHasGas">
                            <td class="kvKey">Gas</td>
                            <td class="kvValue"><span id="selectedTransactionEip6404PayloadGas"></span> <span class="description">(<span id="selectedTransactionEip6404PayloadGasDescription"></span>)</span></td>
                        </tr>
                        <tr id="selectedTransactionEip6404PayloadHasTo">
                            <td class="kvKey">To</td>
                            <td class="kvValue"><span id="selectedTransactionEip6404PayloadTo"></span> <span class="description">(<span id="selectedTransactionEip6404PayloadToDescription"></span>)</span></td>
                        </tr>
                        <tr id="selectedTransactionEip6404PayloadHasValue">
                            <td class="kvKey">Value</td>
                            <td class="kvValue"><span id="selectedTransactionEip6404PayloadValue"></span> <span class="description">(<span id="selectedTransactionEip6404PayloadValueDescription"></span>)</span></td>
                        </tr>
                        <tr id="selectedTransactionEip6404PayloadHasInputOffset">
                            <td class="kvKey">Input offset</td>
                            <td class="kvValue"><span id="selectedTransactionEip6404PayloadInputOffset"></span> <span class="description">(payload data +<span id="selectedTransactionEip6404PayloadInputOffsetDescription"></span>)</span></td>
                        </tr>
                        <tr id="selectedTransactionEip6404PayloadHasAccessListOffset">
                            <td class="kvKey"><a href="https://eips.ethereum.org/EIPS/eip-2930" target="_blank">Access list</a> offset</td>
                            <td class="kvValue"><span id="selectedTransactionEip6404PayloadAccessListOffset"></span> <span class="description">(payload data +<span id="selectedTransactionEip6404PayloadAccessListOffsetDescription"></span>)</span></td>
                        </tr>
                        <tr id="selectedTransactionEip6404PayloadHasMaxPriorityFeesPerGasOffset">
                            <td class="kvKey">Priority fees offset</td>
                            <td class="kvValue"><span id="selectedTransactionEip6404PayloadMaxPriorityFeesPerGasOffset"></span> <span class="description">(payload data +<span id="selectedTransactionEip6404PayloadMaxPriorityFeesPerGasOffsetDescription"></span>)</span></td>
                        </tr>
                        <tr id="selectedTransactionEip6404PayloadHasBlobVersionedHashesOffset">
                            <td class="kvKey"><a href="https://eips.ethereum.org/EIPS/eip-4844" target="_blank">Blob versioned hashes</a> offset</td>
                            <td class="kvValue"><span id="selectedTransactionEip6404PayloadBlobVersionedHashesOffset"></span> <span class="description">(payload data +<span id="selectedTransactionEip6404PayloadBlobVersionedHashesOffsetDescription"></span>)</span></td>
                        </tr>
                        <tr id="selectedTransactionEip6404PayloadHasAuthorizationListOffset">
                            <td class="kvKey"><a href="https://eips.ethereum.org/EIPS/eip-7702" target="_blank">Authorization list</a> offset</td>
                            <td class="kvValue"><span id="selectedTransactionEip6404PayloadAuthorizationListOffset"></span> <span class="description">(payload data +<span id="selectedTransactionEip6404PayloadAuthorizationListOffsetDescription"></span>)</span></td>
                        </tr>
                        <tr id="selectedTransactionEip6404PayloadHasMaxFeesPerGas">
                            <td class="kvKey">Fees active fields</td>
                            <td class="kvValue"><span id="selectedTransactionEip6404PayloadMaxFeesPerGasActiveFields"></span> <span class="description">(<span id="selectedTransactionEip6404PayloadMaxFeesPerGasActiveFieldsDescription"></span>)</span></td>
                        </tr>
                        <tr id="selectedTransactionEip6404PayloadHasMaxFeePerRegularGas">
                            <td class="kvKey">Max fee per regular gas</td>
                            <td class="kvValue"><span id="selectedTransactionEip6404PayloadMaxFeePerRegularGas"></span> <span class="description">(<span id="selectedTransactionEip6404PayloadMaxFeePerRegularGasDescription"></span>)</span></td>
                        </tr>
                        <tr id="selectedTransactionEip6404PayloadHasMaxFeePerBlobGas">
                            <td class="kvKey"><a href="https://eips.ethereum.org/EIPS/eip-4844" target="_blank">Max fee per blob gas</a></td>
                            <td class="kvValue"><span id="selectedTransactionEip6404PayloadMaxFeePerBlobGas"></span> <span class="description">(<span id="selectedTransactionEip6404PayloadMaxFeePerBlobGasDescription"></span>)</span></td>
                        </tr>
                        <tr id="selectedTransactionEip6404PayloadHasInput">
                            <td class="kvKey">Input</td>
                            <td class="kvValue"><span id="selectedTransactionEip6404PayloadInput"></span> <span class="description">(<span id="selectedTransactionEip6404PayloadInputDescription"></span>)</span></td>
                        </tr>
                        <tr id="selectedTransactionEip6404PayloadHasAccessList">
                            <td class="kvKey"><a href="https://eips.ethereum.org/EIPS/eip-2930" target="_blank">Access list</a><span id="selectedTransactionEip6404PayloadAccessListLabel"></span></td>
                            <td class="kvValue"><span id="selectedTransactionEip6404PayloadAccessListStart"></span> <span class="description">(<span id="selectedTransactionEip6404PayloadAccessListDescription"></span>)</span> <span id="selectedTransactionEip6404PayloadAccessList"></span></td>
                        </tr>
                        <tr id="selectedTransactionEip6404PayloadHasMaxPriorityFeesPerGas">
                            <td class="kvKey">Priority fees active fields</td>
                            <td class="kvValue"><span id="selectedTransactionEip6404PayloadMaxPriorityFeesPerGasActiveFields"></span> <span class="description">(<span id="selectedTransactionEip6404PayloadMaxPriorityFeesPerGasActiveFieldsDescription"></span>)</span></td>
                        </tr>
                        <tr id="selectedTransactionEip6404PayloadHasMaxPriorityFeePerRegularGas">
                            <td class="kvKey"><a href="https://eips.ethereum.org/EIPS/eip-1559" target="_blank">Max prio fee per regular gas</a></td></td>
                            <td class="kvValue"><span id="selectedTransactionEip6404PayloadMaxPriorityFeePerRegularGas"></span> <span class="description">(<span id="selectedTransactionEip6404PayloadMaxPriorityFeePerRegularGasDescription"></span>)</span></td>
                        </tr>
                        <tr id="selectedTransactionEip6404PayloadHasMaxPriorityFeePerBlobGas">
                            <td class="kvKey"><a href="https://eips.ethereum.org/EIPS/eip-4844" target="_blank">Max prio fee per blob gas</a></td>
                            <td class="kvValue"><span id="selectedTransactionEip6404PayloadMaxPriorityFeePerBlobGas"></span> <span class="description">(<span id="selectedTransactionEip6404PayloadMaxPriorityFeePerBlobGasDescription"></span>)</span></td>
                        </tr>
                        <tr id="selectedTransactionEip6404PayloadHasBlobVersionedHashes">
                            <td class="kvKey"><a href="https://eips.ethereum.org/EIPS/eip-4844" target="_blank">Blob versioned hashes</a><span id="selectedTransactionEip6404PayloadBlobVersionedHashesLabel"></span></td>
                            <td class="kvValue"><span id="selectedTransactionEip6404PayloadBlobVersionedHashes"></span></td>
                        </tr>
                        <tr id="selectedTransactionEip6404PayloadHasAuthorizationList">
                            <td class="kvKey"><a href="https://eips.ethereum.org/EIPS/eip-7702" target="_blank">Authorization list</a><span id="selectedTransactionEip6404PayloadAuthorizationListLabel"></span></td>
                            <td class="kvValue"><span id="selectedTransactionEip6404PayloadAuthorizationListStart"></span> <span class="description">(<span id="selectedTransactionEip6404PayloadAuthorizationListDescription"></span>)</span> <span id="selectedTransactionEip6404PayloadAuthorizationList"></span></td>
                        </tr>
                        <tr>
                            <td class="kvKey">Signature active fields</td>
                            <td class="kvValue"><span id="selectedTransactionEip6404SignatureActiveFields"></span> <span class="description">(<span id="selectedTransactionEip6404SignatureActiveFieldsDescription"></span>)</span></td>
                        </tr>
                        <tr id="selectedTransactionEip6404SignatureHasSecp256k1">
                            <td class="kvKey">Secp256k1</td>
                            <td class="kvValue"><span id="selectedTransactionEip6404SignatureSecp256k1"></span></td>
                        </tr>
                        <tr>
                            <td class="kvKey">&nbsp;</td>
                            <td class="kvValue"><input type="button" id="copyTransactionEip6404Button" value="Copy" /></td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
        <div id="selectedReceiptEip6466Detail" hidden="hidden" style="text-align: center;">
            <div class="headerMaster" style="width: 1000px; margin-top: 57px; margin-bottom: 57px; margin-left: auto; margin-right: auto;">
                <table class="kv" style="width: 100%;">
                    <thead style="border-bottom: 1px solid #d9d9d9;">
                        <tr>
                            <td class="kvKey" style="padding-bottom: 10px;"><a href="https://eips.ethereum.org/EIPS/eip-6404" target="_blank">EIP-6404</a> transaction root</td>
                            <td class="kvValue"><div id="selectedReceiptEip6404TransactionRoot"></div></td>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td class="kvKey">Active fields</td>
                            <td class="kvValue"><span id="selectedReceiptEip6466ActiveFields"></span> <span class="description">(<span id="selectedReceiptEip6466ActiveFieldsDescription"></span>)</span></td>
                        </tr>
                        <tr id="selectedReceiptEip6466HasFrom">
                            <td class="kvKey">From</td>
                            <td class="kvValue"><span id="selectedReceiptEip6466From"></span> <span class="description">(<span id="selectedReceiptEip6466FromDescription"></span>)</span></td>
                        </tr>
                        <tr id="selectedReceiptEip6466HasGasUsed">
                            <td class="kvKey">Gas used</td>
                            <td class="kvValue"><span id="selectedReceiptEip6466GasUsed"></span> <span class="description">(<span id="selectedReceiptEip6466GasUsedDescription"></span>)</span></td>
                        </tr>
                        <tr id="selectedReceiptEip6466HasContractAddress">
                            <td class="kvKey">Contract address</td>
                            <td class="kvValue"><span id="selectedReceiptEip6466ContractAddress"></span> <span class="description">(<span id="selectedReceiptEip6466ContractAddressDescription"></span>)</span></td>
                        </tr>
                        <tr id="selectedReceiptEip6466HasLogsOffset">
                            <td class="kvKey">Logs offset</td>
                            <td class="kvValue"><span id="selectedReceiptEip6466LogsOffset"></span> <span class="description">(data +<span id="selectedReceiptEip6466LogsOffsetDescription"></span>)</span></td>
                        </tr>
                        <tr id="selectedReceiptEip6466HasStatus">
                            <td class="kvKey"><a href="https://eips.ethereum.org/EIPS/eip-658" target="_blank">Status</a></td>
                            <td class="kvValue"><span id="selectedReceiptEip6466Status"></span> <span class="description">(<span id="selectedReceiptEip6466StatusDescription"></span>)</span></td>
                        </tr>
                        <tr id="selectedReceiptEip6466HasAuthoritiesOffset">
                            <td class="kvKey"><a href="https://eips.ethereum.org/EIPS/eip-7702" target="_blank">Authorities</a> offset</td>
                            <td class="kvValue"><span id="selectedReceiptEip6466AuthoritiesOffset"></span> <span class="description">(data +<span id="selectedReceiptEip6466AuthoritiesOffsetDescription"></span>)</span></td>
                        </tr>
                        <tr id="selectedReceiptEip6466HasLogs">
                            <td class="kvKey">Logs<span id="selectedReceiptEip6466LogsLabel"></span></td>
                            <td class="kvValue"><span id="selectedReceiptEip6466LogsStart"></span> <span class="description">(<span id="selectedReceiptEip6466LogsDescription"></span>)</span> <span id="selectedReceiptEip6466Logs"></span></td>
                        </tr>
                        <tr id="selectedReceiptEip6466HasAuthorities">
                            <td class="kvKey"><a href="https://eips.ethereum.org/EIPS/eip-7702" target="_blank">Authorities</a><span id="selectedReceiptEip6466AuthoritiesLabel"></span></td>
                            <td class="kvValue"><span id="selectedReceiptEip6466Authorities"></span></td>
                        </tr>
                        <tr>
                            <td class="kvKey">&nbsp;</td>
                            <td class="kvValue"><input type="button" id="copyReceiptEip6466Button" value="Copy" /></td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <script>
        const networkMetadataPath = 'https://raw.githubusercontent.com/eth-clients/eth2-networks/master/shared/mainnet';

        async function loadCfg() {
            let response = undefined;
            do {
                if (response !== undefined) {
                    await new Promise(r => setTimeout(r, 5000));
                }
                response = await fetch(networkMetadataPath + '/config.yaml');
            } while (!response.ok);

            const data = await response.text();

            const fileContent = Module.stringToNewUTF8(data);
            const cfg = Module._ETHConsensusConfigCreateFromYaml(fileContent);
            assert(cfg);
            Module._free(fileContent);

            return cfg;
        }

        async function loadGenesis(cfg) {
            const consensusFork = Module._ETHConsensusConfigGetConsensusVersionAtEpoch(cfg, /* epoch: */ 0);
            const response = await fetch(networkMetadataPath + '/genesis.ssz');
            assert(response.ok);
            const data = await response.arrayBuffer();
            const sszBytes = new Uint8Array(data)

            const sszBytesPtr = Module._malloc(sszBytes.length);
            Module.HEAPU8.set(sszBytes, sszBytesPtr);
            const state = Module._ETHBeaconStateCreateFromSsz(cfg, consensusFork, sszBytesPtr, sszBytes.length);
            assert(state);
            Module._free(sszBytesPtr);

            return state;
        }

        var Module = {};

        let beaconApiBase = undefined;
        let executionApiBase = undefined;

        const zeroHash = '0x0000000000000000000000000000000000000000000000000000000000000000';

        function toArray(bytes, numBytes) {
            return Array.from(Module.HEAPU8.subarray(bytes, bytes + numBytes));
        }

        function byteToHexString(byte) {
            return byte.toString(16).padStart(2, '0');
        }

        function arrayToHexString(array) {
            return array.reduce((str, byte) => str + byte.toString(16).padStart(2, '0'), '');
        }

        function toHexString(bytes, numBytes) {
            return '0x' + arrayToHexString(toArray(bytes, numBytes));
        }

        function arrayToDecString(array) {
            if (array.length === 0) {
                return '0';
            }
            return BigInt('0x' + arrayToHexString(array)).toString();
        }

        function toDecString(bytes, numBytes) {
            return BigInt('0x' + arrayToHexString(toArray(bytes, numBytes).reverse())).toString();
        }

        function arrayToBinString(array) {
            return array.reduce((str, byte) => str + byte.toString(2).padStart(8, '0').split('').reverse().join(''), '');
        }

        function toHumanReadableByteCountString(numBytes) {
            if (numBytes >= 1e12) {
                return (numBytes / 1e12).toFixed(1) + ' TB';
            }
            if (numBytes >= 1e11) {
                return (numBytes / 1e9).toFixed(0) + ' GB';
            }
            if (numBytes >= 1e9) {
                return (numBytes / 1e9).toFixed(1) + ' GB';
            }
            if (numBytes >= 1e8) {
                return (numBytes / 1e6).toFixed(0) + ' MB';
            }
            if (numBytes >= 1e6) {
                return (numBytes / 1e6).toFixed(1) + ' MB';
            }
            if (numBytes >= 1e5) {
                return (numBytes / 1e3).toFixed(0) + ' KB';
            }
            if (numBytes >= 1e3) {
                return (numBytes / 1e3).toFixed(1) + ' KB';
            }
            if (numBytes == 1) {
                return numBytes + ' byte';
            }
            return numBytes + ' bytes';
        }

        function toHumanReadableNumberString(number) {
            if (number >= 1e12) {
                return (number / 1e12).toFixed(1) + 't';
            }
            if (number >= 1e11) {
                return (number / 1e9).toFixed(0) + 'b';
            }
            if (number >= 1e9) {
                return (number / 1e9).toFixed(1) + 'b';
            }
            if (number >= 1e8) {
                return (number / 1e6).toFixed(0) + 'm';
            }
            if (number >= 1e6) {
                return (number / 1e6).toFixed(1) + 'm';
            }
            if (number >= 1e5) {
                return (number / 1e3).toFixed(0) + 'k';
            }
            if (number >= 1e3) {
                return (number / 1e3).toFixed(1) + 'k';
            }
            return number.toString();
        }

        function toDateString(timestamp) {
            const date = new Date(timestamp * 1000);
            const year = date.getFullYear();
            const month = ('0' + (date.getMonth() + 1)).slice(-2);
            const day = ('0' + date.getDate()).slice(-2);
            const hours = ('0' + date.getHours()).slice(-2);
            const minutes = ('0' + date.getMinutes()).slice(-2);
            const seconds = ('0' + date.getSeconds()).slice(-2);
            return `${year}-${month}-${day} ${hours}:${minutes}:${seconds}`;
        }

        function arrayToGweiString(array) {
            if (array.length === 0) {
                return '0';
            }
            const wei = BigInt('0x' + array.reduce((str, byte) => str + byte.toString(16).padStart(2, '0'), ''));
            const weiString = wei.toString().padStart(9, '0');
            const beforeDecimal = weiString.substring(0, weiString.length - 9);
            if (beforeDecimal === '') {
                return '0';
            }
            return beforeDecimal;
        }

        function toGweiString(bytes, numBytes) {
            return arrayToGweiString(Array.from(Module.HEAPU8.subarray(bytes, bytes + numBytes)).reverse());
        }

        function arrayToEthString(array) {
            if (array.length === 0) {
                return '0';
            }
            const wei = BigInt('0x' + array.reduce((str, byte) => str + byte.toString(16).padStart(2, '0'), ''));
            const weiString = wei.toString().padStart(18, '0');
            const beforeDecimal = weiString.substring(0, weiString.length - 18);
            const afterDecimal = weiString.substring(weiString.length - 18).replace(/0+$/, '');
            if (beforeDecimal === '') {
                if (afterDecimal === '') {
                    return '0';
                }
                return '0.' + afterDecimal;
            }
            if (afterDecimal === '') {
                return beforeDecimal;
            }
            return beforeDecimal + '.' + afterDecimal;
        }

        function toEthString(bytes, numBytes) {
            return arrayToEthString(Array.from(Module.HEAPU8.subarray(bytes, bytes + numBytes)).reverse());
        }

        function getBeaconRoot(header) {
            const beaconRoot = Module._ETHLightClientHeaderCopyBeaconRoot(header, cfg);
            const beaconRootString = toHexString(beaconRoot, 32);
            Module._ETHRootDestroy(beaconRoot);
            return beaconRootString;
        }

        function getBeaconSlot(header) {
            const beacon = Module._ETHLightClientHeaderGetBeacon(header);
            return Module._ETHBeaconBlockHeaderGetSlot(beacon);
        }

        function initHeadersCache() {
            let headers = [];
            let byRoot = {};
            let executionBlocks = {};

            return {
                'add': function (header, cfg) {
                    const beaconRoot = getBeaconRoot(header);
                    if (byRoot[beaconRoot]) {
                        return;
                    }

                    const beaconSlot = getBeaconSlot(header);
                    const i = headers.findIndex(x => (beaconSlot > getBeaconSlot(x)) ||
                        (beaconSlot == getBeaconSlot && beaconRoot < getBeaconRoot(x)));
                    const copy = Module._ETHLightClientHeaderCreateCopy(header)
                    headers.splice(i >= 0 ? i : headers.length, 0, copy);
                    byRoot[beaconRoot] = copy;

                    if (headers.length > 128) {
                        const removedHeader = headers.pop();
                        const removedBeaconRoot = getBeaconRoot(removedHeader);

                        const removedExecutionBlock = executionBlocks[removedBeaconRoot];
                        if (removedExecutionBlock) {
                            const [removedExecutionBlockHeader, removedTransactions, removedReceipts] = removedExecutionBlock;
                            delete executionBlocks[removedBeaconRoot];
                            Module._ETHReceiptsDestroy(removedReceipts);
                            Module._ETHTransactionsDestroy(removedTransactions);
                            Module._ETHExecutionBlockHeaderDestroy(removedExecutionBlockHeader);
                        }

                        delete byRoot[removedBeaconRoot];
                        Module._ETHLightClientHeaderDestroy(removedHeader);
                    }
                },

                'getAll': function () {
                    return headers;
                },

                'get': function (beaconRoot) {
                    return byRoot[beaconRoot];
                },

                'setExecutionBlock': function (beaconRoot, executionBlock) {
                    executionBlocks[beaconRoot] = executionBlock;
                },

                'getExecutionBlock': function (beaconRoot) {
                    return executionBlocks[beaconRoot];
                }
            };
        }

        let headers = initHeadersCache();

        async function fetchExecutionBlock(prefix, header) {
            const executionHash = Module._ETHLightClientHeaderCopyExecutionHash(header, cfg);
            try {
                const executionHashString = toHexString(executionHash, 32);
                if (executionHashString == zeroHash) return;
                const beaconRoot = getBeaconRoot(header);
                let executionBlock = headers.getExecutionBlock(beaconRoot);
                if (executionBlock) {
                    return executionBlock;
                }

                let data;
                try {
                    const executionBlockResponse = await fetch(executionApiBase, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                            jsonrpc: '2.0',
                            id: 1,
                            method: 'eth_getBlockByHash',
                            params: [executionHashString, /* fullTransactions: */ true]
                        })
                    });
                    if (!executionBlockResponse.ok) return;
                    const executionBlockJson = await executionBlockResponse.json();
                    if (!executionBlockJson.result) return;
                    data = executionBlockJson.result;
                } catch {
                    return;
                }
                if (!headers.get(beaconRoot)) return;

                const fullTransactions = JSON.stringify(data.transactions);
                for (txIndex in data.transactions) {
                    data.transactions[txIndex] = data.transactions[txIndex].hash;
                }
                document.getElementById(prefix + 'TransactionInfo').innerHTML =
                    data.transactions.length + ' transactions';

                const allReceiptResponseFuts = data.transactions.map((transactionHashString) =>
                    fetch(executionApiBase, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                            jsonrpc: '2.0',
                            id: 1,
                            method: 'eth_getTransactionReceipt',
                            params: [transactionHashString]
                        })
                    }));
                let receiptsData = [];
                for (receiptResponseFut of allReceiptResponseFuts) {
                    for (let i = 0; i < 20; i++) {
                        if (i) {
                            receiptResponseFut = fetch(executionApiBase, {
                                method: 'POST',
                                headers: {
                                    'Content-Type': 'application/json'
                                },
                                body: JSON.stringify({
                                    jsonrpc: '2.0',
                                    id: 1,
                                    method: 'eth_getTransactionReceipt',
                                    params: [data.transactions[receiptsData.length]]
                                })
                            });
                        }
                        try {
                            const receiptResponse = await receiptResponseFut;
                            if (!receiptResponse.ok) continue;
                            const receiptResponseJson = await receiptResponse.json();
                            if (!receiptResponseJson.result) continue;
                            receiptsData.push(receiptResponseJson.result);
                            document.getElementById(prefix + 'ReceiptInfo').innerHTML =
                                receiptsData.length + ' - Loading receipts&hellip;';
                            break;
                        } catch {
                            continue;
                        }
                    }
                    if (!headers.get(beaconRoot)) return;
                }

                const blockHeaderJson = Module.stringToNewUTF8(JSON.stringify(data));
                const executionBlockHeader = Module._ETHExecutionBlockHeaderCreateFromJson(executionHash, blockHeaderJson);
                Module._free(blockHeaderJson);
                if (!executionBlockHeader) return;

                const executionTransactionsRoot = Module._ETHExecutionBlockHeaderGetTransactionsRoot(executionBlockHeader);
                const transactionsJson = Module.stringToNewUTF8(fullTransactions);
                const transactions = Module._ETHTransactionsCreateFromJson(executionTransactionsRoot, transactionsJson);
                Module._free(transactionsJson);
                if (!transactions) {
                    Module._ETHExecutionBlockHeaderDestroy(executionBlockHeader);
                    return;
                }

                const execution = Module._ETHLightClientHeaderGetExecution(header);
                const executionReceiptsRoot = Module._ETHExecutionPayloadHeaderGetReceiptsRoot(execution);
                const receiptsJson = Module.stringToNewUTF8(JSON.stringify(receiptsData));
                const receipts = Module._ETHReceiptsCreateFromJson(executionReceiptsRoot, receiptsJson, transactions);
                Module._free(receiptsJson);
                if (!receipts) {
                    Module._ETHTransactionsDestroy(transactions);
                    Module._ETHExecutionBlockHeaderDestroy(executionBlockHeader);
                    return;
                }

                executionBlock = [executionBlockHeader, transactions, receipts];
                headers.setExecutionBlock(beaconRoot, executionBlock);
                return executionBlock;
            } finally {
                Module._ETHRootDestroy(executionHash);
            }
        }

        function toRlpInteger(b) {
            const length = b.length;
            assert(length > 0);
            if (length == 1) {
                return b[0];
            }
            return b[length - 1] + toRlpInteger(b.slice(0, -1)) * 256
        }

        function decodeRlpLength(input) {
            const length = input.length;
            assert(length > 0);
            const prefix = input[0];
            if (prefix <= 0x7f) {
                return {
                    'offset': 0,
                    'dataLen': 1,
                    'type': 'str'
                };
            }
            if (prefix <= 0xb7 && length > prefix - 0x80) {
                const strLen = prefix - 0x80;
                return {
                    'offset': 1,
                    'dataLen': strLen,
                    'type': 'str'
                };
            }
            if (prefix <= 0xbf && length > prefix - 0xb7 && length > prefix - 0xb7 + toRlpInteger(input.slice(1, 1 + prefix - 0xb7))) {
                const lenOfStrLen = prefix - 0xb7;
                const strLen = toRlpInteger(input.slice(1, 1 + lenOfStrLen));
                return {
                    'offset': 1 + lenOfStrLen,
                    'dataLen': strLen,
                    'type': 'str'
                };
            }
            if (prefix <= 0xf7 && length > prefix - 0xc0) {
                const listLen = prefix - 0xc0;
                return {
                    'offset': 1,
                    'dataLen': listLen,
                    'type': 'list'
                };
            }
            if (prefix <= 0xff && length > prefix - 0xf7 && length > prefix - 0xf7 + toRlpInteger(input.slice(1, 1 + prefix - 0xf7))) {
                const lenOfListLen = prefix - 0xf7;
                const listLen = toRlpInteger(input.slice(1, 1 + lenOfListLen));
                return {
                    'offset': 1 + lenOfListLen,
                    'dataLen': listLen,
                    'type': 'list'
                };
            }
            assert(false);
        }

        function visualizeTransactionRlp(transactionHash, transactionBytes) {
            document.getElementById('copyTransactionRlpButton').onclick = function() {
                navigator.clipboard.writeText(arrayToHexString(transactionBytes));
            };

            document.getElementById('selectedTransactionRlpHash').innerHTML =
                '<a href="https://etherscan.io/tx/' + transactionHash + '" target="_blank">' +
                transactionHash + '</a>';

            let bytes = transactionBytes;
            assert(bytes.length > 0);
            const type = bytes[0];

            if (type === 0x04) {
                document.getElementById('selectedTransactionRlpHasType').hidden = false;
                document.getElementById('selectedTransactionRlpType').innerText = byteToHexString(type);
                document.getElementById('selectedTransactionRlpTypeDescription').innerHTML =
                    '<a href="https://eips.ethereum.org/EIPS/eip-7702" target="_blank">EIP-7702</a>';
                bytes = bytes.slice(1);
            } else if (type === 0x03) {
                document.getElementById('selectedTransactionRlpHasType').hidden = false;
                document.getElementById('selectedTransactionRlpType').innerText = byteToHexString(type);
                document.getElementById('selectedTransactionRlpTypeDescription').innerHTML =
                    '<a href="https://eips.ethereum.org/EIPS/eip-4844" target="_blank">EIP-4844</a>';
                bytes = bytes.slice(1);
            } else if (type === 0x02) {
                document.getElementById('selectedTransactionRlpHasType').hidden = false;
                document.getElementById('selectedTransactionRlpType').innerText = byteToHexString(type);
                document.getElementById('selectedTransactionRlpTypeDescription').innerHTML =
                    '<a href="https://eips.ethereum.org/EIPS/eip-1559" target="_blank">EIP-1559</a>';
                bytes = bytes.slice(1);
            } else if (type === 0x01) {
                document.getElementById('selectedTransactionRlpHasType').hidden = false;
                document.getElementById('selectedTransactionRlpType').innerText = byteToHexString(type);
                document.getElementById('selectedTransactionRlpTypeDescription').innerHTML =
                    '<a href="https://eips.ethereum.org/EIPS/eip-2930" target="_blank">EIP-2930</a>';
                bytes = bytes.slice(1);
            } else if (type >= 0xc0 && type <= 0xfe) {
                document.getElementById('selectedTransactionRlpHasType').hidden = true;
            } else {
                assert(false);
            }

            const lengthInfo = decodeRlpLength(bytes);
            assert(lengthInfo.type === 'list');
            assert(lengthInfo.offset + lengthInfo.dataLen === bytes.length);
            const length = bytes.slice(0, lengthInfo.offset);
            bytes = bytes.slice(lengthInfo.offset);
            document.getElementById('selectedTransactionRlpLength').innerText = arrayToHexString(length);
            document.getElementById('selectedTransactionRlpLengthDescription').innerText = lengthInfo.dataLen + ' bytes';

            if (type === 0x04 || type === 0x03 || type === 0x02 || type === 0x01) {
                const chainIdInfo = decodeRlpLength(bytes);
                assert(chainIdInfo.type === 'str');
                const chainIdLength = bytes.slice(0, chainIdInfo.offset);
                bytes = bytes.slice(chainIdInfo.offset);
                const chainId = bytes.slice(0, chainIdInfo.dataLen);
                bytes = bytes.slice(chainIdInfo.dataLen);
                document.getElementById('selectedTransactionRlpHasChainId').hidden = false;
                document.getElementById('selectedTransactionRlpChainIdLength').innerText = arrayToHexString(chainIdLength);
                document.getElementById('selectedTransactionRlpChainId').innerText = arrayToHexString(chainId);
            } else {
                document.getElementById('selectedTransactionRlpHasChainId').hidden = true;
            }

            const nonceInfo = decodeRlpLength(bytes);
            assert(nonceInfo.type === 'str');
            const nonceLength = bytes.slice(0, nonceInfo.offset);
            bytes = bytes.slice(nonceInfo.offset);
            const nonce = bytes.slice(0, nonceInfo.dataLen);
            bytes = bytes.slice(nonceInfo.dataLen);
            document.getElementById('selectedTransactionRlpNonceLength').innerText = arrayToHexString(nonceLength);
            document.getElementById('selectedTransactionRlpNonce').innerText = arrayToHexString(nonce);
            document.getElementById('selectedTransactionRlpNonceDescription').innerText = arrayToDecString(nonce);

            if (type === 0x04 || type === 0x03 || type === 0x02) {
                const maxPriorityFeePerGasInfo = decodeRlpLength(bytes);
                assert(maxPriorityFeePerGasInfo.type === 'str');
                const maxPriorityFeePerGasLength = bytes.slice(0, maxPriorityFeePerGasInfo.offset);
                bytes = bytes.slice(maxPriorityFeePerGasInfo.offset);
                const maxPriorityFeePerGas = bytes.slice(0, maxPriorityFeePerGasInfo.dataLen);
                bytes = bytes.slice(maxPriorityFeePerGasInfo.dataLen);
                document.getElementById('selectedTransactionRlpHasMaxPriorityFeePerGas').hidden = false;
                document.getElementById('selectedTransactionRlpMaxPriorityFeePerGasLength').innerText = arrayToHexString(maxPriorityFeePerGasLength);
                document.getElementById('selectedTransactionRlpMaxPriorityFeePerGas').innerText = arrayToHexString(maxPriorityFeePerGas);
                document.getElementById('selectedTransactionRlpMaxPriorityFeePerGasDescription').innerText = arrayToGweiString(maxPriorityFeePerGas) + ' Gwei';
            } else {
                document.getElementById('selectedTransactionRlpHasMaxPriorityFeePerGas').hidden = true;
            }

            const maxFeePerGasInfo = decodeRlpLength(bytes);
            assert(maxFeePerGasInfo.type === 'str');
            const maxFeePerGasLength = bytes.slice(0, maxFeePerGasInfo.offset);
            bytes = bytes.slice(maxFeePerGasInfo.offset);
            const maxFeePerGas = bytes.slice(0, maxFeePerGasInfo.dataLen);
            bytes = bytes.slice(maxFeePerGasInfo.dataLen);
            document.getElementById('selectedTransactionRlpMaxFeePerGasLength').innerText = arrayToHexString(maxFeePerGasLength);
            document.getElementById('selectedTransactionRlpMaxFeePerGas').innerText = arrayToHexString(maxFeePerGas);
            document.getElementById('selectedTransactionRlpMaxFeePerGasDescription').innerText = arrayToGweiString(maxFeePerGas) + ' Gwei';

            const gasInfo = decodeRlpLength(bytes);
            assert(gasInfo.type === 'str');
            const gasLength = bytes.slice(0, gasInfo.offset);
            bytes = bytes.slice(gasInfo.offset);
            const gas = bytes.slice(0, gasInfo.dataLen);
            bytes = bytes.slice(gasInfo.dataLen);
            document.getElementById('selectedTransactionRlpGasLength').innerText = arrayToHexString(gasLength);
            document.getElementById('selectedTransactionRlpGas').innerText = arrayToHexString(gas);
            document.getElementById('selectedTransactionRlpGasDescription').innerText = toHumanReadableNumberString(Number(arrayToDecString(gas)));

            const toInfo = decodeRlpLength(bytes);
            assert(toInfo.type === 'str');
            const toLength = bytes.slice(0, toInfo.offset);
            bytes = bytes.slice(toInfo.offset);
            const to = bytes.slice(0, toInfo.dataLen);
            bytes = bytes.slice(toInfo.dataLen);
            document.getElementById('selectedTransactionRlpToLength').innerText = arrayToHexString(toLength);
            document.getElementById('selectedTransactionRlpTo').innerText = arrayToHexString(to);
            if (to.length > 0) {
                document.getElementById('selectedTransactionRlpToDescription').innerHTML =
                    '<a href="https://etherscan.io/address/0x' + arrayToHexString(to) + '" target="_blank">' +
                    'Destination' + '</a>';
            } else {
                document.getElementById('selectedTransactionRlpToDescription').innerText = 'Create';
            }

            const valueInfo = decodeRlpLength(bytes);
            assert(valueInfo.type === 'str');
            const valueLength = bytes.slice(0, valueInfo.offset);
            bytes = bytes.slice(valueInfo.offset);
            const value = bytes.slice(0, valueInfo.dataLen);
            bytes = bytes.slice(valueInfo.dataLen);
            document.getElementById('selectedTransactionRlpValueLength').innerText = arrayToHexString(valueLength);
            document.getElementById('selectedTransactionRlpValue').innerText = arrayToHexString(value);
            document.getElementById('selectedTransactionRlpValueDescription').innerText = arrayToEthString(value) + ' ETH';

            const inputInfo = decodeRlpLength(bytes);
            assert(inputInfo.type === 'str');
            const inputLength = bytes.slice(0, inputInfo.offset);
            bytes = bytes.slice(inputInfo.offset);
            const input = bytes.slice(0, inputInfo.dataLen);
            bytes = bytes.slice(inputInfo.dataLen);
            document.getElementById('selectedTransactionRlpInputLength').innerText = arrayToHexString(inputLength);
            if (inputInfo.dataLen > 0) {
                document.getElementById('selectedTransactionRlpInput').innerHTML =
                    '<br />' + (arrayToHexString(input).match(/.{1,64}/g) ?? []).join('<br />');
            } else {
                document.getElementById('selectedTransactionRlpInput').innerText = arrayToHexString(input);
            }
            document.getElementById('selectedTransactionRlpInputDescription').innerText = toHumanReadableByteCountString(inputInfo.dataLen);

            if (type === 0x04 || type === 0x03 || type === 0x02 || type === 0x01) {
                const accessListInfo = decodeRlpLength(bytes);
                assert(accessListInfo.type === 'list');
                const accessListLength = bytes.slice(0, accessListInfo.offset);
                bytes = bytes.slice(accessListInfo.offset);
                let accessList = bytes.slice(0, accessListInfo.dataLen);
                bytes = bytes.slice(accessListInfo.dataLen);
                document.getElementById('selectedTransactionRlpHasAccessList').hidden = false;
                document.getElementById('selectedTransactionRlpAccessListLength').innerText = arrayToHexString(accessListLength);
                document.getElementById('selectedTransactionRlpAccessListDescription').innerHTML = toHumanReadableByteCountString(accessListInfo.dataLen);
                document.getElementById('selectedTransactionRlpAccessList').innerHTML = '';
                document.getElementById('selectedTransactionRlpAccessListLabel').innerHTML = '';

                let accessTupleIndex = 0;
                while (accessList.length) {
                    const accessTupleInfo = decodeRlpLength(accessList);
                    assert(accessTupleInfo.type === 'list');
                    const accessTupleLength = accessList.slice(0, accessTupleInfo.offset);
                    accessList = accessList.slice(accessTupleInfo.offset);
                    let accessTuple = accessList.slice(0, accessTupleInfo.dataLen);
                    accessList = accessList.slice(accessTupleInfo.dataLen);
                    document.getElementById('selectedTransactionRlpAccessList').innerHTML +=
                        '<br /><span>' + arrayToHexString(accessTupleLength) + '</span> ' +
                        '<span class="description">(' + toHumanReadableByteCountString(accessTupleInfo.dataLen) + ')</span>';
                    document.getElementById('selectedTransactionRlpAccessListLabel').innerHTML +=
                        '<br /><span>[' + accessTupleIndex + ']</span>';

                    const addressInfo = decodeRlpLength(accessTuple);
                    assert(addressInfo.type === 'str');
                    const addressLength = accessTuple.slice(0, addressInfo.offset);
                    accessTuple = accessTuple.slice(addressInfo.offset);
                    const address = accessTuple.slice(0, addressInfo.dataLen);
                    accessTuple = accessTuple.slice(addressInfo.dataLen);
                    document.getElementById('selectedTransactionRlpAccessList').innerHTML +=
                        '<br /><span>' + arrayToHexString(addressLength) + '</span> ' +
                        '<span>' + arrayToHexString(address) + '</span>';
                    document.getElementById('selectedTransactionRlpAccessListLabel').innerHTML +=
                        '<br /><span><a href="https://etherscan.io/address/0x' + arrayToHexString(address) + '" target="_blank">Address</a></span>';

                    const storageKeysInfo = decodeRlpLength(accessTuple);
                    assert(storageKeysInfo.type === 'list');
                    const storageKeysLength = accessTuple.slice(0, storageKeysInfo.offset);
                    accessTuple = accessTuple.slice(storageKeysInfo.offset);
                    let storageKeys = accessTuple.slice(0, storageKeysInfo.dataLen);
                    accessTuple = accessTuple.slice(storageKeysInfo.dataLen);
                    document.getElementById('selectedTransactionRlpAccessList').innerHTML +=
                        '<br /><span>' + arrayToHexString(storageKeysLength) + '</span> ' +
                        '<span class="description">(' + toHumanReadableByteCountString(storageKeysInfo.dataLen) + ')</span>';
                    document.getElementById('selectedTransactionRlpAccessListLabel').innerHTML +=
                        '<br /><span>Storage keys</span>';

                    while (storageKeys.length) {
                        const storageKeyInfo = decodeRlpLength(storageKeys);
                        assert(storageKeyInfo.type === 'str');
                        const storageKeyLength = storageKeys.slice(0, storageKeyInfo.offset);
                        storageKeys = storageKeys.slice(storageKeyInfo.offset);
                        const storageKey = storageKeys.slice(0, storageKeyInfo.dataLen);
                        storageKeys = storageKeys.slice(storageKeyInfo.dataLen);
                        document.getElementById('selectedTransactionRlpAccessList').innerHTML +=
                            '<br /><span>' + arrayToHexString(storageKeyLength) + '</span> ' +
                            '<span>' + arrayToHexString(storageKey) + '</span>';
                        document.getElementById('selectedTransactionRlpAccessListLabel').innerHTML += '<br />';
                    }

                    assert(accessTuple.length === 0);
                    accessTupleIndex++;
                }
            } else {
                document.getElementById('selectedTransactionRlpHasAccessList').hidden = true;
            }

            if (type === 0x03) {
                const maxFeePerBlobGasInfo = decodeRlpLength(bytes);
                assert(maxFeePerBlobGasInfo.type === 'str');
                const maxFeePerBlobGasLength = bytes.slice(0, maxFeePerBlobGasInfo.offset);
                bytes = bytes.slice(maxFeePerBlobGasInfo.offset);
                const maxFeePerBlobGas = bytes.slice(0, maxFeePerBlobGasInfo.dataLen);
                bytes = bytes.slice(maxFeePerBlobGasInfo.dataLen);
                document.getElementById('selectedTransactionRlpHasMaxFeePerBlobGas').hidden = false;
                document.getElementById('selectedTransactionRlpMaxFeePerBlobGasLength').innerText = arrayToHexString(maxFeePerBlobGasLength);
                document.getElementById('selectedTransactionRlpMaxFeePerBlobGas').innerText = arrayToHexString(maxFeePerBlobGas);
                document.getElementById('selectedTransactionRlpMaxFeePerBlobGasDescription').innerText = arrayToGweiString(maxFeePerBlobGas) + ' Gwei';
            } else {
                document.getElementById('selectedTransactionRlpHasMaxFeePerBlobGas').hidden = true;
            }

            if (type === 0x03) {
                const blobVersionedHashesInfo = decodeRlpLength(accessTuple);
                assert(blobVersionedHashesInfo.type === 'list');
                const blobVersionedHashesLength = bytes.slice(0, blobVersionedHashesInfo.offset);
                bytes = bytes.slice(blobVersionedHashesInfo.offset);
                let blobVersionedHashes = bytes.slice(0, blobVersionedHashesInfo.dataLen);
                bytes = bytes.slice(blobVersionedHashesInfo.dataLen);
                document.getElementById('selectedTransactionRlpHasBlobVersionedHashes').hidden = false;
                document.getElementById('selectedTransactionRlpBlobVersionedHashesLength').innerText = arrayToHexString(blobVersionedHashesLength);
                document.getElementById('selectedTransactionRlpBlobVersionedHashes').innerHTML = '';
                document.getElementById('selectedTransactionRlpBlobVersionedHashesDescription').innerText = toHumanReadableByteCountString(blobVersionedHashesInfo.dataLen);

                while (blobVersionedHashes.length) {
                    const blobVersionedHashInfo = decodeRlpLength(blobVersionedHashes);
                    assert(blobVersionedHashInfo.type === 'str');
                    const blobVersionedHashLength = blobVersionedHashes.slice(0, blobVersionedHashInfo.offset);
                    blobVersionedHashes = blobVersionedHashes.slice(blobVersionedHashInfo.offset);
                    const blobVersionedHash = blobVersionedHashes.slice(0, blobVersionedHashInfo.dataLen);
                    blobVersionedHashes = blobVersionedHashes.slice(blobVersionedHashInfo.dataLen);
                    document.getElementById('selectedTransactionRlpBlobVersionedHashes').innerHTML +=
                        '<br /><span>' + arrayToHexString(blobVersionedHashLength) + '</span> ' +
                        '<span>' + arrayToHexString(blobVersionedHash) + '</span>';
                }
            } else {
                document.getElementById('selectedTransactionRlpHasBlobVersionedHashes').hidden = true;
            }

            if (type === 0x04) {
                const authorizationListInfo = decodeRlpLength(bytes);
                assert(authorizationListInfo.type === 'list');
                const authorizationListLength = bytes.slice(0, authorizationListInfo.offset);
                bytes = bytes.slice(authorizationListInfo.offset);
                let authorizationList = bytes.slice(0, authorizationListInfo.dataLen);
                bytes = bytes.slice(authorizationListInfo.dataLen);
                document.getElementById('selectedTransactionRlpHasAuthorizationList').hidden = false;
                document.getElementById('selectedTransactionRlpAuthorizationListLength').innerText = arrayToHexString(authorizationListLength);
                document.getElementById('selectedTransactionRlpAuthorizationListDescription').innerHTML = toHumanReadableByteCountString(authorizationListInfo.dataLen);
                document.getElementById('selectedTransactionRlpAuthorizationList').innerHTML = '';
                document.getElementById('selectedTransactionRlpAuthorizationListLabel').innerHTML = '';

                let authorizationIndex = 0;
                while (authorizationList.length) {
                    const authorizationInfo = decodeRlpLength(authorizationList);
                    assert(authorizationInfo.type === 'list');
                    const authorizationLength = authorizationList.slice(0, authorizationInfo.offset);
                    authorizationList = authorizationList.slice(authorizationInfo.offset);
                    let authorization = authorizationList.slice(0, authorizationInfo.dataLen);
                    authorizationList = authorizationList.slice(authorizationInfo.dataLen);
                    document.getElementById('selectedTransactionRlpAuthorizationList').innerHTML +=
                        '<br /><span>' + arrayToHexString(authorizationLength) + '</span> ' +
                        '<span class="description">(' + toHumanReadableByteCountString(authorizationInfo.dataLen) + ')</span>';
                    document.getElementById('selectedTransactionRlpAuthorizationListLabel').innerHTML +=
                        '<br /><span>[' + authorizationIndex + ']</span>';

                    const chainIdInfo = decodeRlpLength(authorization);
                    assert(chainIdInfo.type === 'str');
                    const chainIdLength = authorization.slice(0, chainIdInfo.offset);
                    authorization = authorization.slice(chainIdInfo.offset);
                    const chainId = authorization.slice(0, chainIdInfo.dataLen);
                    authorization = authorization.slice(chainIdInfo.dataLen);
                    document.getElementById('selectedTransactionRlpAuthorizationList').innerHTML +=
                        '<br /><span>' + arrayToHexString(chainIdLength) + '</span> ' +
                        '<span>' + arrayToHexString(chainId) + '</span>';
                    document.getElementById('selectedTransactionRlpAuthorizationListLabel').innerHTML +=
                        '<br /><span><a href="https://eips.ethereum.org/EIPS/eip-155" target="_blank">Chain ID</a></span>';

                    const addressInfo = decodeRlpLength(authorization);
                    assert(addressInfo.type === 'str');
                    const addressLength = authorization.slice(0, addressInfo.offset);
                    authorization = authorization.slice(addressInfo.offset);
                    const address = authorization.slice(0, addressInfo.dataLen);
                    authorization = authorization.slice(addressInfo.dataLen);
                    document.getElementById('selectedTransactionRlpAuthorizationList').innerHTML +=
                        '<br /><span>' + arrayToHexString(addressLength) + '</span> ' +
                        '<span>' + arrayToHexString(address) + '</span>';
                    document.getElementById('selectedTransactionRlpAuthorizationListLabel').innerHTML +=
                        '<br /><span><a href="https://etherscan.io/address/0x' + arrayToHexString(address) + '" target="_blank">Address</a></span>';

                    const nonceInfo = decodeRlpLength(authorization);
                    assert(nonceInfo.type === 'str');
                    const nonceLength = authorization.slice(0, nonceInfo.offset);
                    authorization = authorization.slice(nonceInfo.offset);
                    const nonce = authorization.slice(0, nonceInfo.dataLen);
                    authorization = authorization.slice(nonceInfo.dataLen);
                    document.getElementById('selectedTransactionRlpAuthorizationList').innerHTML +=
                        '<br /><span>' + arrayToHexString(nonceLength) + '</span> ' +
                        '<span>' + arrayToHexString(nonce) + '</span>';
                    document.getElementById('selectedTransactionRlpAuthorizationListLabel').innerHTML +=
                        '<br /><span>Nonce</span>';

                    const yParityInfo = decodeRlpLength(authorization);
                    assert(yParityInfo.type === 'str');
                    const yParityLength = authorization.slice(0, yParityInfo.offset);
                    authorization = authorization.slice(yParityInfo.offset);
                    const yParity = authorization.slice(0, yParityInfo.dataLen);
                    authorization = authorization.slice(yParityInfo.dataLen);
                    document.getElementById('selectedTransactionRlpAuthorizationList').innerHTML +=
                        '<br /><span>' + arrayToHexString(yParityLength) + '</span> ' +
                        '<span>' + arrayToHexString(yParity) + '</span>';
                    document.getElementById('selectedTransactionRlpAuthorizationListLabel').innerHTML +=
                        '<br /><span>Y parity</span>';

                    const rInfo = decodeRlpLength(authorization);
                    assert(rInfo.type === 'str');
                    const rLength = authorization.slice(0, rInfo.offset);
                    authorization = authorization.slice(rInfo.offset);
                    const r = authorization.slice(0, rInfo.dataLen);
                    authorization = authorization.slice(rInfo.dataLen);
                    document.getElementById('selectedTransactionRlpAuthorizationList').innerHTML +=
                        '<br /><span>' + arrayToHexString(rLength) + '</span> ' +
                        '<span>' + arrayToHexString(r) + '</span>';
                    document.getElementById('selectedTransactionRlpAuthorizationListLabel').innerHTML +=
                        '<br /><span>R</span>';

                    const sInfo = decodeRlpLength(authorization);
                    assert(sInfo.type === 'str');
                    const sLength = authorization.slice(0, sInfo.offset);
                    authorization = authorization.slice(sInfo.offset);
                    const s = authorization.slice(0, sInfo.dataLen);
                    authorization = authorization.slice(sInfo.dataLen);
                    document.getElementById('selectedTransactionRlpAuthorizationList').innerHTML +=
                        '<br /><span>' + arrayToHexString(sLength) + '</span> ' +
                        '<span>' + arrayToHexString(s) + '</span>';
                    document.getElementById('selectedTransactionRlpAuthorizationListLabel').innerHTML +=
                        '<br /><span>S</span>';

                    document.getElementById('selectedTransactionRlpHasChainId').hidden = false;
                    document.getElementById('selectedTransactionRlpChainIdLength').innerText = arrayToHexString(chainIdLength);
                    document.getElementById('selectedTransactionRlpChainId').innerText = arrayToHexString(chainId);

                    assert(authorization.length === 0);
                    authorizationIndex++;
                }
            } else {
                document.getElementById('selectedTransactionRlpHasAuthorizationList').hidden = true;
            }

            const vInfo = decodeRlpLength(bytes);
            assert(vInfo.type === 'str');
            const vLength = bytes.slice(0, vInfo.offset);
            bytes = bytes.slice(vInfo.offset);
            const v = bytes.slice(0, vInfo.dataLen);
            bytes = bytes.slice(vInfo.dataLen);
            document.getElementById('selectedTransactionRlpVLength').innerText = arrayToHexString(vLength);
            document.getElementById('selectedTransactionRlpV').innerText = arrayToHexString(v);
            const vNumber = Number(arrayToDecString(v));
            let yParity;
            if (type === 0x04 || type === 0x03 || type === 0x02 || type === 0x01) {
                assert(vNumber === 0x00 || vNumber === 0x01);
                yParity = vNumber;
                document.getElementById('selectedTransactionRlpVDescription').innerText =
                    'Y parity: ' + yParity.toString(16).padStart(2, '0');
            } else {
                yParity = 1 - (vNumber & 0x1);
                if (vNumber === 27 || vNumber === 28) {
                    document.getElementById('selectedTransactionRlpVDescription').innerText =
                        'Y parity: ' + yParity.toString(16).padStart(2, '0') +
                        ' - No replay protection';
                } else {
                    const recoveredChainId = Math.floor((vNumber - 35) / 2);
                    document.getElementById('selectedTransactionRlpVDescription').innerText =
                        'Y parity: ' + yParity.toString(16).padStart(2, '0') +
                        ' - Chain ID: ' + recoveredChainId.toString(16).padStart(2, '0');
                }
            }

            const rInfo = decodeRlpLength(bytes);
            assert(rInfo.type === 'str');
            const rLength = bytes.slice(0, rInfo.offset);
            bytes = bytes.slice(rInfo.offset);
            const r = bytes.slice(0, rInfo.dataLen);
            bytes = bytes.slice(rInfo.dataLen);
            document.getElementById('selectedTransactionRlpRLength').innerText = arrayToHexString(rLength);
            document.getElementById('selectedTransactionRlpR').innerText = arrayToHexString(r);

            const sInfo = decodeRlpLength(bytes);
            assert(sInfo.type === 'str');
            const sLength = bytes.slice(0, sInfo.offset);
            bytes = bytes.slice(sInfo.offset);
            const s = bytes.slice(0, sInfo.dataLen);
            bytes = bytes.slice(sInfo.dataLen);
            document.getElementById('selectedTransactionRlpSLength').innerText = arrayToHexString(sLength);
            document.getElementById('selectedTransactionRlpS').innerText = arrayToHexString(s);

            assert(bytes.length === 0);

            document.getElementById('specsDetail').hidden = true;
            document.getElementById('selectedReceiptRlpDetail').hidden = true;
            document.getElementById('selectedTransactionEip6404Detail').hidden = true;
            document.getElementById('selectedReceiptEip6466Detail').hidden = true;
            document.getElementById('selectedTransactionRlpDetail').hidden = false;
        }

        function visualizeReceiptRlp(transactionHash, receiptRlpBytes, receiptHasStatus) {
            document.getElementById('copyReceiptRlpButton').onclick = function() {
                navigator.clipboard.writeText(arrayToHexString(receiptRlpBytes));
            };

            document.getElementById('selectedReceiptRlpTransactionHash').innerHTML =
                '<a href="https://etherscan.io/tx/' + transactionHash + '" target="_blank">' +
                transactionHash + '</a>';

            let bytes = receiptRlpBytes;
            assert(bytes.length > 0);
            const type = bytes[0];

            if (type === 0x04) {
                document.getElementById('selectedReceiptRlpHasType').hidden = false;
                document.getElementById('selectedReceiptRlpType').innerText = byteToHexString(type);
                document.getElementById('selectedReceiptRlpTypeDescription').innerHTML =
                    '<a href="https://eips.ethereum.org/EIPS/eip-7702" target="_blank">EIP-7702</a>';
                bytes = bytes.slice(1);
            } else if (type === 0x03) {
                document.getElementById('selectedReceiptRlpHasType').hidden = false;
                document.getElementById('selectedReceiptRlpType').innerText = byteToHexString(type);
                document.getElementById('selectedReceiptRlpTypeDescription').innerHTML =
                    '<a href="https://eips.ethereum.org/EIPS/eip-4844" target="_blank">EIP-4844</a>';
                bytes = bytes.slice(1);
            } else if (type === 0x02) {
                document.getElementById('selectedReceiptRlpHasType').hidden = false;
                document.getElementById('selectedReceiptRlpType').innerText = byteToHexString(type);
                document.getElementById('selectedReceiptRlpTypeDescription').innerHTML =
                    '<a href="https://eips.ethereum.org/EIPS/eip-1559" target="_blank">EIP-1559</a>';
                bytes = bytes.slice(1);
            } else if (type === 0x01) {
                document.getElementById('selectedReceiptRlpHasType').hidden = false;
                document.getElementById('selectedReceiptRlpType').innerText = byteToHexString(type);
                document.getElementById('selectedReceiptRlpTypeDescription').innerHTML =
                    '<a href="https://eips.ethereum.org/EIPS/eip-2930" target="_blank">EIP-2930</a>';
                bytes = bytes.slice(1);
            } else if (type >= 0xc0 && type <= 0xfe) {
                document.getElementById('selectedReceiptRlpHasType').hidden = true;
            } else {
                assert(false);
            }

            const lengthInfo = decodeRlpLength(bytes);
            assert(lengthInfo.type === 'list');
            assert(lengthInfo.offset + lengthInfo.dataLen === bytes.length);
            const length = bytes.slice(0, lengthInfo.offset);
            bytes = bytes.slice(lengthInfo.offset);
            document.getElementById('selectedReceiptRlpLength').innerText = arrayToHexString(length);
            document.getElementById('selectedReceiptRlpLengthDescription').innerText = lengthInfo.dataLen + ' bytes';

            if (!receiptHasStatus) {
                document.getElementById('selectedReceiptRlpHasStatus').hidden = true;
                const rootInfo = decodeRlpLength(bytes);
                assert(rootInfo.type === 'str');
                const rootLength = bytes.slice(0, rootInfo.offset);
                bytes = bytes.slice(rootInfo.offset);
                const root = bytes.slice(0, rootInfo.dataLen);
                bytes = bytes.slice(rootInfo.dataLen);
                document.getElementById('selectedReceiptRlpHasRoot').hidden = false;
                document.getElementById('selectedReceiptRlpRootLength').innerText = arrayToHexString(rootLength);
                document.getElementById('selectedReceiptRlpRoot').innerText = arrayToHexString(root);
            } else {
                document.getElementById('selectedReceiptRlpHasRoot').hidden = true;
                const statusInfo = decodeRlpLength(bytes);
                assert(statusInfo.type === 'str');
                const statusLength = bytes.slice(0, statusInfo.offset);
                bytes = bytes.slice(statusInfo.offset);
                const status = bytes.slice(0, statusInfo.dataLen);
                bytes = bytes.slice(statusInfo.dataLen);
                document.getElementById('selectedReceiptRlpHasStatus').hidden = false;
                document.getElementById('selectedReceiptRlpStatusLength').innerText = arrayToHexString(statusLength);
                document.getElementById('selectedReceiptRlpStatus').innerText = arrayToHexString(status);
                document.getElementById('selectedReceiptRlpStatusDescription').innerText = ((statusInfo.dataLen && status[0]) ? 'Success' : 'Failure');
            }

            const cumulativeGasUsedInfo = decodeRlpLength(bytes);
            assert(cumulativeGasUsedInfo.type === 'str');
            const cumulativeGasUsedLength = bytes.slice(0, cumulativeGasUsedInfo.offset);
            bytes = bytes.slice(cumulativeGasUsedInfo.offset);
            const cumulativeGasUsed = bytes.slice(0, cumulativeGasUsedInfo.dataLen);
            bytes = bytes.slice(cumulativeGasUsedInfo.dataLen);
            document.getElementById('selectedReceiptRlpCumulativeGasUsedLength').innerText = arrayToHexString(cumulativeGasUsedLength);
            document.getElementById('selectedReceiptRlpCumulativeGasUsed').innerText = arrayToHexString(cumulativeGasUsed);
            document.getElementById('selectedReceiptRlpCumulativeGasUsedDescription').innerText = toHumanReadableNumberString(Number(arrayToDecString(cumulativeGasUsed)));

            const logsBloomInfo = decodeRlpLength(bytes);
            assert(logsBloomInfo.type === 'str');
            const logsBloomLength = bytes.slice(0, logsBloomInfo.offset);
            bytes = bytes.slice(logsBloomInfo.offset);
            const logsBloom = bytes.slice(0, logsBloomInfo.dataLen);
            bytes = bytes.slice(logsBloomInfo.dataLen);
            document.getElementById('selectedReceiptRlpLogsBloomLength').innerText = arrayToHexString(logsBloomLength);
            document.getElementById('selectedReceiptRlpLogsBloom').innerHTML =
                '<br />' + (arrayToHexString(logsBloom).match(/.{1,64}/g) ?? []).join('<br />');

            const logsInfo = decodeRlpLength(bytes);
            assert(logsInfo.type === 'list');
            const logsLength = bytes.slice(0, logsInfo.offset);
            bytes = bytes.slice(logsInfo.offset);
            let logs = bytes.slice(0, logsInfo.dataLen);
            bytes = bytes.slice(logsInfo.dataLen);
            document.getElementById('selectedReceiptRlpLogsLength').innerText = arrayToHexString(logsLength);
            document.getElementById('selectedReceiptRlpLogsDescription').innerHTML = toHumanReadableByteCountString(logsInfo.dataLen);
            document.getElementById('selectedReceiptRlpLogs').innerHTML = '';
            document.getElementById('selectedReceiptRlpLogsLabel').innerHTML = '';

            let logIndex = 0;
            while (logs.length) {
                const logInfo = decodeRlpLength(logs);
                assert(logInfo.type === 'list');
                const logLength = logs.slice(0, logInfo.offset);
                logs = logs.slice(logInfo.offset);
                let log = logs.slice(0, logInfo.dataLen);
                logs = logs.slice(logInfo.dataLen);
                document.getElementById('selectedReceiptRlpLogs').innerHTML +=
                    '<br /><span>' + arrayToHexString(logLength) + '</span> ' +
                    '<span class="description">(' + toHumanReadableByteCountString(logInfo.dataLen) + ')</span>';;
                document.getElementById('selectedReceiptRlpLogsLabel').innerHTML +=
                    '<br /><span>[' + logIndex + ']</span>';

                const addressInfo = decodeRlpLength(log);
                assert(addressInfo.type === 'str');
                const addressLength = log.slice(0, addressInfo.offset);
                log = log.slice(addressInfo.offset);
                const address = log.slice(0, addressInfo.dataLen);
                log = log.slice(addressInfo.dataLen);
                document.getElementById('selectedReceiptRlpLogs').innerHTML +=
                    '<br /><span>' + arrayToHexString(addressLength) + '</span> ' +
                    '<span>' + arrayToHexString(address) + '</span>';
                document.getElementById('selectedReceiptRlpLogsLabel').innerHTML +=
                    '<br /><span><a href="https://etherscan.io/address/0x' + arrayToHexString(address) + '" target="_blank">Address</a></span>';

                const topicsInfo = decodeRlpLength(log);
                assert(topicsInfo.type === 'list');
                const topicsLength = log.slice(0, topicsInfo.offset);
                log = log.slice(topicsInfo.offset);
                let topics = log.slice(0, topicsInfo.dataLen);
                log = log.slice(topicsInfo.dataLen);
                document.getElementById('selectedReceiptRlpLogs').innerHTML +=
                    '<br /><span>' + arrayToHexString(topicsLength) + '</span> ' +
                    '<span class="description">(' + toHumanReadableByteCountString(topicsInfo.dataLen) + ')</span>';
                document.getElementById('selectedReceiptRlpLogsLabel').innerHTML +=
                    '<br /><span>Topics</span>';

                while (topics.length) {
                    const topicInfo = decodeRlpLength(topics);
                    assert(topicInfo.type === 'str');
                    const topicLength = topics.slice(0, topicInfo.offset);
                    topics = topics.slice(topicInfo.offset);
                    const topic = topics.slice(0, topicInfo.dataLen);
                    topics = topics.slice(topicInfo.dataLen);
                    document.getElementById('selectedReceiptRlpLogs').innerHTML +=
                        '<br /><span>' + arrayToHexString(topicLength) + '</span> ' +
                        '<span>' + arrayToHexString(topic) + '</span>';
                    document.getElementById('selectedReceiptRlpLogsLabel').innerHTML += '<br />';
                }

                const dataInfo = decodeRlpLength(log);
                assert(dataInfo.type === 'str');
                const dataLength = log.slice(0, dataInfo.offset);
                log = log.slice(dataInfo.offset);
                const data = log.slice(0, dataInfo.dataLen);
                log = log.slice(dataInfo.dataLen);
                document.getElementById('selectedReceiptRlpLogs').innerHTML +=
                    '<br /><span>' + arrayToHexString(dataLength) + '</span> ' +
                    '<span class="description">(' + toHumanReadableByteCountString(dataInfo.dataLen) + ')</span>';
                document.getElementById('selectedReceiptRlpLogsLabel').innerHTML +=
                    '<br /><span>Data</span>';
                document.getElementById('selectedReceiptRlpLogs').innerHTML +=
                    '<br />' + (arrayToHexString(data).match(/.{1,64}/g) ?? []).join('<br />');
                document.getElementById('selectedReceiptRlpLogsLabel').innerHTML +=
                    (arrayToHexString(data).match(/.{1,64}/g) ?? []).fill('<br />').join('');

                assert(log.length === 0);
                logIndex++;
            }

            assert(bytes.length === 0);

            document.getElementById('specsDetail').hidden = true;
            document.getElementById('selectedTransactionRlpDetail').hidden = true;
            document.getElementById('selectedTransactionEip6404Detail').hidden = true;
            document.getElementById('selectedReceiptEip6466Detail').hidden = true;
            document.getElementById('selectedReceiptRlpDetail').hidden = false;
        }

        function visualizeTransactionEip6404(transactionEip6404Root, transactionEip6404Bytes) {
            document.getElementById('copyTransactionEip6404Button').onclick = function() {
                navigator.clipboard.writeText(arrayToHexString(transactionEip6404Bytes));
            };

            document.getElementById('selectedTransactionEip6404Root').innerText = transactionEip6404Root;

            let bytes = transactionEip6404Bytes;

            assert(bytes.length >= 4);
            const payloadOffset = bytes.slice(0, 4);
            bytes = bytes.slice(4);
            document.getElementById('selectedTransactionEip6404PayloadOffset').innerText = arrayToHexString(payloadOffset);
            document.getElementById('selectedTransactionEip6404PayloadOffsetDescription').innerText = arrayToDecString(payloadOffset.reverse());

            assert(bytes.length >= 4);
            const signatureOffset = bytes.slice(0, 4);
            bytes = bytes.slice(4);
            document.getElementById('selectedTransactionEip6404SignatureOffset').innerText = arrayToHexString(signatureOffset);
            document.getElementById('selectedTransactionEip6404SignatureOffsetDescription').innerText = arrayToDecString(signatureOffset.reverse());

            const numPayloadBytes = Number(arrayToDecString(signatureOffset)) - Number(arrayToDecString(payloadOffset));
            let payload = bytes.slice(0, numPayloadBytes);
            bytes = bytes.slice(numPayloadBytes);
            const numSignatureBytes = bytes.length;
            let signature = bytes.slice(0, numSignatureBytes);
            bytes = bytes.slice(numSignatureBytes);
            assert(bytes.length === 0);

            const payloadOffsets = [];

            assert(payload.length >= 4);
            const payloadActiveFields = payload.slice(0, 4);
            payload = payload.slice(4);
            document.getElementById('selectedTransactionEip6404PayloadActiveFields').innerText = arrayToHexString(payloadActiveFields);
            document.getElementById('selectedTransactionEip6404PayloadActiveFieldsDescription').innerText = '0b' + arrayToBinString(payloadActiveFields);

            if (payloadActiveFields[0] & 0x01) {
                assert(payload.length >= 1);
                const payloadType = payload.slice(0, 1);
                payload = payload.slice(1);
                document.getElementById('selectedTransactionEip6404PayloadHasType').hidden = false;
                document.getElementById('selectedTransactionEip6404PayloadType').innerText = arrayToHexString(payloadType);
                if (payloadType[0] === 0x04) {
                    document.getElementById('selectedTransactionEip6404PayloadTypeDescription').innerHTML =
                        '<a href="https://eips.ethereum.org/EIPS/eip-7702" target="_blank">EIP-7702</a>';
                } else if (payloadType[0] === 0x03) {
                    document.getElementById('selectedTransactionEip6404PayloadTypeDescription').innerHTML =
                        '<a href="https://eips.ethereum.org/EIPS/eip-4844" target="_blank">EIP-4844</a>';
                } else if (payloadType[0] === 0x02) {
                    document.getElementById('selectedTransactionEip6404PayloadTypeDescription').innerHTML =
                        '<a href="https://eips.ethereum.org/EIPS/eip-1559" target="_blank">EIP-1559</a>';
                } else if (payloadType[0] === 0x01) {
                    document.getElementById('selectedTransactionEip6404PayloadTypeDescription').innerHTML =
                        '<a href="https://eips.ethereum.org/EIPS/eip-2930" target="_blank">EIP-2930</a>';
                } else if (payloadType[0] === 0x00) {
                    document.getElementById('selectedTransactionEip6404PayloadTypeDescription').innerHTML =
                        'Legacy';
                } else {
                    assert(false);
                }
            } else {
                document.getElementById('selectedTransactionEip6404PayloadHasType').hidden = true;
            }

            if (payloadActiveFields[0] & 0x02) {
                assert(payload.length >= 8);
                const payloadChainId = payload.slice(0, 8);
                payload = payload.slice(8);
                document.getElementById('selectedTransactionEip6404PayloadHasChainId').hidden = false;
                document.getElementById('selectedTransactionEip6404PayloadChainId').innerText = arrayToHexString(payloadChainId);
            } else {
                document.getElementById('selectedTransactionEip6404PayloadHasChainId').hidden = true;
            }

            if (payloadActiveFields[0] & 0x04) {
                assert(payload.length >= 8);
                const payloadNonce = payload.slice(0, 8);
                payload = payload.slice(8);
                document.getElementById('selectedTransactionEip6404PayloadHasNonce').hidden = false;
                document.getElementById('selectedTransactionEip6404PayloadNonce').innerText = arrayToHexString(payloadNonce);
                document.getElementById('selectedTransactionEip6404PayloadNonceDescription').innerText = arrayToDecString(payloadNonce.reverse());
            } else {
                document.getElementById('selectedTransactionEip6404PayloadHasNonce').hidden = true;
            }

            if (payloadActiveFields[0] & 0x08) {
                assert(payload.length >= 4);
                const payloadMaxFeesPerGasOffset = payload.slice(0, 4);
                payload = payload.slice(4);
                document.getElementById('selectedTransactionEip6404PayloadHasMaxFeesPerGasOffset').hidden = false;
                document.getElementById('selectedTransactionEip6404PayloadMaxFeesPerGasOffset').innerText = arrayToHexString(payloadMaxFeesPerGasOffset);
                document.getElementById('selectedTransactionEip6404PayloadMaxFeesPerGasOffsetDescription').innerText = arrayToDecString(payloadMaxFeesPerGasOffset.reverse());
                payloadOffsets.push(Number(arrayToDecString(payloadMaxFeesPerGasOffset)));
            } else {
                document.getElementById('selectedTransactionEip6404PayloadHasMaxFeesPerGasOffset').hidden = true;
            }

            if (payloadActiveFields[0] & 0x10) {
                assert(payload.length >= 8);
                const payloadGas = payload.slice(0, 8);
                payload = payload.slice(8);
                document.getElementById('selectedTransactionEip6404PayloadHasGas').hidden = false;
                document.getElementById('selectedTransactionEip6404PayloadGas').innerText = arrayToHexString(payloadGas);
                document.getElementById('selectedTransactionEip6404PayloadGasDescription').innerText = toHumanReadableNumberString(Number(arrayToDecString(payloadGas.reverse())));
            } else {
                document.getElementById('selectedTransactionEip6404PayloadHasGas').hidden = true;
            }

            if (payloadActiveFields[0] & 0x20) {
                assert(payload.length >= 20);
                const payloadTo = payload.slice(0, 20);
                payload = payload.slice(20);
                document.getElementById('selectedTransactionEip6404PayloadHasTo').hidden = false;
                document.getElementById('selectedTransactionEip6404PayloadTo').innerText = arrayToHexString(payloadTo);
                document.getElementById('selectedTransactionEip6404PayloadToDescription').innerHTML =
                    '<a href="https://etherscan.io/address/0x' + arrayToHexString(payloadTo) + '" target="_blank">' +
                    'Destination' + '</a>';
            } else {
                document.getElementById('selectedTransactionEip6404PayloadHasTo').hidden = true;
            }

            if (payloadActiveFields[0] & 0x40) {
                assert(payload.length >= 32);
                const payloadValue = payload.slice(0, 32);
                payload = payload.slice(32);
                document.getElementById('selectedTransactionEip6404PayloadHasValue').hidden = false;
                document.getElementById('selectedTransactionEip6404PayloadValue').innerText = arrayToHexString(payloadValue);
                document.getElementById('selectedTransactionEip6404PayloadValueDescription').innerText = arrayToEthString(payloadValue.reverse()) + ' ETH';
            } else {
                document.getElementById('selectedTransactionEip6404PayloadHasValue').hidden = true;
            }

            if (payloadActiveFields[0] & 0x80) {
                assert(payload.length >= 4);
                const payloadInputOffset = payload.slice(0, 4);
                payload = payload.slice(4);
                document.getElementById('selectedTransactionEip6404PayloadHasInputOffset').hidden = false;
                document.getElementById('selectedTransactionEip6404PayloadInputOffset').innerText = arrayToHexString(payloadInputOffset);
                document.getElementById('selectedTransactionEip6404PayloadInputOffsetDescription').innerText = arrayToDecString(payloadInputOffset.reverse());
                payloadOffsets.push(Number(arrayToDecString(payloadInputOffset)));
            } else {
                document.getElementById('selectedTransactionEip6404PayloadHasInputOffset').hidden = true;
            }

            if (payloadActiveFields[1] & 0x01) {
                assert(payload.length >= 4);
                const payloadAccessListOffset = payload.slice(0, 4);
                payload = payload.slice(4);
                document.getElementById('selectedTransactionEip6404PayloadHasAccessListOffset').hidden = false;
                document.getElementById('selectedTransactionEip6404PayloadAccessListOffset').innerText = arrayToHexString(payloadAccessListOffset);
                document.getElementById('selectedTransactionEip6404PayloadAccessListOffsetDescription').innerText = arrayToDecString(payloadAccessListOffset.reverse());
                payloadOffsets.push(Number(arrayToDecString(payloadAccessListOffset)));
            } else {
                document.getElementById('selectedTransactionEip6404PayloadHasAccessListOffset').hidden = true;
            }

            if (payloadActiveFields[1] & 0x02) {
                assert(payload.length >= 4);
                const payloadMaxPriorityFeesPerGasOffset = payload.slice(0, 4);
                payload = payload.slice(4);
                document.getElementById('selectedTransactionEip6404PayloadHasMaxPriorityFeesPerGasOffset').hidden = false;
                document.getElementById('selectedTransactionEip6404PayloadMaxPriorityFeesPerGasOffset').innerText = arrayToHexString(payloadMaxPriorityFeesPerGasOffset);
                document.getElementById('selectedTransactionEip6404PayloadMaxPriorityFeesPerGasOffsetDescription').innerText = arrayToDecString(payloadMaxPriorityFeesPerGasOffset.reverse());
                payloadOffsets.push(Number(arrayToDecString(payloadMaxPriorityFeesPerGasOffset)));
            } else {
                document.getElementById('selectedTransactionEip6404PayloadHasMaxPriorityFeesPerGasOffset').hidden = true;
            }

            if (payloadActiveFields[1] & 0x04) {
                assert(payload.length >= 4);
                const payloadBlobVersionedHashesOffset = payload.slice(0, 4);
                payload = payload.slice(4);
                document.getElementById('selectedTransactionEip6404PayloadHasBlobVersionedHashesOffset').hidden = false;
                document.getElementById('selectedTransactionEip6404PayloadBlobVersionedHashesOffset').innerText = arrayToHexString(payloadBlobVersionedHashesOffset);
                document.getElementById('selectedTransactionEip6404PayloadBlobVersionedHashesOffsetDescription').innerText = arrayToDecString(payloadBlobVersionedHashesOffset.reverse());
                payloadOffsets.push(Number(arrayToDecString(payloadBlobVersionedHashesOffset)));
            } else {
                document.getElementById('selectedTransactionEip6404PayloadHasBlobVersionedHashesOffset').hidden = true;
            }

            if (payloadActiveFields[1] & 0x08) {
                assert(payload.length >= 4);
                const payloadAuthorizationListOffset = payload.slice(0, 4);
                payload = payload.slice(4);
                document.getElementById('selectedTransactionEip6404PayloadHasAuthorizationListOffset').hidden = false;
                document.getElementById('selectedTransactionEip6404PayloadAuthorizationListOffset').innerText = arrayToHexString(payloadAuthorizationListOffset);
                document.getElementById('selectedTransactionEip6404PayloadAuthorizationListOffsetDescription').innerText = arrayToDecString(payloadAuthorizationListOffset.reverse());
                payloadOffsets.push(Number(arrayToDecString(payloadAuthorizationListOffset)));
            } else {
                document.getElementById('selectedTransactionEip6404PayloadHasAuthorizationListOffset').hidden = true;
            }

            assert(payloadActiveFields[1] < 0x10);
            assert(payloadActiveFields[2] === 0x00);
            assert(payloadActiveFields[3] === 0x00);

            if (payloadActiveFields[0] & 0x08) {
                let numPayloadMaxFeesPerGasBytes;
                if (payloadOffsets.length > 1) {
                    numPayloadMaxFeesPerGasBytes = payloadOffsets[1] - payloadOffsets[0];
                } else {
                    numPayloadMaxFeesPerGasBytes = numPayloadBytes - 4 - payloadOffsets[0];
                }
                payloadOffsets.shift();
                assert(payload.length >= numPayloadMaxFeesPerGasBytes);
                let maxFeesPerGas = payload.slice(0, numPayloadMaxFeesPerGasBytes);
                payload = payload.slice(numPayloadMaxFeesPerGasBytes);

                assert(maxFeesPerGas.length >= 2);
                const maxFeesPerGasActiveFields = maxFeesPerGas.slice(0, 2);
                maxFeesPerGas = maxFeesPerGas.slice(2);
                document.getElementById('selectedTransactionEip6404PayloadHasMaxFeesPerGas').hidden = false;
                document.getElementById('selectedTransactionEip6404PayloadMaxFeesPerGasActiveFields').innerText = arrayToHexString(maxFeesPerGasActiveFields);
                document.getElementById('selectedTransactionEip6404PayloadMaxFeesPerGasActiveFieldsDescription').innerText = '0b' + arrayToBinString(maxFeesPerGasActiveFields);

                if (maxFeesPerGasActiveFields[0] & 0x01) {
                    assert(maxFeesPerGas.length >= 32);
                    const maxFeePerRegularGas = maxFeesPerGas.slice(0, 32);
                    maxFeesPerGas = maxFeesPerGas.slice(32);
                    document.getElementById('selectedTransactionEip6404PayloadHasMaxFeePerRegularGas').hidden = false;
                    document.getElementById('selectedTransactionEip6404PayloadMaxFeePerRegularGas').innerText = arrayToHexString(maxFeePerRegularGas);
                    document.getElementById('selectedTransactionEip6404PayloadMaxFeePerRegularGasDescription').innerText = arrayToGweiString(maxFeePerRegularGas.reverse()) + ' Gwei';
                } else {
                    document.getElementById('selectedTransactionEip6404PayloadHasMaxFeePerRegularGas').hidden = true;
                }

                if (maxFeesPerGasActiveFields[0] & 0x02) {
                    assert(maxFeesPerGas.length >= 32);
                    const maxFeePerBlobGas = maxFeesPerGas.slice(0, 32);
                    maxFeesPerGas = maxFeesPerGas.slice(32);
                    document.getElementById('selectedTransactionEip6404PayloadHasMaxFeePerBlobGas').hidden = false;
                    document.getElementById('selectedTransactionEip6404PayloadMaxFeePerBlobGas').innerText = arrayToHexString(maxFeePerBlobGas);
                    document.getElementById('selectedTransactionEip6404PayloadMaxFeePerBlobGasDescription').innerText = arrayToGweiString(maxFeePerBlobGas.reverse()) + ' Gwei';
                } else {
                    document.getElementById('selectedTransactionEip6404PayloadHasMaxFeePerBlobGas').hidden = true;
                }

                assert(maxFeesPerGasActiveFields[0] < 0x04);
                assert(maxFeesPerGasActiveFields[1] === 0x00);
            } else {
                document.getElementById('selectedTransactionEip6404PayloadHasMaxFeesPerGas').hidden = true;
            }

            if (payloadActiveFields[0] & 0x80) {
                let numPayloadInputBytes;
                if (payloadOffsets.length > 1) {
                    numPayloadInputBytes = payloadOffsets[1] - payloadOffsets[0];
                } else {
                    numPayloadInputBytes = numPayloadBytes - 4 - payloadOffsets[0];
                }
                payloadOffsets.shift();
                assert(payload.length >= numPayloadInputBytes);
                const payloadInput = payload.slice(0, numPayloadInputBytes);
                payload = payload.slice(numPayloadInputBytes);
                document.getElementById('selectedTransactionEip6404PayloadHasInput').hidden = false;
                if (payloadInput.length > 0) {
                    document.getElementById('selectedTransactionEip6404PayloadInput').innerHTML =
                        (arrayToHexString(payloadInput).match(/.{1,64}/g) ?? []).join('<br />');
                } else {
                    document.getElementById('selectedTransactionEip6404PayloadInput').innerText = arrayToHexString(payloadInput);
                }
                document.getElementById('selectedTransactionEip6404PayloadInputDescription').innerText = toHumanReadableByteCountString(payloadInput.length);
            } else {
                document.getElementById('selectedTransactionEip6404PayloadHasInput').hidden = true;
            }

            if (payloadActiveFields[0] & 0x01) {
                let numPayloadAccessListBytes;
                if (payloadOffsets.length > 1) {
                    numPayloadAccessListBytes = payloadOffsets[1] - payloadOffsets[0];
                } else {
                    numPayloadAccessListBytes = numPayloadBytes - 4 - payloadOffsets[0];
                }
                payloadOffsets.shift();
                assert(payload.length >= numPayloadAccessListBytes);
                let accessList = payload.slice(0, numPayloadAccessListBytes);
                payload = payload.slice(numPayloadAccessListBytes);
                document.getElementById('selectedTransactionEip6404PayloadHasAccessList').hidden = false;

                document.getElementById('selectedTransactionEip6404PayloadAccessListStart').innerHTML = '';
                document.getElementById('selectedTransactionEip6404PayloadAccessListDescription').innerHTML = '';
                document.getElementById('selectedTransactionEip6404PayloadAccessList').innerHTML = '';
                document.getElementById('selectedTransactionEip6404PayloadAccessListLabel').innerHTML = '';

                if (!accessList.length) {
                    document.getElementById('selectedTransactionEip6404PayloadAccessListDescription').innerText = 'empty';
                }

                let numAccessTuples = 0;
                const accessListOffsets = [];
                if (accessList.length) {
                    assert(accessList.length >= 4);
                    const accessTupleOffset = accessList.slice(0, 4);
                    accessList = accessList.slice(4);
                    document.getElementById('selectedTransactionEip6404PayloadAccessListStart').innerText = arrayToHexString(accessTupleOffset);
                    document.getElementById('selectedTransactionEip6404PayloadAccessListDescription').innerText = 'access list +' + arrayToDecString(accessTupleOffset.reverse());
                    document.getElementById('selectedTransactionEip6404PayloadAccessListLabel').innerHTML =
                        ' <span>[0] offset</span>';
                    accessListOffsets.push(Number(arrayToDecString(accessTupleOffset)));
                    numAccessTuples = Number(arrayToDecString(accessTupleOffset));
                    assert(numAccessTuples % 4 === 0);
                    numAccessTuples /= 4;
                }
                for (let accessTupleIndex = 1; accessTupleIndex < numAccessTuples; accessTupleIndex++) {
                    assert(accessList.length >= 4);
                    const accessTupleOffset = accessList.slice(0, 4);
                    accessList = accessList.slice(4);
                    document.getElementById('selectedTransactionEip6404PayloadAccessList').innerHTML +=
                        '<br /><span>' + arrayToHexString(accessTupleOffset) + '</span> ' +
                        '<span class="description">(access list +' + arrayToDecString(accessTupleOffset.reverse()) +')</span>';
                    document.getElementById('selectedTransactionEip6404PayloadAccessListLabel').innerHTML +=
                        '<br /><span>[' + accessTupleIndex + '] offset</span>';
                    accessListOffsets.push(Number(arrayToDecString(accessTupleOffset)));
                }
                for (let accessTupleIndex = 0; accessTupleIndex < numAccessTuples; accessTupleIndex++) {
                    let numAccessTupleBytes;
                    if (accessListOffsets.length > 1) {
                        numAccessTupleBytes = accessListOffsets[1] - accessListOffsets[0];
                    } else {
                        numAccessTupleBytes = numPayloadAccessListBytes - accessListOffsets[0];
                    }
                    accessListOffsets.shift();
                    assert(accessList.length >= numAccessTupleBytes);
                    let accessTuple = accessList.slice(0, numAccessTupleBytes);
                    accessList = accessList.slice(numAccessTupleBytes);

                    assert(accessTuple.length >= 20);
                    const address = accessTuple.slice(0, 20);
                    accessTuple = accessTuple.slice(20);
                    document.getElementById('selectedTransactionEip6404PayloadAccessList').innerHTML +=
                        '<br /><span>' + arrayToHexString(address) + '</span>';
                    document.getElementById('selectedTransactionEip6404PayloadAccessListLabel').innerHTML +=
                        '<br /><span>[' + accessTupleIndex + '] <a href="https://etherscan.io/address/0x' + arrayToHexString(address) + '" target="_blank">Address</a></span>';

                    assert(accessTuple.length >= 4);
                    const storageKeysOffset = accessTuple.slice(0, 4);
                    accessTuple = accessTuple.slice(4);
                    document.getElementById('selectedTransactionEip6404PayloadAccessList').innerHTML +=
                        '<br /><span>' + arrayToHexString(storageKeysOffset) + '</span> ' +
                        '<span class="description">(access tuple +' + arrayToDecString(storageKeysOffset.reverse()) +')</span>';
                    document.getElementById('selectedTransactionEip6404PayloadAccessListLabel').innerHTML +=
                        '<br /><span>[' + accessTupleIndex + '] Storage keys</span>';

                    while (accessTuple.length) {
                        assert(accessTuple.length >= 32);
                        const storageKey = accessTuple.slice(0, 32);
                        accessTuple = accessTuple.slice(32);
                        document.getElementById('selectedTransactionEip6404PayloadAccessList').innerHTML +=
                            '<br /><span>' + arrayToHexString(storageKey) + '</span>';
                        document.getElementById('selectedTransactionEip6404PayloadAccessListLabel').innerHTML +=
                            '<br />';
                    }
                }
                assert(accessList.length === 0);
            } else {
                document.getElementById('selectedTransactionEip6404PayloadHasAccessList').hidden = true;
            }

            if (payloadActiveFields[1] & 0x02) {
                let numPayloadMaxPriorityFeesPerGasBytes;
                if (payloadOffsets.length > 1) {
                    numPayloadMaxPriorityFeesPerGasBytes = payloadOffsets[1] - payloadOffsets[0];
                } else {
                    numPayloadMaxPriorityFeesPerGasBytes = numPayloadBytes - 4 - payloadOffsets[0];
                }
                payloadOffsets.shift();
                assert(payload.length >= numPayloadMaxPriorityFeesPerGasBytes);
                let maxPriorityFeesPerGas = payload.slice(0, numPayloadMaxPriorityFeesPerGasBytes);
                payload = payload.slice(numPayloadMaxPriorityFeesPerGasBytes);

                assert(maxPriorityFeesPerGas.length >= 2);
                const maxPriorityFeesPerGasActiveFields = maxPriorityFeesPerGas.slice(0, 2);
                maxPriorityFeesPerGas = maxPriorityFeesPerGas.slice(2);
                document.getElementById('selectedTransactionEip6404PayloadHasMaxPriorityFeesPerGas').hidden = false;
                document.getElementById('selectedTransactionEip6404PayloadMaxPriorityFeesPerGasActiveFields').innerText = arrayToHexString(maxPriorityFeesPerGasActiveFields);
                document.getElementById('selectedTransactionEip6404PayloadMaxPriorityFeesPerGasActiveFieldsDescription').innerText = '0b' + arrayToBinString(maxPriorityFeesPerGasActiveFields);

                if (maxPriorityFeesPerGasActiveFields[0] & 0x01) {
                    assert(maxPriorityFeesPerGas.length >= 32);
                    const maxPriorityFeePerRegularGas = maxPriorityFeesPerGas.slice(0, 32);
                    maxPriorityFeesPerGas = maxPriorityFeesPerGas.slice(32);
                    document.getElementById('selectedTransactionEip6404PayloadHasMaxPriorityFeePerRegularGas').hidden = false;
                    document.getElementById('selectedTransactionEip6404PayloadMaxPriorityFeePerRegularGas').innerText = arrayToHexString(maxPriorityFeePerRegularGas);
                    document.getElementById('selectedTransactionEip6404PayloadMaxPriorityFeePerRegularGasDescription').innerText = arrayToGweiString(maxPriorityFeePerRegularGas.reverse()) + ' Gwei';
                } else {
                    document.getElementById('selectedTransactionEip6404PayloadHasMaxPriorityFeePerRegularGas').hidden = true;
                }

                if (maxPriorityFeesPerGasActiveFields[0] & 0x02) {
                    assert(maxPriorityFeesPerGas.length >= 32);
                    const maxPriorityFeePerBlobGas = maxPriorityFeesPerGas.slice(0, 32);
                    maxPriorityFeesPerGas = maxPriorityFeesPerGas.slice(32);
                    document.getElementById('selectedTransactionEip6404PayloadHasMaxPriorityFeePerBlobGas').hidden = false;
                    document.getElementById('selectedTransactionEip6404PayloadMaxPriorityFeePerBlobGas').innerText = arrayToHexString(maxPriorityFeePerBlobGas);
                    document.getElementById('selectedTransactionEip6404PayloadMaxPriorityFeePerBlobGasDescription').innerText = arrayToGweiString(maxPriorityFeePerBlobGas.reverse()) + ' Gwei';
                } else {
                    document.getElementById('selectedTransactionEip6404PayloadHasMaxPriorityFeePerBlobGas').hidden = true;
                }

                assert(maxPriorityFeesPerGasActiveFields[0] < 0x04);
                assert(maxPriorityFeesPerGasActiveFields[1] === 0x00);
            } else {
                document.getElementById('selectedTransactionEip6404PayloadHasMaxPriorityFeesPerGas').hidden = true;
            }

            if (payloadActiveFields[1] & 0x04) {
                let numPayloadBlobVersionedHashesBytes;
                if (payloadOffsets.length > 1) {
                    numPayloadBlobVersionedHashesBytes = payloadOffsets[1] - payloadOffsets[0];
                } else {
                    numPayloadBlobVersionedHashesBytes = numPayloadBytes - 4 - payloadOffsets[0];
                }
                payloadOffsets.shift();
                assert(payload.length >= numPayloadBlobVersionedHashesBytes);
                let blobVersionedHashes = payload.slice(0, numPayloadBlobVersionedHashesBytes);
                payload = payload.slice(numPayloadBlobVersionedHashesBytes);
                document.getElementById('selectedTransactionEip6404PayloadHasBlobVersionedHashes').hidden = false;

                document.getElementById('selectedTransactionEip6404PayloadBlobVersionedHashes').innerHTML = '';
                document.getElementById('selectedTransactionEip6404PayloadBlobVersionedHashesLabel').innerHTML = '';

                if (!blobVersionedHashes.length) {
                    document.getElementById('selectedTransactionEip6404PayloadBlobVersionedHashes').innerHTML +=
                        '<span class="description">(empty)</span><br />';
                }

                while (blobVersionedHashes.length) {
                    assert(accessTuple.length >= 32);
                    const storageKey = accessTuple.slice(0, 32);
                    accessTuple = accessTuple.slice(32);
                    document.getElementById('selectedTransactionEip6404PayloadBlobVersionedHashes').innerHTML +=
                        '<span>' + arrayToHexString(storageKey) + '</span><br />';
                    document.getElementById('selectedTransactionEip6404PayloadBlobVersionedHashesLabel').innerHTML +=
                        '<br />';
                }
            } else {
                document.getElementById('selectedTransactionEip6404PayloadHasBlobVersionedHashes').hidden = true;
            }

            if (payloadActiveFields[1] & 0x08) {
                let numPayloadAuthorizationListBytes;
                if (payloadOffsets.length > 1) {
                    numPayloadAuthorizationListBytes = payloadOffsets[1] - payloadOffsets[0];
                } else {
                    numPayloadAuthorizationListBytes = numPayloadBytes - 4 - payloadOffsets[0];
                }
                payloadOffsets.shift();
                assert(payload.length >= numPayloadAuthorizationListBytes);
                let authorizationList = payload.slice(0, numPayloadAuthorizationListBytes);
                payload = payload.slice(numPayloadAuthorizationListBytes);
                document.getElementById('selectedTransactionEip6404PayloadHasAuthorizationList').hidden = false;

                document.getElementById('selectedTransactionEip6404PayloadAuthorizationListStart').innerHTML = '';
                document.getElementById('selectedTransactionEip6404PayloadAuthorizationListDescription').innerHTML = '';
                document.getElementById('selectedTransactionEip6404PayloadAuthorizationList').innerHTML = '';
                document.getElementById('selectedTransactionEip6404PayloadAuthorizationListLabel').innerHTML = '';

                if (!authorizationList.length) {
                    document.getElementById('selectedTransactionEip6404PayloadAuthorizationListDescription').innerText = 'empty';
                }

                let numAuthorizations = 0;
                const authorizationListOffsets = [];
                if (authorizationList.length) {
                    assert(authorizationList.length >= 4);
                    const authorizationOffset = authorizationList.slice(0, 4);
                    authorizationList = authorizationList.slice(4);
                    document.getElementById('selectedTransactionEip6404PayloadAuthorizationListStart').innerText = arrayToHexString(authorizationOffset);
                    document.getElementById('selectedTransactionEip6404PayloadAuthorizationListDescription').innerText = 'authorization list +' + arrayToDecString(authorizationOffset.reverse());
                    document.getElementById('selectedTransactionEip6404PayloadAuthorizationListLabel').innerHTML =
                        ' <span>[0] offset</span>';
                    authorizationListOffsets.push(Number(arrayToDecString(authorizationOffset)));
                    numAuthorizations = Number(arrayToDecString(authorizationOffset));
                    assert(numAuthorizations % 4 === 0);
                    numAuthorizations /= 4;
                }
                for (let authorizationIndex = 1; authorizationIndex < numAuthorizations; authorizationIndex++) {
                    assert(authorizationList.length >= 4);
                    const authorizationOffset = authorizationList.slice(0, 4);
                    authorizationList = authorizationList.slice(4);
                    document.getElementById('selectedTransactionEip6404PayloadAuthorizationList').innerHTML +=
                        '<br /><span>' + arrayToHexString(authorizationOffset) + '</span> ' +
                        '<span class="description">(authorization list +' + arrayToDecString(authorizationOffset.reverse()) +')</span>';
                    document.getElementById('selectedTransactionEip6404PayloadAuthorizationListLabel').innerHTML +=
                        '<br /><span>[' + authorizationIndex + '] offset</span>';
                    authorizationListOffsets.push(Number(arrayToDecString(authorizationOffset)));
                }
                for (let authorizationIndex = 0; authorizationIndex < numAuthorizations; authorizationIndex++) {
                    let numAuthorizationBytes;
                    if (authorizationListOffsets.length > 1) {
                        numAuthorizationBytes = authorizationListOffsets[1] - authorizationListOffsets[0];
                    } else {
                        numAuthorizationBytes = numPayloadAuthorizationListBytes - authorizationListOffsets[0];
                    }
                    authorizationListOffsets.shift();
                    assert(authorizationList.length >= numAuthorizationBytes);
                    let authorization = authorizationList.slice(0, numAuthorizationBytes);
                    authorizationList = authorizationList.slice(numAuthorizationBytes);

                    assert(authorization.length >= 4);
                    const authPayloadOffset = authorization.slice(0, 4);
                    authorization = authorization.slice(4);
                    document.getElementById('selectedTransactionEip6404PayloadAuthorizationList').innerHTML +=
                        '<br /><span>' + arrayToHexString(authPayloadOffset) + '</span> ' +
                        '<span class="description">(authorization +' + arrayToDecString(authPayloadOffset.reverse()) +')</span>';
                    document.getElementById('selectedTransactionEip6404PayloadAuthorizationListLabel').innerHTML +=
                        '<br /><span>[' + authorizationIndex + '] Payload offset</span>';

                    assert(authorization.length >= 4);
                    const authSignatureOffset = authorization.slice(0, 4);
                    authorization = authorization.slice(4);
                    document.getElementById('selectedTransactionEip6404PayloadAuthorizationList').innerHTML +=
                        '<br /><span>' + arrayToHexString(authSignatureOffset) + '</span> ' +
                        '<span class="description">(authorization +' + arrayToDecString(authSignatureOffset.reverse()) +')</span>';
                    document.getElementById('selectedTransactionEip6404PayloadAuthorizationListLabel').innerHTML +=
                        '<br /><span>[' + authorizationIndex + '] Signature offset</span>';

                    const numAuthPayloadBytes = Number(arrayToDecString(authSignatureOffset)) - Number(arrayToDecString(authPayloadOffset));
                    let authPayload = authorization.slice(0, numAuthPayloadBytes);
                    authorization = authorization.slice(numAuthPayloadBytes);
                    const numAuthSignatureBytes = authorization.length;
                    let authSignature = authorization.slice(0, numAuthSignatureBytes);
                    authorization = authorization.slice(numAuthSignatureBytes);
                    assert(authorization.length === 0);

                    assert(authPayload.length >= 2);
                    const authPayloadActiveFields = authPayload.slice(0, 2);
                    authPayload = authPayload.slice(2);
                    document.getElementById('selectedTransactionEip6404PayloadAuthorizationList').innerHTML +=
                        '<br /><span>' + arrayToHexString(authPayloadActiveFields) + '</span> ' +
                        '<span class="description">(0b' + arrayToBinString(authPayloadActiveFields) +')</span>';
                    document.getElementById('selectedTransactionEip6404PayloadAuthorizationListLabel').innerHTML +=
                        '<br /><span>[' + authorizationIndex + '] Payload active fields</span>';

                    if (authPayloadActiveFields[0] & 0x01) {
                        assert(authPayload.length >= 1);
                        const magic = authPayload.slice(0, 1);
                        authPayload = authPayload.slice(1);
                        if (magic[0] === 0x05) {
                            document.getElementById('selectedTransactionEip6404PayloadAuthorizationList').innerHTML +=
                                '<br /><span>' + arrayToHexString(magic) + '</span> ' +
                                '<span class="description">(<a href="https://eips.ethereum.org/EIPS/eip-7702" target="_blank">EIP-7702</a>)</span>';
                        } else {
                            assert(false);
                        }
                        document.getElementById('selectedTransactionEip6404PayloadAuthorizationListLabel').innerHTML +=
                            '<br /><span>[' + authorizationIndex + '] Magic</span>';
                    }

                    if (authPayloadActiveFields[0] & 0x02) {
                        assert(authPayload.length >= 8);
                        const chainId = authPayload.slice(0, 8);
                        authPayload = authPayload.slice(8);
                        document.getElementById('selectedTransactionEip6404PayloadAuthorizationList').innerHTML +=
                            '<br /><span>' + arrayToHexString(chainId) + '</span>';
                        document.getElementById('selectedTransactionEip6404PayloadAuthorizationListLabel').innerHTML +=
                            '<br /><span>[' + authorizationIndex + '] Chain ID</span>';
                    }

                    if (authPayloadActiveFields[0] & 0x04) {
                        assert(authPayload.length >= 20);
                        const address = authPayload.slice(0, 20);
                        authPayload = authPayload.slice(20);
                        document.getElementById('selectedTransactionEip6404PayloadAuthorizationList').innerHTML +=
                            '<br /><span>' + arrayToHexString(address) + '</span>';
                        document.getElementById('selectedTransactionEip6404PayloadAuthorizationListLabel').innerHTML +=
                            '<br /><span>[' + authorizationIndex + '] <a href="https://etherscan.io/address/0x' + arrayToHexString(address) + '" target="_blank">Address</a></span>';
                    }

                    if (authPayloadActiveFields[0] & 0x08) {
                        assert(authPayload.length >= 8);
                        const nonce = authPayload.slice(0, 8);
                        authPayload = authPayload.slice(8);
                        document.getElementById('selectedTransactionEip6404PayloadAuthorizationList').innerHTML +=
                            '<br /><span>' + arrayToHexString(nonce) + '</span>';
                        document.getElementById('selectedTransactionEip6404PayloadAuthorizationListLabel').innerHTML +=
                            '<br /><span>[' + authorizationIndex + '] Nonce</span>';
                    }

                    assert(authPayloadActiveFields[0] < 0x10);

                    assert(authPayload.length === 0);

                    assert(authSignature.length >= 1);
                    const authSignatureActiveFields = authSignature.slice(0, 1);
                    authSignature = authSignature.slice(1);
                    document.getElementById('selectedTransactionEip6404PayloadAuthorizationList').innerHTML +=
                        '<br /><span>' + arrayToHexString(authSignatureActiveFields) + '</span> ' +
                        '<span class="description">(0b' + arrayToBinString(authSignatureActiveFields) +')</span>';
                    document.getElementById('selectedTransactionEip6404PayloadAuthorizationListLabel').innerHTML +=
                        '<br /><span>[' + authorizationIndex + '] Signature active fields</span>';

                    if (authSignatureActiveFields[0] & 0x01) {
                        assert(authSignature.length >= 65);
                        const secp256k1 = authSignature.slice(0, 65);
                        authSignature = authSignature.slice(65);
                        document.getElementById('selectedTransactionEip6404PayloadAuthorizationList').innerHTML +=
                            '<br /><span>' + (arrayToHexString(secp256k1).match(/.{1,64}/g) ?? []).join('<br />') + '</span>';
                        document.getElementById('selectedTransactionEip6404PayloadAuthorizationListLabel').innerHTML +=
                            '<br /><span>[' + authorizationIndex + '] Secp256k1<br />&nbsp;<br />&nbsp;</span>';
                    }

                    assert(authSignatureActiveFields[0] < 0x02);

                    assert(authSignature.length === 0);
                }
                assert(authorizationList.length === 0);
            } else {
                document.getElementById('selectedTransactionEip6404PayloadHasAuthorizationList').hidden = true;
            }

            assert(payload.length === 0);

            assert(signature.length >= 1);
            const signatureActiveFields = signature.slice(0, 1);
            signature = signature.slice(1);
            document.getElementById('selectedTransactionEip6404SignatureActiveFields').innerText = arrayToHexString(signatureActiveFields);
            document.getElementById('selectedTransactionEip6404SignatureActiveFieldsDescription').innerText = '0b' + arrayToBinString(signatureActiveFields);

            if (signatureActiveFields[0] & 0x01) {
                assert(signature.length >= 65);
                const signatureSecp256k1 = signature.slice(0, 65);
                signature = signature.slice(65);
                document.getElementById('selectedTransactionEip6404SignatureHasSecp256k1').hidden = false;
                document.getElementById('selectedTransactionEip6404SignatureSecp256k1').innerHTML =
                    (arrayToHexString(signatureSecp256k1).match(/.{1,64}/g) ?? []).join('<br />');
            } else {
                document.getElementById('selectedTransactionEip6404SignatureHasSecp256k1').hidden = true;
            }

            assert(signatureActiveFields[0] < 0x02);

            assert(signature.length === 0);

            document.getElementById('specsDetail').hidden = true;
            document.getElementById('selectedTransactionRlpDetail').hidden = true;
            document.getElementById('selectedReceiptRlpDetail').hidden = true;
            document.getElementById('selectedReceiptEip6466Detail').hidden = true;
            document.getElementById('selectedTransactionEip6404Detail').hidden = false;
        }

        function visualizeReceiptEip6466(transactionEip6404Root, receiptEip6466Bytes) {
            document.getElementById('copyReceiptEip6466Button').onclick = function() {
                navigator.clipboard.writeText(arrayToHexString(receiptEip6466Bytes));
            };

            document.getElementById('selectedReceiptEip6404TransactionRoot').innerText = transactionEip6404Root;

            let bytes = receiptEip6466Bytes;

            assert(bytes.length >= 4);
            const activeFields = bytes.slice(0, 4);
            bytes = bytes.slice(4);
            document.getElementById('selectedReceiptEip6466ActiveFields').innerText = arrayToHexString(activeFields);
            document.getElementById('selectedReceiptEip6466ActiveFieldsDescription').innerText = '0b' + arrayToBinString(activeFields);

            const numBytes = bytes.length;

            const offsets = [];

            if (activeFields[0] & 0x01) {
                assert(bytes.length >= 20);
                const from = bytes.slice(0, 20);
                bytes = bytes.slice(20);
                document.getElementById('selectedReceiptEip6466HasFrom').hidden = false;
                document.getElementById('selectedReceiptEip6466From').innerText = arrayToHexString(from);
                document.getElementById('selectedReceiptEip6466FromDescription').innerHTML =
                    '<a href="https://etherscan.io/address/0x' + arrayToHexString(from) + '" target="_blank">' +
                    'Origin' + '</a>';
            } else {
                document.getElementById('selectedReceiptEip6466HasFrom').hidden = true;
            }

            if (activeFields[0] & 0x02) {
                assert(bytes.length >= 8);
                const gasUsed = bytes.slice(0, 8);
                bytes = bytes.slice(8);
                document.getElementById('selectedReceiptEip6466HasGasUsed').hidden = false;
                document.getElementById('selectedReceiptEip6466GasUsed').innerText = arrayToHexString(gasUsed);
                document.getElementById('selectedReceiptEip6466GasUsedDescription').innerText = toHumanReadableNumberString(Number(arrayToDecString(gasUsed.reverse())));
            } else {
                document.getElementById('selectedReceiptEip6466HasGasUsed').hidden = true;
            }

            if (activeFields[0] & 0x04) {
                assert(bytes.length >= 20);
                const contractAddress = bytes.slice(0, 20);
                bytes = bytes.slice(20);
                document.getElementById('selectedReceiptEip6466HasContractAddress').hidden = false;
                document.getElementById('selectedReceiptEip6466ContractAddress').innerText = arrayToHexString(contractAddress);
                document.getElementById('selectedReceiptEip6466ContractAddressDescription').innerHTML =
                    '<a href="https://etherscan.io/address/0x' + arrayToHexString(contractAddress) + '" target="_blank">' +
                    'Contract' + '</a>';
            } else {
                document.getElementById('selectedReceiptEip6466HasContractAddress').hidden = true;
            }

            if (activeFields[0] & 0x08) {
                assert(bytes.length >= 4);
                const logsOffset = bytes.slice(0, 4);
                bytes = bytes.slice(4);
                document.getElementById('selectedReceiptEip6466HasLogsOffset').hidden = false;
                document.getElementById('selectedReceiptEip6466LogsOffset').innerText = arrayToHexString(logsOffset);
                document.getElementById('selectedReceiptEip6466LogsOffsetDescription').innerText = arrayToDecString(logsOffset.reverse());
                offsets.push(Number(arrayToDecString(logsOffset)));
            } else {
                document.getElementById('selectedReceiptEip6466HasLogsOffset').hidden = true;
            }

            if (activeFields[0] & 0x10) {
                assert(bytes.length >= 1);
                const status = bytes.slice(0, 1);
                bytes = bytes.slice(1);
                document.getElementById('selectedReceiptEip6466HasStatus').hidden = false;
                document.getElementById('selectedReceiptEip6466Status').innerText = arrayToHexString(status);
                document.getElementById('selectedReceiptEip6466StatusDescription').innerText = (status[0] ? 'Success' : 'Failure');
            } else {
                document.getElementById('selectedReceiptEip6466HasStatus').hidden = true;
            }

            if (activeFields[0] & 0x20) {
                assert(bytes.length >= 4);
                const authoritiesOffset = bytes.slice(0, 4);
                bytes = bytes.slice(4);
                document.getElementById('selectedReceiptEip6466HasAuthoritiesOffset').hidden = false;
                document.getElementById('selectedReceiptEip6466AuthoritiesOffset').innerText = arrayToHexString(authoritiesOffset);
                document.getElementById('selectedReceiptEip6466AuthoritiesOffsetDescription').innerText = arrayToDecString(authoritiesOffset.reverse());
                offsets.push(Number(arrayToDecString(authoritiesOffset)));
            } else {
                document.getElementById('selectedReceiptEip6466HasAuthoritiesOffset').hidden = true;
            }

            assert(activeFields[0] < 0x40);
            assert(activeFields[1] === 0x00);
            assert(activeFields[2] === 0x00);
            assert(activeFields[3] === 0x00);

            if (activeFields[0] & 0x08) {
                let numLogsBytes;
                if (offsets.length > 1) {
                    numLogsBytes = offsets[1] - offsets[0];
                } else {
                    numLogsBytes = numBytes - offsets[0];
                }
                offsets.shift();
                assert(bytes.length >= numLogsBytes);
                let logs = bytes.slice(0, numLogsBytes);
                bytes = bytes.slice(numLogsBytes);
                document.getElementById('selectedReceiptEip6466HasLogs').hidden = false;

                document.getElementById('selectedReceiptEip6466LogsStart').innerHTML = '';
                document.getElementById('selectedReceiptEip6466LogsDescription').innerHTML = '';
                document.getElementById('selectedReceiptEip6466Logs').innerHTML = '';
                document.getElementById('selectedReceiptEip6466LogsLabel').innerHTML = '';

                if (!logs.length) {
                    document.getElementById('selectedReceiptEip6466LogsDescription').innerText = 'empty';
                }

                let numLogs = 0;
                const logsOffsets = [];
                if (logs.length) {
                    assert(logs.length >= 4);
                    const logOffset = logs.slice(0, 4);
                    logs = logs.slice(4);
                    document.getElementById('selectedReceiptEip6466LogsStart').innerText = arrayToHexString(logOffset);
                    document.getElementById('selectedReceiptEip6466LogsDescription').innerText = 'logs +' + arrayToDecString(logOffset.reverse());
                    document.getElementById('selectedReceiptEip6466LogsLabel').innerHTML =
                        ' <span>[0] offset</span>';
                    logsOffsets.push(Number(arrayToDecString(logOffset)));
                    numLogs = Number(arrayToDecString(logOffset));
                    assert(numLogs % 4 === 0);
                    numLogs /= 4;
                }
                for (let logIndex = 1; logIndex < numLogs; logIndex++) {
                    assert(logs.length >= 4);
                    const logOffset = logs.slice(0, 4);
                    logs = logs.slice(4);
                    document.getElementById('selectedReceiptEip6466Logs').innerHTML +=
                        '<br /><span>' + arrayToHexString(logOffset) + '</span> ' +
                        '<span class="description">(logs +' + arrayToDecString(logOffset.reverse()) +')</span>';
                    document.getElementById('selectedReceiptEip6466LogsLabel').innerHTML +=
                        '<br /><span>[' + logIndex + '] offset</span>';
                    logsOffsets.push(Number(arrayToDecString(logOffset)));
                }
                for (let logIndex = 0; logIndex < numLogs; logIndex++) {
                    let numLogBytes;
                    if (logsOffsets.length > 1) {
                        numLogBytes = logsOffsets[1] - logsOffsets[0];
                    } else {
                        numLogBytes = numLogsBytes - logsOffsets[0];
                    }
                    logsOffsets.shift();
                    assert(logs.length >= numLogBytes);
                    let log = logs.slice(0, numLogBytes);
                    logs = logs.slice(numLogBytes);

                    const logOffsets = [];

                    assert(log.length >= 20);
                    const address = log.slice(0, 20);
                    log = log.slice(20);
                    document.getElementById('selectedReceiptEip6466Logs').innerHTML +=
                        '<br /><span>' + arrayToHexString(address) + '</span>';
                    document.getElementById('selectedReceiptEip6466LogsLabel').innerHTML +=
                        '<br /><span>[' + logIndex + '] <a href="https://etherscan.io/address/0x' + arrayToHexString(address) + '" target="_blank">Address</a></span>';

                    assert(log.length >= 4);
                    const topicsOffset = log.slice(0, 4);
                    log = log.slice(4);
                    document.getElementById('selectedReceiptEip6466Logs').innerHTML +=
                        '<br /><span>' + arrayToHexString(topicsOffset) + '</span> ' +
                        '<span class="description">(log +' + arrayToDecString(topicsOffset.reverse()) +')</span>';
                    document.getElementById('selectedReceiptEip6466LogsLabel').innerHTML +=
                        '<br /><span>[' + logIndex + '] Topics offset</span>';
                    logOffsets.push(Number(arrayToDecString(topicsOffset)));

                    assert(log.length >= 4);
                    const dataOffset = log.slice(0, 4);
                    log = log.slice(4);
                    document.getElementById('selectedReceiptEip6466Logs').innerHTML +=
                        '<br /><span>' + arrayToHexString(dataOffset) + '</span> ' +
                        '<span class="description">(log +' + arrayToDecString(dataOffset.reverse()) +')</span>';
                    document.getElementById('selectedReceiptEip6466LogsLabel').innerHTML +=
                        '<br /><span>[' + logIndex + '] Data offset</span>';
                    logOffsets.push(Number(arrayToDecString(dataOffset)));

                    let numTopicsBytes;
                    if (logOffsets.length > 1) {
                        numTopicsBytes = logOffsets[1] - logOffsets[0];
                    } else {
                        numTopicsBytes = numLogBytes - logOffsets[0];
                    }
                    logOffsets.shift();
                    assert(log.length >= numTopicsBytes);
                    let topics = log.slice(0, numTopicsBytes);
                    log = log.slice(numTopicsBytes);

                    let isFirstTopic = true;
                    while (topics.length) {
                        assert(topics.length >= 32);
                        const topic = topics.slice(0, 32);
                        topics = topics.slice(32);
                        document.getElementById('selectedReceiptEip6466Logs').innerHTML +=
                            '<br /><span>' + arrayToHexString(topic) + '</span>';
                        if (isFirstTopic) {
                            document.getElementById('selectedReceiptEip6466LogsLabel').innerHTML +=
                                '<br /><span>[' + logIndex + '] Topics</span>';
                            isFirstTopic = false;
                        } else {
                            document.getElementById('selectedReceiptEip6466LogsLabel').innerHTML +=
                                '<br />';
                        }
                    }
                    if (isFirstTopic) {
                        document.getElementById('selectedReceiptEip6466Logs').innerHTML +=
                            '<br /><span class="description">(empty)</span>';
                        document.getElementById('selectedReceiptEip6466LogsLabel').innerHTML +=
                            '<br /><span>[' + logIndex + '] Topics</span>';
                    }

                    let numDataBytes;
                    if (logOffsets.length > 1) {
                        numDataBytes = logOffsets[1] - logOffsets[0];
                    } else {
                        numDataBytes = numLogBytes - logOffsets[0];
                    }
                    logOffsets.shift();
                    assert(log.length >= numDataBytes);
                    const data = log.slice(0, numDataBytes);
                    log = log.slice(numDataBytes);
                    document.getElementById('selectedReceiptEip6466Logs').innerHTML +=
                        '<br />' + (arrayToHexString(data).match(/.{1,64}/g) ?? []).join('<br />') +
                        ' <span class="description">(' + toHumanReadableByteCountString(data.length) + ')</span>';
                    document.getElementById('selectedReceiptEip6466LogsLabel').innerHTML +=
                        '<br /><span>[' + logIndex + '] Data</span>' +
                        (arrayToHexString(data).match(/.{1,64}/g) ?? []).fill('<br />').slice(1).join('');

                    assert(log.length === 0);
                }
                assert(logs.length === 0);
            } else {
                document.getElementById('selectedReceiptEip6466HasLogs').hidden = true;
            }

            if (activeFields[0] & 0x20) {
                let numAuthoritiesBytes;
                if (offsets.length > 1) {
                    numAuthoritiesBytes = offsets[1] - offsets[0];
                } else {
                    numAuthoritiesBytes = numBytes - offsets[0];
                }
                offsets.shift();
                assert(bytes.length >= numAuthoritiesBytes);
                let authorities = bytes.slice(0, numAuthoritiesBytes);
                bytes = bytes.slice(numAuthoritiesBytes);
                document.getElementById('selectedReceiptEip6466HasAuthorities').hidden = false;

                document.getElementById('selectedReceiptEip6466Authorities').innerHTML = '';
                document.getElementById('selectedReceiptEip6466AuthoritiesLabel').innerHTML = '';

                if (!authorities.length) {
                    document.getElementById('selectedReceiptEip6466Authorities').innerHTML =
                        '<span class="description">(empty)</span>';
                }

                assert(authorities.length % 20 === 0);
                const numAuthorities = authorities.length / 20;
                for (let authorityIndex = 0; authorityIndex < numAuthorities; authorityIndex++) {
                    const authority = authorities.slice(0, 20);
                    authorities = authorities.slice(20);
                    document.getElementById('selectedReceiptEip6466Authorities').innerHTML +=
                        '<span>' + arrayToHexString(authority) + '</span>' +
                        ' <span class="description">(<a href="https://etherscan.io/address/0x' + arrayToHexString(authority) + '" target="_blank">Authority</a>)</span><br />';
                    document.getElementById('selectedReceiptEip6466AuthoritiesLabel').innerHTML +=
                        ' <span>[' + authorityIndex + ']</span><br />'
                }
            } else {
                document.getElementById('selectedReceiptEip6466HasAuthorities').hidden = true;
            }

            assert(bytes.length === 0);

            document.getElementById('specsDetail').hidden = true;
            document.getElementById('selectedTransactionRlpDetail').hidden = true;
            document.getElementById('selectedReceiptRlpDetail').hidden = true;
            document.getElementById('selectedTransactionEip6404Detail').hidden = true;
            document.getElementById('selectedReceiptEip6466Detail').hidden = false;
        }

        function visualizeHeader(prefix, header) {
            const beaconRoot = getBeaconRoot(header);
            if (document.getElementById(prefix + 'BeaconRoot').dataset.beaconRoot === beaconRoot) return;
            document.getElementById(prefix + 'BeaconRoot').dataset.beaconRoot = beaconRoot;

            document.getElementById(prefix + 'BeaconRoot').innerHTML =
                '<a href="https://beaconcha.in/slot/' + beaconRoot + '" target="_blank">' +
                beaconRoot.substring(2, 34) + '<br />' + beaconRoot.substring(34) + '</a>';
            const beacon = Module._ETHLightClientHeaderGetBeacon(header);
            const beaconSlot = Module._ETHBeaconBlockHeaderGetSlot(beacon);
            document.getElementById(prefix + 'BeaconSlot').innerHTML =
                '<a href="https://beaconcha.in/slot/' + beaconSlot + '" target="_blank">' +
                beaconSlot + '</a>';
            const beaconProposerIndex = Module._ETHBeaconBlockHeaderGetProposerIndex(beacon);
            document.getElementById(prefix + 'BeaconProposerIndex').innerHTML =
                '<a href="https://beaconcha.in/validator/' + beaconProposerIndex + '" target="_blank">' +
                beaconProposerIndex + '</a>';
            const beaconParentRoot = Module._ETHBeaconBlockHeaderGetParentRoot(beacon);
            const beaconStateRoot = Module._ETHBeaconBlockHeaderGetStateRoot(beacon);
            const beaconBodyRoot = Module._ETHBeaconBlockHeaderGetBodyRoot(beacon);

            const executionHash = Module._ETHLightClientHeaderCopyExecutionHash(header, cfg);
            const executionHashString = toHexString(executionHash, 32);
            Module._ETHRootDestroy(executionHash);
            const execution = Module._ETHLightClientHeaderGetExecution(header);
            const executionParentHash = Module._ETHExecutionPayloadHeaderGetParentHash(execution);
            const executionFeeRecipient = Module._ETHExecutionPayloadHeaderGetFeeRecipient(execution);
            document.getElementById(prefix + 'ExecutionFeeRecipient').innerHTML =
                '<a href="https://etherscan.io/address/' + toHexString(executionFeeRecipient, 20) + '#mine" target="_blank">' +
                toHexString(executionFeeRecipient, 20) + '</a>';
            const executionStateRoot = Module._ETHExecutionPayloadHeaderGetStateRoot(execution);
            const executionReceiptsRoot = Module._ETHExecutionPayloadHeaderGetReceiptsRoot(execution);
            const executionLogsBloom = Module._ETHExecutionPayloadHeaderGetLogsBloom(execution);
            const executionPrevRandao = Module._ETHExecutionPayloadHeaderGetPrevRandao(execution);
            const executionBlockNumber = Module._ETHExecutionPayloadHeaderGetBlockNumber(execution);
            document.getElementById(prefix + 'ExecutionBlockNumber').innerHTML =
                '<a href="https://etherscan.io/block/' + executionHashString + '" target="_blank">' +
                executionBlockNumber + '</a>';
            const executionGasLimit = Module._ETHExecutionPayloadHeaderGetGasLimit(execution);
            document.getElementById(prefix + 'ExecutionGasLimit').innerText = toHumanReadableNumberString(executionGasLimit);
            const executionGasUsed = Module._ETHExecutionPayloadHeaderGetGasUsed(execution);
            document.getElementById(prefix + 'ExecutionGasUsed').innerText = toHumanReadableNumberString(executionGasUsed);
            document.getElementById(prefix + 'ExecutionGasUsedPercentage').innerText = (executionGasUsed * 100 / executionGasLimit).toFixed(2) + '%';
            const executionTimestamp = Module._ETHExecutionPayloadHeaderGetTimestamp(execution);
            document.getElementById(prefix + 'ExecutionTimestamp').innerText = toDateString(executionTimestamp);
            const numExecutionExtraDataBytesPtr = Module._malloc(4);
            const executionExtraDataBytes = Module._ETHExecutionPayloadHeaderGetExtraDataBytes(execution, numExecutionExtraDataBytesPtr);
            const numExecutionExtraDataBytes = Module.HEAPU32[numExecutionExtraDataBytesPtr >>> 2];
            Module._free(numExecutionExtraDataBytesPtr);
            const executionBaseFeePerGas = Module._ETHExecutionPayloadHeaderGetBaseFeePerGas(execution);
            document.getElementById(prefix + 'ExecutionBaseFeePerGas').innerText = toGweiString(executionBaseFeePerGas, 32) + ' Gwei';
            const executionBlobGasUsed = Module._ETHExecutionPayloadHeaderGetBlobGasUsed(execution);
            const executionExcessBlobGas = Module._ETHExecutionPayloadHeaderGetExcessBlobGas(execution);

            function fillExecutionInfo() {
                if (executionHash == zeroHash) {
                    document.getElementById(prefix + 'TransactionInfo').innerHTML = '';
                    document.getElementById(prefix + 'ReceiptInfo').innerHTML = '';
                    document.getElementById(prefix + 'TransactionList').innerHTML = '';
                } else {
                    document.getElementById(prefix + 'TransactionInfo').innerHTML = 'Loading transactions&hellip;';
                    document.getElementById(prefix + 'ReceiptInfo').innerHTML = 'Loading receipts&hellip;';
                    document.getElementById(prefix + 'TransactionList').innerHTML = '';

                    const executionBlockFut = fetchExecutionBlock(prefix, header);
                    executionBlockFut.then((executionBlock) => {
                        if (document.getElementById(prefix + 'BeaconRoot').dataset.beaconRoot !== beaconRoot) return;
                        if (!executionBlock) {
                            document.getElementById(prefix + 'TransactionList').innerHTML =
                            '<div class="headerMaster">' +
                                '   <div class="headerMasterBeaconRoot">Validation failed</div>' +
                                '   <div class="headerMasterInfo">' +
                                    '       <table style="width: 100%">' +
                                '           <tr>' +
                                '               <td><input type="button" id="' +
                                prefix + 'ExecutionReloadButton' +
                                '" value="Retry" /></td>' +
                                '           </tr>' +
                                '       </table>' +
                                '   </div>' +
                                '</div>';
                            document.getElementById(prefix + 'ExecutionReloadButton').onclick = fillExecutionInfo;
                            return;
                        }

                        const [executionBlockHeader, transactions, receipts] = executionBlock;
                        const executionTransactionsRoot = Module._ETHExecutionBlockHeaderGetTransactionsRoot(executionBlockHeader);
                        const executionWithdrawalsRoot = Module._ETHExecutionBlockHeaderGetWithdrawalsRoot(executionBlockHeader);

                        const numTransactions = Module._ETHTransactionsGetCount(transactions);
                        document.getElementById(prefix + 'TransactionInfo').innerHTML = '';
                        document.getElementById(prefix + 'TransactionList').innerHTML = '';
                        const numBytesPtr = Module._malloc(4);
                        let totalTransactionRlpBytes = 0;
                        let totalTransactionEip6404SnappyBytes = 0;
                        let totalReceiptRlpBytes = 0;
                        let totalReceiptEip6466SnappyBytes = 0;
                        for (let transactionIndex = 0; transactionIndex < numTransactions; transactionIndex++) {
                            const transaction = Module._ETHTransactionsGet(transactions, transactionIndex);
                            const receipt = Module._ETHReceiptsGet(receipts, transactionIndex);

                            const transactionHash = Module._ETHTransactionGetHash(transaction);
                            const transactionHashString = toHexString(transactionHash, 32);
                            const transactionFrom = Module._ETHTransactionGetFrom(transaction);
                            const transactionNonce = Module._ETHTransactionGetNonce(transaction);
                            const transactionMaxPriorityFeePerGas = Module._ETHTransactionGetMaxPriorityFeePerGas(transaction);
                            const transactionMaxFeePerGas = Module._ETHTransactionGetMaxFeePerGas(transaction);
                            const transactionGas = Module._ETHTransactionGetGas(transaction);
                            const transactionIsCreatingContract = Module._ETHTransactionIsCreatingContract(transaction);
                            const transactionTo = Module._ETHTransactionGetTo(transaction);
                            const transactionValue = Module._ETHTransactionGetValue(transaction);
                            const transactionInputBytes = Module._ETHTransactionGetInputBytes(transaction, numBytesPtr);
                            const numTransactionInputBytes = Module.HEAPU32[numBytesPtr >>> 2];
                            const transactionBytes = Module._ETHTransactionGetBytes(transaction, numBytesPtr);
                            const numTransactionBytes = Module.HEAPU32[numBytesPtr >>> 2];
                            const transactionBytesArray = toArray(transactionBytes, numTransactionBytes);
                            const transactionEip6404Root = Module._ETHTransactionGetEip6404Root(transaction);
                            const transactionEip6404RootString = toHexString(transactionEip6404Root, 32);
                            const transactionEip6404Bytes = Module._ETHTransactionGetEip6404Bytes(transaction, numBytesPtr);
                            const numtransactionEip6404Bytes = Module.HEAPU32[numBytesPtr >>> 2];
                            const transactionEip6404BytesArray = toArray(transactionEip6404Bytes, numtransactionEip6404Bytes);
                            const numTransactionEip6404SnappyBytes = Module._ETHTransactionGetNumEip6404SnappyBytes(transaction);
                            totalTransactionRlpBytes += numTransactionBytes;
                            totalTransactionEip6404SnappyBytes += numTransactionEip6404SnappyBytes;

                            const receiptHasStatus = Module._ETHReceiptHasStatus(receipt);
                            const receiptBytes = Module._ETHReceiptGetBytes(receipt, numBytesPtr);
                            const numReceiptBytes = Module.HEAPU32[numBytesPtr >>> 2];
                            const receiptBytesArray = toArray(receiptBytes, numReceiptBytes);
                            const receiptEip6466Bytes = Module._ETHReceiptGetEip6466Bytes(receipt, numBytesPtr);
                            const numreceiptEip6466Bytes = Module.HEAPU32[numBytesPtr >>> 2];
                            const receiptEip6466BytesArray = toArray(receiptEip6466Bytes, numreceiptEip6466Bytes);
                            const numReceiptEip6466SnappyBytes = Module._ETHReceiptGetNumEip6466SnappyBytes(receipt);
                            totalReceiptRlpBytes += numReceiptBytes;
                            totalReceiptEip6466SnappyBytes += numReceiptEip6466SnappyBytes;

                            const transactionRlpButtonId = `rlpButton_transaction_${transactionHashString}`;
                            const receiptRlpButtonId = `rlpButton_receipt_${transactionHashString}`;
                            const transactionEip6404ButtonId = `eip6404Button_transaction_${transactionHashString}`;
                            const receiptEip6466ButtonId = `eip6466Button_receipt_${transactionHashString}`;
                            const transactionDiv = document.createElement('div');
                            transactionDiv.id = `txMaster_${transactionHashString}`;
                            transactionDiv.className = 'headerMaster';
                            transactionDiv.innerHTML =
                                '<div class="headerMasterBeaconRoot">' +
                                '<a href="https://etherscan.io/tx/' + transactionHashString + '" target="_blank">' +
                                transactionHashString.substring(2, 34) + '<br />' + transactionHashString.substring(34) + '</a>' +
                                '</div>' +
                                '<div class="headerMasterInfo">' +
                                '    <table style="width: 100%">' +
                                '        <tr>' +
                                '            <td><span class="fas fa-hashtag"></span> <span>' +
                                toDecString(transactionNonce, 8) +
                                '</span></td>' +
                                '            <td><span class="fas fa-tachometer-alt"></span> <span>' +
                                toHumanReadableNumberString(Number(toDecString(transactionGas, 8))) +
                                '</span></td>' +
                                '            <td><span class="fas fa-money-bill-1"></span> <span>' +
                                toGweiString(transactionMaxPriorityFeePerGas, 8) + ' Gwei' +
                                '</span></td>' +
                                '            <td style="text-align: right;"><span class="fas fa-gas-pump"></span> <span>' +
                                toGweiString(transactionMaxFeePerGas, 8) + ' Gwei' +
                                '</span></td>' +
                                '        </tr>' +
                                '        <tr>' +
                                '            <td colspan="4"><span class="fas fa-right-from-bracket"></span> <span style="display: inline-block; transform: scaleX(1.015); transform-origin: left;">' +
                                '<a href="https://etherscan.io/address/' + toHexString(transactionFrom, 20) + '" target="_blank">' +
                                toHexString(transactionFrom, 20) + '</a>' +
                                '</span></td>' +
                                '        </tr>' +
                                '        <tr>' +
                                '            <td colspan="3"><span class="fas fa-brands fa-ethereum"></span> <span>' +
                                toEthString(transactionValue, 32) + ' ETH' +
                                '</span></td>' +
                                '            <td colspan="1" style="text-align: right;"><span class="fas fa-file-arrow-up"></span> <span>' +
                                toHumanReadableByteCountString(numTransactionInputBytes) +
                                '</span></td>' +
                                '        </tr>' +
                                '        <tr>' +
                                '            <td colspan="4"><span class="fas ' +
                                (transactionIsCreatingContract ? 'fa-star-of-life' : 'fa-right-to-bracket') +
                                '"></span> <span style="display: inline-block; transform: scaleX(1.015); transform-origin: left;">' +
                                '<a href="https://etherscan.io/address/' + toHexString(transactionTo, 20) + '" target="_blank">' +
                                toHexString(transactionTo, 20) + '</a>' +
                                '</span></td>' +
                                '        </tr>' +
                                '        <tr>' +
                                '            <td colspan="4"><input type="button" id="' +
                                transactionRlpButtonId +
                                '" value="RLP (' + toHumanReadableByteCountString(transactionBytesArray.length) + ')" />' +
                                '<span style="float: right;"><input type="button" id="' +
                                receiptRlpButtonId +
                                '" value="RLP (' + toHumanReadableByteCountString(receiptBytesArray.length) + ')" /></span></td>' +
                                '        </tr>' +
                                '        <tr>' +
                                '            <td colspan="4"><input type="button" id="' +
                                transactionEip6404ButtonId +
                                '" value="SSZ (' + toHumanReadableByteCountString(numTransactionEip6404SnappyBytes) + ')" />' +
                                '<span style="float: right;"><input type="button" id="' +
                                receiptEip6466ButtonId +
                                '" value="SSZ (' + toHumanReadableByteCountString(numReceiptEip6466SnappyBytes) + ')" /></span></td>' +
                                '        </tr>' +
                                '        <tr>' +
                                '            <td colspan="4">Transaction <span style="float: right;">Receipt</span></td>' +
                                '        </tr>' +
                                '    </table>' +
                                '</div>';

                            document.getElementById(prefix + 'TransactionList').appendChild(transactionDiv);

                            document.getElementById(transactionRlpButtonId).onclick = function () {
                                history.replaceState(/* state: */ null, /* unused: */ "", document.baseURI + 'tx/' + transactionHashString + '#rlp');
                                visualizeTransactionRlp(transactionHashString, transactionBytesArray);
                            };

                            document.getElementById(receiptRlpButtonId).onclick = function () {
                                history.replaceState(/* state: */ null, /* unused: */ "", document.baseURI + 'tx/' + transactionHashString + '#receipt/rlp');
                                visualizeReceiptRlp(transactionHashString, receiptBytesArray, receiptHasStatus);
                            };

                            document.getElementById(transactionEip6404ButtonId).onclick = function () {
                                history.replaceState(/* state: */ null, /* unused: */ "", document.baseURI + 'tx/' + transactionHashString + '#ssz');
                                visualizeTransactionEip6404(transactionEip6404RootString, transactionEip6404BytesArray);
                            };

                            document.getElementById(receiptEip6466ButtonId).onclick = function () {
                                history.replaceState(/* state: */ null, /* unused: */ "", document.baseURI + 'tx/' + transactionHashString + '#receipt/ssz');
                                visualizeReceiptEip6466(transactionEip6404RootString, receiptEip6466BytesArray);
                            };
                        }
                        Module._free(numBytesPtr);

                        const totalTransactionBytesDiffPercentage = Math.floor((totalTransactionEip6404SnappyBytes / totalTransactionRlpBytes - 1.0) * 100.0);
                        document.getElementById(prefix + 'TransactionInfo').innerHTML =
                        'RLP ' + toHumanReadableByteCountString(totalTransactionRlpBytes) +
                        ' | SSZ ' + toHumanReadableByteCountString(totalTransactionEip6404SnappyBytes) +
                        ' (' + (totalTransactionBytesDiffPercentage < 0 ? '' : '+') + totalTransactionBytesDiffPercentage + '%' + ')';

                        const totalReceiptBytesDiffPercentage = Math.floor((totalReceiptEip6466SnappyBytes / totalReceiptRlpBytes - 1.0) * 100.0);
                        document.getElementById(prefix + 'ReceiptInfo').innerHTML =
                            'RLP ' + toHumanReadableByteCountString(totalReceiptRlpBytes) +
                            ' | SSZ ' + toHumanReadableByteCountString(totalReceiptEip6466SnappyBytes) +
                            ' (' + (totalReceiptBytesDiffPercentage < 0 ? '' : '+') + totalReceiptBytesDiffPercentage + '%' + ')';
                    });
                }
            }
            fillExecutionInfo();
        }

        let selectedHeader = undefined;

        const initialLocation = new URL(window.location.href).pathname.replace(new URL(document.baseURI).pathname, '');
        if (initialLocation.startsWith('tx/')) {
            document.getElementById('specsDetail').hidden = true;
        }
        async function loadInitialLocation() {
            if (initialLocation.startsWith('tx/')) {
                const transactionHashString = initialLocation.substring(3);
                const transactionResponseFut = fetch(executionApiBase, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        jsonrpc: '2.0',
                        id: 1,
                        method: 'eth_getTransactionByHash',
                        params: [transactionHashString]
                    })
                });
                const receiptResponseFut = fetch(executionApiBase, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        jsonrpc: '2.0',
                        id: 1,
                        method: 'eth_getTransactionReceipt',
                        params: [transactionHashString]
                    })
                });
                let transactionsData = [];
                try {
                    const transactionResponse = await transactionResponseFut;
                    if (!transactionResponse.ok) return;
                    const transactionResponseJson = await transactionResponse.json();
                    if (!transactionResponseJson.result) return;
                    transactionsData.push(transactionResponseJson.result);
                } catch {
                    return;
                }
                let receiptsData = [];
                try {
                    const receiptResponse = await receiptResponseFut;
                    if (!receiptResponse.ok) return;
                    const receiptResponseJson = await receiptResponse.json();
                    if (!receiptResponseJson.result) return;
                    receiptsData.push(receiptResponseJson.result);
                } catch {
                    return;
                }
                if (initialLocation !== new URL(window.location.href).pathname.replace(new URL(document.baseURI).pathname, '')) {
                    return;
                }

                transactionsData[0].transactionIndex = "0x0";

                receiptsData[0].cumulativeGasUsed = receiptsData[0].gasUsed;
                receiptsData[0].transactionIndex = "0x0";
                for (logIndex in receiptsData[0].logs) {
                    receiptsData[0].logs[logIndex].transactionIndex = "0x0";
                    receiptsData[0].logs[logIndex].logIndex = "0x" + Number(logIndex).toString(16);
                }

                const transactionsJson = Module.stringToNewUTF8(JSON.stringify(transactionsData));
                const transactions = Module._ETHTransactionsCreateFromJson(/* transactionsRoot: */ 0, transactionsJson);
                Module._free(transactionsJson);
                if (!transactions) {
                    return;
                }

                const receiptsJson = Module.stringToNewUTF8(JSON.stringify(receiptsData));
                const receipts = Module._ETHReceiptsCreateFromJson(/* receiptsRoot: */ 0, receiptsJson, transactions);
                Module._free(transactionsJson);
                if (!receipts) {
                    Module._ETHTransactionsDestroy(transactions);
                    return;
                }

                const transaction = Module._ETHTransactionsGet(transactions, /* transactionIndex: */ 0);
                const receipt = Module._ETHReceiptsGet(receipts, /* receiptIndex: */ 0);
                const numBytesPtr = Module._malloc(4);
                if (!document.location.hash || document.location.hash === '#' || document.location.hash === '#rlp') {
                    const transactionBytes = Module._ETHTransactionGetBytes(transaction, numBytesPtr);
                    const numTransactionBytes = Module.HEAPU32[numBytesPtr >>> 2];
                    const transactionBytesArray = toArray(transactionBytes, numTransactionBytes);
                    visualizeTransactionRlp(transactionHashString, transactionBytesArray);
                } else if (document.location.hash === '#receipt' || document.location.hash === '#receipt/rlp') {
                    const receiptHasStatus = Module._ETHReceiptHasStatus(receipt);
                    const receiptBytes = Module._ETHReceiptGetBytes(receipt, numBytesPtr);
                    const numReceiptBytes = Module.HEAPU32[numBytesPtr >>> 2];
                    const receiptBytesArray = toArray(receiptBytes, numReceiptBytes);
                    visualizeReceiptRlp(transactionHashString, receiptBytesArray, receiptHasStatus);
                } else if (document.location.hash === '#ssz') {
                    const transactionEip6404Root = Module._ETHTransactionGetEip6404Root(transaction);
                    const transactionEip6404RootString = toHexString(transactionEip6404Root, 32);
                    const transactionEip6404Bytes = Module._ETHTransactionGetEip6404Bytes(transaction, numBytesPtr);
                    const numtransactionEip6404Bytes = Module.HEAPU32[numBytesPtr >>> 2];
                    const transactionEip6404BytesArray = toArray(transactionEip6404Bytes, numtransactionEip6404Bytes);
                    visualizeTransactionEip6404(transactionEip6404RootString, transactionEip6404BytesArray);
                } else if (document.location.hash === '#receipt/ssz') {
                    const transactionEip6404Root = Module._ETHTransactionGetEip6404Root(transaction);
                    const transactionEip6404RootString = toHexString(transactionEip6404Root, 32);
                    const receiptEip6466Bytes = Module._ETHReceiptGetEip6466Bytes(receipt, numBytesPtr);
                    const numreceiptEip6466Bytes = Module.HEAPU32[numBytesPtr >>> 2];
                    const receiptEip6466BytesArray = toArray(receiptEip6466Bytes, numreceiptEip6466Bytes);
                    visualizeReceiptEip6466(transactionEip6404RootString, receiptEip6466BytesArray);
                }
                Module._free(numBytesPtr);

                Module._ETHReceiptsDestroy(receipts);
                Module._ETHTransactionsDestroy(transactions);
            }
        }

        document.getElementById('settingsButton').onclick = function () {
            document.getElementById('masterTop').hidden = true;
            document.getElementById('headerList').hidden = true;
            document.getElementById('selectedHeaderDetail').hidden = true;
            document.getElementById('settings').hidden = false;
        }

        document.getElementById('backButton').onclick = function () {
            selectedHeader = undefined;
            document.getElementById('selectedHeaderDetail').hidden = true;
            document.getElementById('headerList').hidden = false;
        };

        document.getElementById('specsButton').onclick = function () {
            history.replaceState(/* state: */ null, /* unused: */ "", document.baseURI);
            document.getElementById('selectedTransactionRlpDetail').hidden = true;
            document.getElementById('selectedReceiptRlpDetail').hidden = true;
            document.getElementById('selectedTransactionEip6404Detail').hidden = true;
            document.getElementById('selectedReceiptEip6466Detail').hidden = true;
            document.getElementById('specsDetail').hidden = false;
        };

        function cacheHeaders(store, cfg) {
            const finalizedRoot = getBeaconRoot(Module._ETHLightClientStoreGetFinalizedHeader(store));
            document.getElementById('trustedBlockRoot').value = finalizedRoot;
            localStorage.setItem('trustedBlockRoot', finalizedRoot);

            headers.add(Module._ETHLightClientStoreGetOptimisticHeader(store), cfg);
            headers.add(Module._ETHLightClientStoreGetFinalizedHeader(store), cfg);

            const newHeaders = headers.getAll();
            const oldHeaderDivs = Array.from(headerList.children);

            let i = 0;
            let j = 0;

            while (i < newHeaders.length || j < oldHeaderDivs.length) {
                const newHeader = newHeaders[i];
                let beaconRoot = undefined;
                let beaconSlot = undefined;
                if (newHeader) {
                    beaconRoot = getBeaconRoot(newHeader);
                    beaconSlot = getBeaconSlot(newHeader);
                }

                const oldHeaderDiv = oldHeaderDivs[j];
                if (newHeader && oldHeaderDiv && beaconRoot == oldHeaderDiv.dataset.beaconRoot) {
                    i++;
                    j++;
                } else if (newHeader && (!oldHeaderDiv ||
                    beaconSlot > oldHeaderDiv.dataset.beaconSlot ||
                    (beaconSlot == oldHeaderDiv.dataset.beaconSlot &&
                    beaconRoot < oldHeaderDiv.dataset.beaconRoot)))
                {
                    const beacon = Module._ETHLightClientHeaderGetBeacon(newHeader);
                    const beaconProposerIndex = Module._ETHBeaconBlockHeaderGetProposerIndex(beacon);
                    const executionHash = Module._ETHLightClientHeaderCopyExecutionHash(newHeader, cfg);
                    const executionHashString = toHexString(executionHash, 32);
                    Module._ETHRootDestroy(executionHash);
                    const execution = Module._ETHLightClientHeaderGetExecution(newHeader);
                    const executionFeeRecipient = Module._ETHExecutionPayloadHeaderGetFeeRecipient(execution);
                    const executionBlockNumber = Module._ETHExecutionPayloadHeaderGetBlockNumber(execution);
                    const executionGasLimit = Module._ETHExecutionPayloadHeaderGetGasLimit(execution);
                    const executionGasUsed = Module._ETHExecutionPayloadHeaderGetGasUsed(execution);
                    const executionTimestamp = Module._ETHExecutionPayloadHeaderGetTimestamp(execution);
                    const executionBaseFeePerGas = Module._ETHExecutionPayloadHeaderGetBaseFeePerGas(execution);

                    const transactionsButtonId = `transactionsButton_header_${beaconRoot}`;
                    let headerDiv = document.createElement('div');
                    headerDiv.id = `headerMaster_${beaconRoot}`;
                    headerDiv.dataset.beaconRoot = beaconRoot;
                    headerDiv.dataset.beaconSlot = beaconSlot;
                    headerDiv.className = 'headerMaster';
                    headerDiv.innerHTML =
                        '<div class="headerMasterBeaconRoot">' +
                        '<a href="https://beaconcha.in/slot/' + beaconRoot + '" target="_blank">' +
                        beaconRoot.substring(2, 34) + '<br />' + beaconRoot.substring(34) + '</a>' +
                        '</div>' +
                        '<div class="headerMasterInfo">' +
                        '    <table style="width: 100%">' +
                        '        <tr>' +
                        '            <td><span class="fas fa-satellite-dish"></span> <span>' +
                        '<a href="https://beaconcha.in/slot/' + beaconSlot + '" target="_blank">' +
                        beaconSlot + '</a>' +
                        '</span></td>' +
                        '            <td><span class="fas fa-cubes"></span> <span>' +
                        '<a href="https://etherscan.io/block/' + executionHashString + '" target="_blank">' +
                        executionBlockNumber + '</a>' +
                        '</span></td>' +
                        '            <td colspan="2" style="text-align: right;"><span class="fas fa-clock"></span> <span>' +
                        toDateString(executionTimestamp) +
                        '</span></td>' +
                        '        </tr>' +
                        '        <tr>' +
                        '            <td><span class="fas fa-user-check"></span> <span>' +
                        '<a href="https://beaconcha.in/validator/' + beaconProposerIndex + '" target="_blank">' +
                        beaconProposerIndex + '</a>' +
                        '</span></td>' +
                        '            <td colspan="2" class="a"><span class="fas fa-tachometer-alt"></span> <span>' +
                        (executionGasUsed * 100 / executionGasLimit).toFixed(2) + '%' +
                        '</span> <span>' +
                        toHumanReadableNumberString(executionGasUsed) +
                        '</span>/<span>' +
                        toHumanReadableNumberString(executionGasLimit) +
                        '</span></td>' +
                        '            <td style="text-align: right;"><span class="fas fa-fire-flame-curved"></span> <span>' +
                        toGweiString(executionBaseFeePerGas, 32) + ' Gwei' +
                        '</span></td>' +
                        '        </tr>' +
                        '        <tr>' +
                        '            <td colspan="4"><span class="fas fa-hand-holding-usd"></span> <span style="display: inline-block; transform: scaleX(1.015); transform-origin: left;">' +
                        '<a href="https://etherscan.io/address/' + toHexString(executionFeeRecipient, 20) + '#mine" target="_blank">' +
                        toHexString(executionFeeRecipient, 20) + '</a>' +
                        '</span></td>' +
                        '        </tr>' +
                        '        <tr>' +
                        '            <td colspan="4"><input type="button" id="' +
                        transactionsButtonId +
                        '" value="Transactions" /></td>' +
                        '        </tr>' +
                        '    </table>' +
                        '</div>';

                    headerList.insertBefore(headerDiv, oldHeaderDiv);
                    i++;

                    document.getElementById(transactionsButtonId).onclick = function () {
                        const header = headers.get(beaconRoot);
                        if (header) {
                            selectedHeader = beaconRoot;
                            visualizeHeader('selected', header);
                            document.getElementById('headerList').hidden = true;
                            document.getElementById('selectedHeaderDetail').hidden = false;
                        }
                    };
                } else {
                    headerList.removeChild(oldHeaderDiv);
                    j++;
                }
            }
        }

        let rng = undefined;
        let cfg = undefined;
        let genesisValRoot = undefined;
        let forkDigests = undefined;
        let beaconClock = undefined;
        let store = undefined;
        let storeId = 0;
        let trackStoreTimeout = undefined;
        let trackStoreSource = undefined;
        let nextSyncTaskTime = undefined;
        function trackStore(newStore) {
            store = newStore;
            storeId++;

            function setupSource(tickStoreId) {
                trackStoreSource = new EventSource(beaconApiBase +
                    '/eth/v1/events?topics=light_client_finality_update&topics=light_client_optimistic_update');

                trackStoreSource.addEventListener('light_client_finality_update', function (event) {
                    if (storeId != tickStoreId) return;
                    const mediaType = Module.stringToNewUTF8("application/json");
                    const finUpdatesBytesPtr = Module.stringToNewUTF8(event.data);
                    const numFinUpdateBytes = Module.lengthBytesUTF8(event.data);
                    const res = Module._ETHLightClientStoreProcessFinalityUpdate(
                        store, cfg, forkDigests, genesisValRoot, beaconClock,
                        mediaType, /* consensusVersion: */ 0, finUpdatesBytesPtr, numFinUpdateBytes);
                    Module._free(finUpdatesBytesPtr);
                    Module._free(mediaType);
                    cacheHeaders(store, cfg);
                });

                trackStoreSource.addEventListener('light_client_optimistic_update', function (event) {
                    if (storeId != tickStoreId) return;
                    const mediaType = Module.stringToNewUTF8("application/json");
                    const optUpdateBytesPtr = Module.stringToNewUTF8(event.data);
                    const numOptUpdateBytes = Module.lengthBytesUTF8(event.data);
                    const res = Module._ETHLightClientStoreProcessOptimisticUpdate(
                        store, cfg, forkDigests, genesisValRoot, beaconClock,
                        mediaType, /* consensusVersion: */ 0, optUpdateBytesPtr, numOptUpdateBytes);
                    Module._free(optUpdateBytesPtr);
                    Module._free(mediaType);
                    cacheHeaders(store, cfg);
                });
            }

            function runOnTick(tickStoreId, timeout) {
                cacheHeaders(store, cfg);
                async function onTick() {
                    if (storeId != tickStoreId) return;
                    if (nextSyncTaskTime !== undefined && Date.now() < nextSyncTaskTime) {
                        runOnTick(storeId, /* timeout: */ 100);
                        return;
                    }

                    trackStoreTimeout = undefined;
                    nextSyncTaskTime = undefined;

                    const startPeriodPtr = Module._malloc(4);
                    const countPtr = Module._malloc(4);
                    const syncKind = Module._ETHLightClientStoreGetNextSyncTask(
                        store, beaconClock, startPeriodPtr, countPtr);
                    const startPeriod = Module.HEAPU32[startPeriodPtr >>> 2];
                    let count = Module.HEAPU32[countPtr >>> 2];
                    Module._free(countPtr);
                    Module._free(startPeriodPtr);

                    let res = 1;
                    if (syncKind == Module.HEAPU8[Module._kETHLcSyncKind_UpdatesByRange]) {
                        const maxUpdatesByRange = 1;
                        if (count > maxUpdatesByRange) count = maxUpdatesByRange;
                        const response = await fetch(beaconApiBase +
                            '/eth/v1/beacon/light_client/updates?start_period=' + startPeriod + '&count=' + count, {
                                headers: {
                                    'Accept': 'application/octet-stream'
                                }
                            });
                        if (storeId != tickStoreId) return;
                        if (response.ok) {
                            const data = await response.arrayBuffer();
                            if (storeId != tickStoreId) return;
                            const updatesBytes = new Uint8Array(data);

                            const mediaType = Module.stringToNewUTF8(response.headers.get('Content-Type'));
                            const updatesBytesPtr = Module._malloc(updatesBytes.length);
                            Module.HEAPU8.set(updatesBytes, updatesBytesPtr);
                            res = Module._ETHLightClientStoreProcessUpdatesByRange(
                                store, cfg, forkDigests, genesisValRoot, beaconClock,
                                startPeriod, count, mediaType, updatesBytesPtr, updatesBytes.length);
                            Module._free(updatesBytesPtr);
                            Module._free(mediaType);
                        }
                    } else if (syncKind == Module.HEAPU8[Module._kETHLcSyncKind_FinalityUpdate]) {
                        const response = await fetch(beaconApiBase +
                            '/eth/v1/beacon/light_client/finality_update', {
                                headers: {
                                    'Accept': 'application/octet-stream'
                                }
                            });
                        if (storeId != tickStoreId) return;
                        if (response.ok) {
                            const data = await response.arrayBuffer();
                            if (storeId != tickStoreId) return;
                            const finUpdateBytes = new Uint8Array(data);

                            const mediaType = Module.stringToNewUTF8(response.headers.get('Content-Type'));
                            const consensusVersion = Module.stringToNewUTF8(response.headers.get('Eth-Consensus-Version'));
                            const finUpdatesBytesPtr = Module._malloc(finUpdateBytes.length);
                            Module.HEAPU8.set(finUpdateBytes, finUpdatesBytesPtr);
                            res = Module._ETHLightClientStoreProcessFinalityUpdate(
                                store, cfg, forkDigests, genesisValRoot, beaconClock,
                                mediaType, consensusVersion, finUpdatesBytesPtr, finUpdateBytes.length);
                            Module._free(finUpdatesBytesPtr);
                            Module._free(consensusVersion);
                            Module._free(mediaType);
                        }
                    } else {
                        assert(syncKind == Module.HEAPU8[Module._kETHLcSyncKind_OptimisticUpdate]);
                        const response = await fetch(beaconApiBase +
                            '/eth/v1/beacon/light_client/optimistic_update', {
                                headers: {
                                    'Accept': 'application/octet-stream'
                                }
                            });
                        if (storeId != tickStoreId) return;
                        if (response.ok) {
                            const data = await response.arrayBuffer();
                            if (storeId != tickStoreId) return;
                            const optUpdateBytes = new Uint8Array(data);

                            const mediaType = Module.stringToNewUTF8(response.headers.get('Content-Type'));
                            const consensusVersion = Module.stringToNewUTF8(response.headers.get('Eth-Consensus-Version'));
                            const optUpdateBytesPtr = Module._malloc(optUpdateBytes.length);
                            Module.HEAPU8.set(optUpdateBytes, optUpdateBytesPtr);
                            res = Module._ETHLightClientStoreProcessOptimisticUpdate(
                                store, cfg, forkDigests, genesisValRoot, beaconClock,
                                mediaType, consensusVersion, optUpdateBytesPtr, optUpdateBytes.length);
                            Module._free(optUpdateBytesPtr);
                            Module._free(consensusVersion);
                            Module._free(mediaType);
                        }
                    }

                    let millisecondsToNextSyncTask = Module._ETHLightClientStoreGetMillisecondsToNextSyncTask(
                        store, rng, beaconClock, res);
                    nextSyncTaskTime = Date.now() + millisecondsToNextSyncTask;
                    runOnTick(storeId, /* timeout: */ 100);
                }
                trackStoreTimeout = setTimeout(onTick, timeout);
            }

            const tickStoreId = storeId;
            setupSource(tickStoreId);
            runOnTick(tickStoreId, /* timeout: */ 0);
        }
        function clearStore() {
            if (trackStoreSource !== undefined) {
                trackStoreSource.close();
                trackStoreSource = undefined;
            }
            if (trackStoreTimeout !== undefined) {
                clearTimeout(trackStoreTimeout);
                trackStoreTimeout = undefined;
                nextSyncTaskTime = undefined;
            }
            if (store !== undefined) {
                Module._ETHLightClientStoreDestroy(store);
                store = undefined;
            }
        }

        const savedTrustedBlockRoot = localStorage.getItem('trustedBlockRoot');
        if (savedTrustedBlockRoot) {
            document.getElementById('trustedBlockRoot').value = savedTrustedBlockRoot;
        }

        Module.onRuntimeInitialized = async function() {
            Module._NimMain();

            rng = Module._ETHRandomNumberCreate();
            cfg = await loadCfg();
            const genesisState = await loadGenesis(cfg);
            genesisValRoot = Module._ETHBeaconStateCopyGenesisValidatorsRoot(genesisState);
            forkDigests = Module._ETHForkDigestsCreateFromState(cfg, genesisState);
            beaconClock = Module._ETHBeaconClockCreateFromState(genesisState);
            Module._ETHBeaconStateDestroy(genesisState);

            document.getElementById('initButton').addEventListener('click', async function() {
                const trustedBlockRootString = document.getElementById('trustedBlockRoot').value;
                if (!/^0x[0-9a-fA-F]{64}$/.test(trustedBlockRootString)) {
                    return;
                }
                document.getElementById('initButton').disabled = true;
                clearStore();

                beaconApiBase = document.getElementById('beaconApiBase').value;
                executionApiBase = document.getElementById('executionApiBase').value;
                loadInitialLocation();
                const response = await fetch(beaconApiBase +
                    '/eth/v1/beacon/light_client/bootstrap/' + trustedBlockRootString, {
                        headers: {
                            'Accept': 'application/octet-stream'
                        }
                    });
                if (response.ok) {
                    const data = await response.arrayBuffer();
                    const bootstrapBytes = new Uint8Array(data);

                    const trustedBlockRootBytes = new Uint8Array(32);
                    for (let i = 0; i < trustedBlockRootBytes.length; i++) {
                        trustedBlockRootBytes[i] = parseInt(trustedBlockRootString.substr(i * 2 + 2, 2), 16);
                    }

                    const trustedBlockRootBytesPtr = Module._malloc(trustedBlockRootBytes.length);
                    Module.HEAPU8.set(trustedBlockRootBytes, trustedBlockRootBytesPtr);
                    const mediaType = Module.stringToNewUTF8(response.headers.get('Content-Type'));
                    const consensusVersion = Module.stringToNewUTF8(response.headers.get('Eth-Consensus-Version'));
                    const bootstrapBytesPtr = Module._malloc(bootstrapBytes.length);
                    Module.HEAPU8.set(bootstrapBytes, bootstrapBytesPtr);
                    const newStore = Module._ETHLightClientStoreCreateFromBootstrap(
                        cfg, trustedBlockRootBytesPtr,
                        mediaType, consensusVersion, bootstrapBytesPtr, bootstrapBytes.length);
                    Module._free(bootstrapBytesPtr);
                    Module._free(consensusVersion);
                    Module._free(trustedBlockRootBytesPtr);
                    Module._free(mediaType);

                    if (newStore) {
                        trackStore(newStore);

                        document.getElementById('settings').hidden = true;
                        document.getElementById('masterTop').hidden = false;
                        if (selectedHeader) {
                            document.getElementById('selectedHeaderDetail').hidden = false;
                        } else {
                            document.getElementById('headerList').hidden = false;
                        }
                    }
                }
                document.getElementById('initButton').disabled = false;
            });
            document.getElementById('initButton').disabled = false;
            document.getElementById('initButton').click();
        };
    </script>
    <script async src="libnimbus_lc.js"></script>
</body>
</html>
